(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Controls:()=>o,Editor:()=>C,Panel:()=>T});var o={};e.r(o),e.d(o,{LocalisationControls:()=>c,SelectionControls:()=>a});const n=require("pydio");var r=e.n(n),i=r().requireLib("hoc"),a=i.SelectionControls,c=i.LocalisationControls;const l=require("react");var u=e.n(l);const s=require("react-redux"),f=require("redux"),p=require("material-ui");function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}var y;function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},m.apply(this,arguments)}function h(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==d(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,"string");if("object"!==d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===d(r)?r:String(r)),n)}var r}function b(e,t){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},b(e,t)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var g=r().requireLib("hoc"),w=g.withSelection,E=g.withMenu,O=g.withLoader,P=g.withErrors,j=g.EditorActions,S=(0,f.compose)(E,O,P)((function(e){return u().createElement("div",e)})),x=function(e){return"1"===e.getMetadata().get("is_image")};const C=w((function(e){return new Promise((function(t,o){var n=[];e.getParent().getChildren().forEach((function(e){return n.push(e)})),t({selection:n=n.filter(x),currentIndex:n.reduce((function(t,o,n){return o===e&&n||t}),0)})}))}))(y=(0,s.connect)(null,j)(y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}(c,e);var t,o,n,r,i,a=(r=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(r);if(i){var o=v(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===d(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=a.call(this,e)).state={data:{}},t}return t=c,n=[{key:"controls",get:function(){return{options:{locate:function(e){return u().createElement(p.IconButton,{onClick:e,iconClassName:"mdi mdi-crosshairs-gps",tooltip:"Locate on a map"})}}}}}],(o=[{key:"componentDidMount",value:function(){this.props.node&&this.loadNodeContent(this.props);var e=this.props.editorModify;this.props.isActive&&e({fixedToolbar:!0})}},{key:"componentWillReceiveProps",value:function(e){e.node&&e.node!==this.props.node&&this.loadNodeContent(e);var t=this.props.editorModify;e.isActive&&t({fixedToolbar:!0})}},{key:"loadNodeContent",value:function(e){var t=e.node,o={};t.getMetadata().has("ImageExif")&&(o.ImageExif=t.getMetadata().get("ImageExif")),t.getMetadata().has("GeoLocation")&&(o.GeoLocation=t.getMetadata().get("GeoLocation")),this.setState({data:o})}},{key:"render",value:function(){var e=this,t=this.props.showControls,o=this.state.data;return o?u().createElement(S,m({},this.props,{onLocate:t&&o.GeoLocation?function(){return e.openGpsLocator()}:null,style:{display:"flex",justifyContent:"space-around",flexFlow:"row wrap"}}),Object.keys(o).map((function(e){return u().createElement(p.Card,{style:{margin:10,overflow:"auto"}},u().createElement(p.CardTitle,{key:e+"-head"},e),u().createElement(p.CardText,null,u().createElement(p.Table,{selectable:!1},u().createElement(p.TableBody,{displayRowCheckbox:!1},Object.keys(o[e]).map((function(t){return u().createElement(p.TableRow,{key:"".concat(e,"-").concat(t)},u().createElement(p.TableRowColumn,null,t),u().createElement(p.TableRowColumn,null,o[e][t]))}))))))}))):null}}])&&h(t.prototype,o),n&&h(t,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(l.Component))||y)||y;function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function k(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==_(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,"string");if("object"!==_(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===_(r)?r:String(r)),n)}var r}function M(e,t){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},M(e,t)}function R(e){return R=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},R(e)}var L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&M(e,t)}(a,e);var t,o,n,r,i=(n=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=R(n);if(r){var o=R(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),i.apply(this,arguments)}return t=a,o=[{key:"parseValues",value:function(e){var t=this,o=this.props.pydio.getPluginConfigs("meta.exif");if(o.has("exif_meta_fields")&&o.has("exif_meta_labels")){var n={},r=o.get("exif_meta_fields").split(","),i=o.get("exif_meta_labels").split(",");r.map((function(e,t){n[e]=i[t]}));var a=e.getMetadata(),c=r.map((function(e){return e.split(".")})).filter((function(e){return 2===e.length&&a.has(e[0])&&a.get(e[0])[e[1]]})).map((function(e){return{key:e.join("."),label:n[e.join(".")],value:a.get(e[0])[e[1]]}}));a.has("GeoLocation")&&a.get("GeoLocation").lat&&a.get("GeoLocation").lon&&ResourcesManager.loadClassesAndApply(["OpenLayers","PydioMaps"],(function(){return t.setState({gpsData:!0})})),this.setState({items:c})}}},{key:"componentDidMount",value:function(){this.parseValues(this.props.node)}},{key:"componentWillReceiveProps",value:function(e){e.node!==this.props.node&&(this.setState({gpsData:null}),this.parseValues(e.node))}},{key:"mapLoaded",value:function(e,t){t&&console&&console.log(t)}},{key:"openInExifEditor",value:function(){var e=this.props,t=e.pydio,o=e.node,n=t.Registry.findEditorById("editor.exif");n&&t.UI.openCurrentSelectionInEditor(n,o)}},{key:"openInMapEditor",value:function(){var e=this.props,t=e.pydio,o=e.node,n=t.Registry.findEditorsForMime("ol_layer");n.length&&t.UI.openCurrentSelectionInEditor(n[0],o)}},{key:"render",value:function(){var e=this,t=[],o=[],n={overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"};if(this.state&&this.state.items&&this.state.items.length){var r=this.state.items.map((function(e){return u().createElement("div",{key:e.key,className:"infoPanelRow",style:{float:"left",width:"50%",padding:"0 4px 12px",whiteSpace:"nowrap"}},u().createElement("div",{className:"infoPanelLabel"},e.label),u().createElement("div",{className:"infoPanelValue",title:e.value,style:n},e.value))}));t.push(u().createElement("div",{style:{padding:"0 12px"}},r)),t.push(u().createElement("div",{style:{clear:"left"}})),o.push(u().createElement(p.FlatButton,{onClick:function(){return e.openInExifEditor()},label:this.props.pydio.MessageHash[456]}))}return this.state&&this.state.gpsData&&(t.push(u().createElement(PydioReactUI.AsyncComponent,{namespace:"PydioMaps",componentName:"OLMap",key:"map",style:{height:170,marginBottom:0,padding:0},centerNode:this.props.node,mapLoaded:this.mapLoaded})),o.push(u().createElement(p.FlatButton,{onClick:function(){return e.openInMapEditor()},label:this.props.pydio.MessageHash["meta.exif.2"]}))),t.length?u().createElement(PydioWorkspaces.InfoPanelCard,{identifier:"meta-exif",style:this.props.style,title:this.props.pydio.MessageHash["meta.exif.3"],actions:o,icon:"camera",iconColor:"#607d8b"},t):null}}],o&&k(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),a}(l.Component);const T=L;window.PydioExif=t})();