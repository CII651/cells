(()=>{"use strict";var e={760:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,o,i){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(r)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);r&&a[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),o&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=o):u[4]="".concat(o)),t.push(u))}},t}},156:e=>{e.exports=function(e){return e[1]}},144:(e,t,n)=>{n.d(t,{Z:()=>s});var r=n(156),o=n.n(r),i=n(760),a=n.n(i)()(o());a.push([e.id,'div.user-badge.share-dialog {\n  border-bottom: 1px solid #e0e0e0;\n  clear: both;\n  font-size: 16px;\n  margin-left: 10px;\n  margin-right: 10px;\n  padding-top: 1px;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  line-height: 20px;\n}\ndiv.user-badge.share-dialog .user-badge-label {\n  flex: 1;\n  padding: 9px 0;\n  line-height: 25px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\ndiv.user-badge.share-dialog:last-of-type {\n  border-bottom: 0;\n}\ndiv.user-badge.share-dialog span.icon-ellipsis-vertical.mui-font-icon {\n  color: #6F6F6F;\n  font-size: 18px;\n}\ndiv.user-badge.share-dialog span.avatar {\n  background-color: #4aceb0;\n  border-radius: 50%;\n  color: white;\n  display: inline-block;\n  font-size: 17px;\n  height: 24px;\n  width: 24px;\n  margin: 5px 14px 7px 7px;\n  padding: 3px;\n  text-align: center;\n}\ndiv.user-badge.share-dialog.user-type-group span.avatar {\n  background-color: #47b092;\n}\ndiv.user-badge.share-dialog.user-type-tmp_user span.avatar,\ndiv.user-badge.share-dialog.user-type-remote_user span.avatar {\n  background-color: #438db3;\n}\ndiv.user-badge.share-dialog img {\n  background-color: #4aceb0;\n  border-radius: 50%;\n  color: white;\n  display: inline-block;\n  font-size: 17px;\n  height: 24px;\n  margin: 5px 14px 7px -44px;\n  padding: 6px;\n  text-align: center;\n  width: 24px;\n}\ndiv.user-badge.share-dialog div.user-badge-menu-box {\n  font-size: 13px;\n  position: relative;\n}\ndiv.user-badge.share-dialog div.user-badge-menu-box div.mui-menu.mui-visible {\n  box-shadow: 0 0 5px rgba(0, 0, 0, 0.43);\n  position: absolute;\n  right: 0;\n  top: 0;\n  width: 200px;\n  z-index: 120;\n}\ndiv.user-badge.share-dialog div.user-badge-menu-box div.mui-menu span.icon-check {\n  float: right;\n  font-size: 16px;\n  margin-top: 15px;\n}\ndiv.user-badge.share-dialog span.user-badge-rights-container {\n  float: right;\n  padding: 11px;\n  color: gray;\n  font-size: 11px;\n  line-height: 25px;\n}\ndiv.user-badge.share-dialog span.user-badge-rights-container input[name="write"] {\n  margin-left: 28px;\n}\ndiv#share-form-users {\n  margin-top: 0 !important;\n}\n',""]);const s=a},247:e=>{var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var i={},a=[],s=0;s<e.length;s++){var l=e[s],c=r.base?l[0]+r.base:l[0],u=i[c]||0,p="".concat(c," ").concat(u);i[c]=u+1;var f=n(p),d={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==f)t[f].references++,t[f].updater(d);else{var y=o(d,r);r.byIndex=s,t.splice(s,0,{identifier:p,updater:y,references:1})}a.push(p)}return a}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var i=r(e=e||[],o=o||{});return function(e){e=e||[];for(var a=0;a<i.length;a++){var s=n(i[a]);t[s].references--}for(var l=r(e,o),c=0;c<i.length;c++){var u=n(i[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}i=l}}},938:e=>{var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},767:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},549:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},415:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,o&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},35:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},105:e=>{e.exports=require("color")},566:e=>{e.exports=require("create-react-class")},455:e=>{e.exports=require("material-ui")},173:e=>{e.exports=require("material-ui/styles")},580:e=>{e.exports=require("prop-types")},757:e=>{e.exports=require("pydio")},689:e=>{e.exports=require("react")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={id:r,exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nc=void 0;var r={};(()=>{n.r(r),n.d(r,{CellCard:()=>Bt,CompositeDialog:()=>ai,CreateCellDialog:()=>_e,EditCellDialog:()=>bt,InfoPanel:()=>oi,LinkModel:()=>Xt,ShareHelper:()=>xt,ShareView:()=>Ti,ShareViewModal:()=>Di,SimpleLinkCard:()=>Ro});var e=n(689),t=n.n(e),o=n(580),i=n.n(o),a=n(757),s=n.n(a),l=n(455),c=n(173);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},p.apply(this,arguments)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==u(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===u(o)?o:String(o)),r)}var o}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}var h=n(580),m=n(689);function b(e){var t=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(s,t);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=y(o);if(i){var n=y(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return n=s,(r=[{key:"render",value:function(){var t=this.context,n={messages:t.messages,getMessage:t.getMessage,isReadonly:t.isReadonly};return m.createElement(e,p({},this.props,n))}}])&&f(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(m.Component);return t.contextTypes={messages:h.object,getMessage:h.func,isReadonly:h.func},t}function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==v(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==v(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===v(o)?o:String(o)),r)}var o}function w(e,t){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},w(e,t)}function O(e){return O=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},O(e)}var E=n(580),P=n(689).Component,j=n(455),k=j.MenuItem,S=j.IconMenu,R=j.IconButton,x=n(173).muiThemeable,_=n(105),L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&w(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=O(r);if(o){var n=O(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===v(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),i.apply(this,arguments)}return t=a,(n=[{key:"renderMenu",value:function(){if(!this.props.menus||!this.props.menus.length)return null;var e=this.props.menus.map((function(e){var t;return e.checked&&(t=React.createElement("span",{className:"mdi mdi-check"})),React.createElement(k,{primaryText:e.text,onClick:e.callback,rightIcon:t})}));return React.createElement(S,{iconButtonElement:React.createElement(R,{style:{width:30,height:30,padding:5},iconStyle:{fontSize:18},iconClassName:"mdi mdi-dots-vertical"}),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},desktop:!0},e)}},{key:"render",value:function(){var e,t=this.props.muiTheme.palette.avatarsColor;"group"===this.props.type?(t=_(t).darken(.2).toString(),e=React.createElement("span",{className:"avatar mdi mdi-account-multiple",style:{backgroundColor:t}})):"team"===this.props.type?(t=_(t).darken(.2).toString(),e=React.createElement("span",{className:"avatar mdi mdi-account-multiple-outline",style:{backgroundColor:t}})):"temporary"===this.props.type?(t=_(t).lighten(.2).toString(),e=React.createElement("span",{className:"avatar mdi mdi-account-plus",style:{backgroundColor:t}})):e="remote_user"===this.props.type?React.createElement("span",{className:"avatar mdi mdi-account-network",style:{backgroundColor:t}}):React.createElement("span",{className:"avatar mdi mdi-account",style:{backgroundColor:t}});var n=this.renderMenu(),r=this.props.boxes;return React.createElement("div",{className:"share-dialog user-badge user-type-"+this.props.type},e,React.createElement("span",{className:"user-badge-label"},this.props.label),n,r)}}])&&g(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(P);function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){N(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,B(r.key),r)}}function A(e,t){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},A(e,t)}function I(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e){return U=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},U(e)}function N(e,t,n){return(t=B(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B(e){var t=function(e,t){if("object"!==M(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==M(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===M(t)?t:String(t)}L.propTypes={label:E.string,avatar:E.string,type:E.string,menus:E.object,muiTheme:E.object},L=x()(L);var q=n(580),F=n(689),H=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&A(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=U(r);if(o){var n=U(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===M(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return I(e)}(this,e)});function a(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return N(I(e=i.call.apply(i,[this].concat(n))),"onRemove",(function(){e.props.onUserObjectRemove(e.props.cellAcl.RoleId)})),N(I(e),"onInvite",(function(){var t={},n=PydioUsers.User.fromIdmUser(e.props.cellAcl.User);t[n.getId()]=n,e.props.sendInvitations(t)})),N(I(e),"onUpdateRight",(function(t,n){e.props.onUserObjectUpdateRight(e.props.cellAcl.RoleId,t,n)})),e}return t=a,(n=[{key:"render",value:function(){var e,t,n=this,r=this.props,o=r.cellAcl,i=r.pydio,a=[],s=o.User?"user":o.Group?"group":"team";if(o.User&&o.User.Login===i.user.id)return null;switch("group"!==s&&this.props.sendInvitations&&a.push({text:this.props.getMessage("45"),callback:this.onInvite}),this.props.isReadonly()||this.props.readonly||a.push({text:this.props.getMessage("257",""),callback:this.onRemove}),s){case"user":e=o.User.Attributes.displayName||o.User.Login,t=o.User.Attributes.avatar;break;case"group":e=o.Group.Attributes?o.Group.Attributes.displayName||o.Group.GroupLabel:o.Group.Uuid;break;case"team":e=o.Role?o.Role.Label:"No role found";break;default:e=o.RoleId}var c=!1,u=!1;o.Actions.map((function(e){"read"===e.Name&&(c=!0),"write"===e.Name&&(u=!0)}));var p=this.props.isReadonly()||this.props.readonly,f={display:"flex",width:70};a.length||(f=T(T({},f),{},{marginRight:48}));var d=F.createElement("span",{style:f},F.createElement(l.Checkbox,{disabled:p,checked:c,onCheck:function(e,t){n.onUpdateRight("read",t)}}),F.createElement(l.Checkbox,{disabled:p,checked:u,onCheck:function(e,t){n.onUpdateRight("write",t)}}));return F.createElement(L,{label:e,avatar:t,type:s,menus:a,boxes:d})}}])&&D(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(F.Component);function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==z(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==z(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===z(o)?o:String(o)),r)}var o}function W(e,t){return W=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},W(e,t)}function Y(e){return Y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Y(e)}N(H,"propTypes",{cellAcl:q.object.isRequired,sendInvitations:q.func,onUserObjectRemove:q.func.isRequired,onUserObjectUpdateRight:q.func.isRequired}),H=b(H);var G=n(580),Q=n(689).Component,K=n(455).IconButton,X=n(173).muiThemeable,Z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&W(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Y(r);if(o){var n=Y(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),i.apply(this,arguments)}return t=a,(n=[{key:"render",value:function(){var e=this.props.muiTheme.palette,t=this.props.destructive?e.mui3.error:e.mui3.primary,n={root:{borderRadius:"50%",border:"1px solid "+t,backgroundColor:"transparent",width:36,height:36,padding:"8px 6px",margin:"0 6px",zIndex:0},icon:{color:t,fontSize:20,lineHeight:"20px"}},r=this.props,o=r.tooltip,i=r.messageId,a=r.getMessage,s=r.messageCoreNamespace;return i&&a&&(o=this.props.getMessage(i,s||void 0)),React.createElement(K,{style:n.root,iconStyle:n.icon,onClick:this.props.callback||this.props.onClick,iconClassName:this.props.mdiIcon?"mdi mdi-"+this.props.mdiIcon:this.props.iconClassName,tooltip:o,tooltipPosition:this.props.tooltipPosition})}}])&&V(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(Q);Z.propTypes={callback:G.func,onClick:G.func,mdiIcon:G.string,messageId:G.string},Z=b(Z);const J=Z=X()(Z);function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ie(r.key),r)}}function te(e,t){return te=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},te(e,t)}function ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function re(e){return re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},re(e)}function oe(e,t,n){return(t=ie(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ie(e){var t=function(e,t){if("object"!==$(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==$(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===$(t)?t:String(t)}var ae=s().requireLib("components").UsersCompleter,se=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&te(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=re(o);if(i){var n=re(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===$(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ne(e)}(this,e)});function s(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return oe(ne(e=a.call.apply(a,[this].concat(n))),"sendInvitationToAllUsers",(function(){var t=e.props,n=t.cellAcls,r=t.pydio,o=[];Object.keys(n).map((function(e){var t=n[e];if((!t.User||t.User.Login!==r.user.id)&&t.User){var i=PydioUsers.User.fromIdmUser(t.User);o[i.getId()]=i}})),e.props.sendInvitations(o)})),oe(ne(e),"clearAllUsers",(function(){Object.keys(e.props.cellAcls).map((function(t){e.props.onUserObjectRemove(t)}))})),oe(ne(e),"valueSelected",(function(t){t.IdmUser?e.props.onUserObjectAdd(t.IdmUser):e.props.onUserObjectAdd(t.IdmRole)})),e}return n=s,(r=[{key:"render",value:function(){var e=this,n=this.props,r=n.cellAcls,o=n.pydio,i=n.completerStyle,a=n.muiTheme,s=o.getPluginConfigs("core.auth"),l=0,c=[];Object.keys(r).map((function(n){var i=r[n];i.User&&i.User.Login===o.user.id||(l++,c.push(t().createElement(H,{cellAcl:i,key:l,pydio:e.props.pydio,readonly:e.props.readonly,sendInvitations:e.props.sendInvitations,onUserObjectRemove:e.props.onUserObjectRemove,onUserObjectUpdateRight:e.props.onUserObjectUpdateRight})))}));var u,p,f=[],d=Object.keys(this.props.cellAcls).length;if(!d||this.props.isReadonly()||this.props.readonly||f.push(t().createElement(J,{key:"clear",callback:this.clearAllUsers,tooltipPosition:"top-center",mdiIcon:"account-minus",messageId:"180"})),d&&this.props.sendInvitations&&f.push(t().createElement(J,{key:"invite",callback:this.sendInvitationToAllUsers,tooltipPosition:"top-center",mdiIcon:"email-outline",messageId:"45"})),this.props.saveSelectionAsTeam&&d>1&&!this.props.isReadonly()&&!this.props.readonly&&f.push(t().createElement(J,{key:"team",callback:this.props.saveSelectionAsTeam,mdiIcon:"account-multiple-plus",tooltipPosition:"top-center",messageId:"509",messageCoreNamespace:!0})),this.props.withActionLinks&&(f=this.props.withActionLinks(f)),c.length){var y="rgba(0,0,0,.33)";"mui3"===a.userTheme&&(y=a.palette.mui3.outline),u=t().createElement("div",{style:{display:"flex",marginBottom:-8,marginTop:-8,color:y,fontSize:12}},t().createElement("div",{style:{flex:1}}),t().createElement("div",{style:{width:43,textAlign:"center"}},this.props.getMessage("361","")),t().createElement("div",{style:{width:43,textAlign:"center"}},this.props.getMessage("181")),t().createElement("div",{style:{width:6}}))}if(!this.props.isReadonly()&&!this.props.readonly){var h=Object.values(r).map((function(e){return e.User?e.User.Login:e.Group?e.Group.Uuid:e.Role?e.Role.Uuid:null})).filter((function(e){return!!e})),m=s.get("USER_CREATE_USERS");p=t().createElement(ae,{className:"share-form-users",fieldLabel:this.props.getMessage(m?"34":"34b"),onValueSelected:this.valueSelected,pydio:this.props.pydio,showAddressBook:!0,usersFrom:"local",excludes:h,existingOnly:!m})}return t().createElement("div",null,t().createElement("div",{style:i||{margin:"0 8px 16px"}},p),u,t().createElement("div",null,c),!c.length&&t().createElement("div",{style:{color:a.palette.mui3["on-surface-variant"],fontWeight:500,margin:"0 10px"}},this.props.getMessage("182")),c.length>0&&t().createElement("div",{style:{textAlign:"center",marginTop:10,marginBottom:10}},f))}}])&&ee(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);oe(se,"propTypes",{pydio:i().instanceOf(s()),cellAcls:i().object,saveSelectionAsTeam:i().func,sendInvitations:i().func,showTitle:i().bool,onUserObjectAdd:i().func.isRequired,onUserObjectRemove:i().func.isRequired,onUserObjectUpdateRight:i().func.isRequired}),se=b((0,c.muiThemeable)()(se));const le=require("pydio/model/data-model");var ce=n.n(le);function ue(e){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ue(e)}function pe(e){return function(e){if(Array.isArray(e))return fe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return fe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fe(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function de(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ue(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==ue(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===ue(o)?o:String(o)),r)}var o}function ye(e,t){return ye=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ye(e,t)}function he(e){return he=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},he(e)}var me=s().requireLib("components").FoldersTree,be=s().requireLib("hoc").ThemedContainers.Popover,ve=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ye(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=he(o);if(i){var n=he(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===ue(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=a.call(this,e);var r=e.pydio.user,o=[];r.getRepositoriesList().forEach((function(e){if("gateway"===e.getAccessType()){if(e.getId()===r.activeRepository){if("shared"===e.getOwner())return;n=e}o.push(e)}}));var i,l,c=o.filter((function(e){return!e.getOwner()})),u=o.filter((function(e){return e.getOwner()}));if((l=c.length&&u.length?[].concat(pe(c),["DIVIDER"],pe(u)):[].concat(pe(c),pe(u))).length){n||(n=l[0]);var p=(i=ce().RemoteDataModelFactory({tmp_repository_id:n.getId()})).getRootNode();p.getMetadata().set("repository_id",n.getId()),p.load(i.getAjxpNodeProvider())}return t.state={dataModel:i,open:!1,availableWs:l,crtWs:n},t}return n=s,(r=[{key:"switchWorkspace",value:function(e){var t=ce().RemoteDataModelFactory({tmp_repository_id:e.getId()}),n=t.getRootNode();n.getMetadata().set("repository_id",e.getId()),n.load(t.getAjxpNodeProvider()),this.setState({crtWs:e,dataModel:t})}},{key:"handleTouchTap",value:function(e){e.preventDefault(),this.setState({open:!0,anchorEl:e.currentTarget})}},{key:"handleRequestClose",value:function(){this.setState({open:!1})}},{key:"onValidateNode",value:function(){var e=this.state,t=e.node,n=e.crtWs;this.props.model.addRootNode(t,n.getId()),this.handleRequestClose()}},{key:"onNodeSelected",value:function(e){var t=this.state.dataModel;e.load(t.getAjxpNodeProvider()),this.setState({node:e})}},{key:"renderNodeLine",value:function(e){var n=this.props.model;return t().createElement(l.ListItem,{disabled:!0,leftIcon:t().createElement(l.FontIcon,{className:"mdi mdi-"+("LEAF"===e.Type?"file":"folder")}),primaryText:n.getNodeLabelInContext(e),rightIconButton:t().createElement(l.IconButton,{onClick:function(){n.removeRootNode(e.Uuid)},iconClassName:"mdi mdi-delete",tooltip:"Remove",iconStyle:{color:"var(--md-sys-color-secondary)"}})})}},{key:"render",value:function(){var e,n,r=this,o=this.props,i=o.model,a=o.muiTheme,s=o.mode,c=o.pydio,u=function(e){return c.MessageHash["share_center."+e]},p=i.getRootNodes()||[],f=[];p.map((function(e){f.push(r.renderNodeLine(e)),f.push(t().createElement(l.Divider,{inset:!0}))})),f.pop(),p.length||"edit"!==s||(e=t().createElement("span",{style:{fontStyle:"italic"}},u(280))),n="edit"===s?t().createElement(l.RaisedButton,{label:u(282),onClick:this.handleTouchTap.bind(this),primary:!0,style:{marginBottom:10},icon:t().createElement(l.FontIcon,{className:"mdi mdi-folder-plus"})}):t().createElement(l.RaisedButton,{label:u(282),onClick:this.handleTouchTap.bind(this),secondary:!0,style:{marginBottom:10},icon:t().createElement(l.FontIcon,{className:"mdi mdi-folder-plus",style:{fontSize:20,marginTop:-4}})});var d=this.state,y=d.node,h=d.availableWs,m=d.crtWs;return t().createElement("div",null,n,t().createElement(l.List,null,f),e,t().createElement(be,{open:this.state.open,anchorEl:this.state.anchorEl,anchorOrigin:{horizontal:"left",vertical:"bottom"},targetOrigin:{horizontal:"left",vertical:"top"},onRequestClose:this.handleRequestClose.bind(this)},t().createElement("div",{style:{width:372,height:300,display:"flex",flexDirection:"column"}},t().createElement(l.DropDownMenu,{style:{height:54},value:m,onChange:function(e,t,n){r.switchWorkspace(n)}},h.map((function(e){return"DIVIDER"===e?t().createElement(l.Divider,null):t().createElement(l.MenuItem,{value:e,primaryText:e.getLabel()})}))),t().createElement(l.Divider,null),t().createElement("div",{style:{marginLeft:-26,flex:"1",overflowY:"auto",fontSize:15}},t().createElement(me,{pydio:this.props.pydio,dataModel:this.state.dataModel,onNodeSelected:this.onNodeSelected.bind(this),showRoot:!1,draggable:!1})),t().createElement(l.Divider,null),t().createElement("div",{style:{display:"flex",padding:"4px 16px",alignItems:"center",fontSize:15}},t().createElement("div",{style:{flex:1}},y&&y.getPath()||u(283)),t().createElement(l.IconButton,{iconStyle:{color:a.palette.primary1Color},disabled:!y,iconClassName:"mdi mdi-plus-circle-outline",onClick:this.onValidateNode.bind(this)})))))}}])&&de(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);ve=(0,c.muiThemeable)()(ve);const ge=require("pydio/model/cell");var we=n.n(ge);function Oe(e){return Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oe(e)}function Ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Re(r.key),r)}}function Pe(e,t){return Pe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Pe(e,t)}function je(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ke(e){return ke=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ke(e)}function Se(e,t,n){return(t=Re(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Re(e){var t=function(e,t){if("object"!==Oe(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Oe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Oe(t)?t:String(t)}var xe=s().requireLib("hoc").ModernTextField,_e=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Pe(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(o);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Oe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return je(e)}(this,e)});function s(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Se(je(e=a.call.apply(a,[this].concat(n))),"state",{step:"users",model:new(we()),saving:!1}),Se(je(e),"submit",(function(){var t=e.state.model;e.setState({saving:!0}),t.save().then((function(t){e.props.onDismiss(),e.setState({saving:!1})})).catch((function(t){pydio.UI.displayMessage("ERROR",t.message),e.setState({saving:!1})}))})),Se(je(e),"m",(function(t){return e.props.pydio.MessageHash["share_center."+t]})),Se(je(e),"computeSummaryString",(function(){var t,n=e.state.model,r=0,o=0,i=0,a=[],s=n.getAcls();return Object.keys(s).map((function(e){var t=s[e];t.Group?o++:t.Role?i++:r++})),r&&a.push(r+" "+e.m(270)),o&&a.push(o+" "+e.m(271)),i&&a.push(i+" "+e.m(272)),t=3===a.length?a[0]+", "+a[1]+e.m(274)+a[3]:0===a.length?e.m(273):a.join(e.m(274)),e.m(269).replace("%USERS",t)})),e}return n=s,r=[{key:"getChildContext",value:function(){var e=this.props.pydio.MessageHash;return{messages:e,getMessage:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"share_center";try{return e[n+(n?".":"")+t]||t}catch(e){return t}},isReadonly:function(){return!1}.bind(this)}}},{key:"componentDidMount",value:function(){var e=this;this.refs.title.focus(),this.state.model.observe("update",(function(){e.forceUpdate()}))}},{key:"componentWillUnmount",value:function(){this.state.model.stopObserving("update")}},{key:"render",value:function(){var e,n=this,r=[],o=this.props.pydio,i=this.state,a=i.step,s=i.model,c=i.saving,u=o.MessageHash[418];return"users"!==a&&(u=s.getLabel()),"users"===a?(e=t().createElement("div",null,t().createElement("div",null,this.m(275)),t().createElement(xe,{ref:"title",floatingLabelText:this.m(276),value:s.getLabel(),onChange:function(e,t){s.setLabel(t)},fullWidth:!0,variant:"v2",focusOnMount:!0,onKeyPress:function(e){"Enter"===e.key&&s.getLabel()&&n.submit()}}),t().createElement(xe,{floatingLabelText:this.m(277),value:s.getDescription(),onChange:function(e,t){s.setDescription(t)},fullWidth:!0,variant:"v2"})),s.getLabel()&&(r.push(t().createElement(l.FlatButton,{key:"quick",primary:!0,disabled:!s.getLabel()||c,label:this.m("cells.create.advanced"),onClick:function(){n.setState({step:"data"})}})),r.push(t().createElement("span",{style:{display:"inline-block",margin:"0  10px",fontSize:14,fontWeight:500,color:"#9E9E9E"}},this.m("cells.create.buttons.separator")))),r.push(t().createElement(l.RaisedButton,{key:"next1",disabled:!s.getLabel()||c,primary:!0,label:this.m(279),onClick:function(){n.submit()}}))):"data"===a?(e=t().createElement("div",null,t().createElement("h5",{style:{marginTop:-10}},this.m(278)),t().createElement(se,{pydio:o,cellAcls:s.getAcls(),excludes:[o.user.id],onUserObjectAdd:s.addUser.bind(s),onUserObjectRemove:s.removeUser.bind(s),onUserObjectUpdateRight:s.updateUserRight.bind(s)})),r.push(t().createElement(l.FlatButton,{key:"prev1",primary:!1,label:o.MessageHash[304],onClick:function(){n.setState({step:"users"})}})),r.push(t().createElement(l.FlatButton,{key:"next2",primary:!0,label:o.MessageHash[179],onClick:function(){return n.setState({step:"label"})}}))):(e=t().createElement("div",null,t().createElement("h5",{style:{marginTop:-10}},this.m("cells.create.title.fill.folders")),t().createElement("div",{style:{color:"#9e9e9e"}},this.computeSummaryString()),t().createElement("div",{style:{paddingTop:16}},t().createElement(ve,{pydio:o,model:s}))),r.push(t().createElement(l.FlatButton,{key:"prev2",primary:!1,label:o.MessageHash[304],onClick:function(){n.setState({step:"data"})}})),r.push(t().createElement(l.RaisedButton,{key:"submit",disabled:c,primary:!0,label:this.m(279),onClick:this.submit.bind(this)}))),t().createElement("div",{style:{width:380,fontSize:13,display:"flex",flexDirection:"column",minHeight:300}},t().createElement("div",{style:{display:"flex",alignItems:"center",paddingLeft:20}},t().createElement(l.FontIcon,{className:"icomoon-cells-full-plus"}),t().createElement("div",{style:{padding:20,fontSize:22}},u)),t().createElement("div",{style:{padding:"20px 20px 10px",flex:1}},e),t().createElement("div",{style:{padding:"12px 16px",display:"flex",alignItems:"center",justifyContent:"flex-end"}},r))}}],r&&Ee(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);function Le(e){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Le(e)}function Me(e){return function(e){if(Array.isArray(e))return Ce(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ce(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(n),!0).forEach((function(t){Ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ae(e,t,n){return(t=Be(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Be(r.key),r)}}function Ne(e,t,n){return t&&Ue(e.prototype,t),n&&Ue(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Be(e){var t=function(e,t){if("object"!==Le(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Le(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Le(t)?t:String(t)}function qe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Fe(e,t)}function Fe(e,t){return Fe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Fe(e,t)}function He(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ze(e);if(t){var o=ze(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===Le(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function ze(e){return ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ze(e)}Se(_e,"childContextTypes",{messages:i().object,getMessage:i().func,isReadonly:i().func}),_e=(0,c.muiThemeable)()(_e);var Ve=function(e){qe(r,e);var n=He(r);function r(){return Ie(this,r),n.apply(this,arguments)}return Ne(r,[{key:"render",value:function(){var e=this.props,n=e.tabs,r=e.active,o=e.onChange,i=e.style,a=e.muiTheme,s=a.palette.mui3["on-surface-variant"],c=a.palette.mui3.primary;return t().createElement("div",{style:De({display:"flex"},i)},n.map((function(e){var n=e.Value===r,i=e.Label;return e.Icon&&(i=t().createElement("span",null,t().createElement("span",{className:e.Icon,style:{marginLeft:-5}})," ",e.Label)),t().createElement(l.FlatButton,{label:i,onClick:function(){o(e.Value)},primary:n,style:{flex:1,height:46,lineHeight:"46px",borderRadius:0,borderBottom:"3px solid "+(n?c:"transparent")},labelStyle:{textTransform:"none",fontSize:13,paddingLeft:8,paddingRight:8,color:n?c:s}})})))}}]),r}(t().Component);Ve=(0,c.muiThemeable)()(Ve);var We=function(e){qe(n,e);var t=He(n);function n(){return Ie(this,n),t.apply(this,arguments)}return Ne(n,[{key:"render",value:function(){var e=this.props,t=e.tabs,n=e.active,r=null;return t.map((function(e){e.Value===n&&(r=e.Component)})),r}}]),n}(t().Component),Ye=function(e){qe(r,e);var n=He(r);function r(e){var t;return Ie(this,r),(t=n.call(this,e)).state={left:e.tabs.left.length?e.tabs.left[0].Value:"",right:e.tabs.right.length?e.tabs.right[0].Value:""},e.defaultLeft&&(t.state.left=e.defaultLeft),e.defaultRight&&(t.state.right=e.defaultRight),t}return Ne(r,[{key:"componentWillReceiveProps",value:function(e){!this.props.defaultLeft&&e.defaultLeft?this.setState({left:e.defaultLeft}):!this.state.left&&e.tabs.left.length&&this.setState({left:e.tabs.left[0].Value}),!this.props.defaultRight&&e.defaultRight?this.setState({right:e.defaultRight}):!this.state.right&&e.tabs.right.length&&this.setState({right:e.tabs.right[0].Value})}},{key:"render",value:function(){var e=this,n=this.props,r=n.tabs,o=n.header,i=n.onSaveAction,a=n.onCloseAction,s=n.onRevertAction,c=n.saveEnabled,u=n.style,p=n.pydio,f=n.editorOneColumn,d=this.state,y=d.left,h=d.right;if(f){var m=[].concat(Me(r.left),Me(r.right)),b=m.filter((function(e){return e.AlwaysLast}));return b.length&&(m=[].concat(Me(m.filter((function(e){return!e.AlwaysLast}))),Me(b))),m.length&&0===m.filter((function(e){return e.Value===y})).length&&(y=m[0].Value),t().createElement("div",{style:De({display:"flex",flexDirection:"column",height:"100%"},u)},t().createElement("div",{style:{display:"flex",alignItems:"center"}},t().createElement("div",{style:{flex:1,padding:10}},o),t().createElement(l.IconButton,{iconClassName:"mdi mdi-close",tooltip:p.MessageHash[86],onClick:a,style:{marginRight:10}})),t().createElement("div",{style:{display:"flex"}},t().createElement(Ve,{tabs:m,active:y,style:{flex:1,padding:"0 16px"},onChange:function(t){e.setState({left:t})}})),t().createElement(l.Divider,{style:{flexShrink:0}}),t().createElement("div",{style:{display:"flex",flex:1,overflow:"hidden"}},t().createElement("div",{style:De({overflowY:"auto",width:"100%",height:"100%"},r.leftStyle)},t().createElement(We,{tabs:m,active:y}))),t().createElement(l.Divider,{style:{flexShrink:0}}),t().createElement("div",{style:{padding:10,display:"flex",alignItems:"center",justifyContent:"flex-end"}},t().createElement(l.FlatButton,{disabled:!c,label:p.MessageHash[628],onClick:s,style:{marginLeft:10}}),t().createElement(l.RaisedButton,{disabled:!c,label:p.MessageHash[53],onClick:i})))}return r.left&&r.left.length&&0===r.left.filter((function(e){return e.Value===y})).length&&(y=r.left[0].Value),r.right&&r.right.length&&0===r.right.filter((function(e){return e.Value===y})).length&&(h=r.right[0].Value),t().createElement("div",{style:De({display:"flex",flexDirection:"column",height:"100%"},u)},t().createElement("div",{style:{display:"flex",alignItems:"center",padding:10,paddingBottom:0}},t().createElement("div",{style:{flex:1,alignItems:"center",paddingRight:20}},o),t().createElement(l.RaisedButton,{disabled:!c,primary:!0,label:p.MessageHash[53],onClick:i}),t().createElement(l.FlatButton,{disabled:!c,label:p.MessageHash[628],onClick:s,style:{marginLeft:10}}),t().createElement(l.IconButton,{iconClassName:"mdi mdi-close",tooltip:p.MessageHash[86],onClick:a,style:{marginLeft:10}})),t().createElement("div",{style:{display:"flex"}},t().createElement(Ve,{tabs:r.left,active:y,style:{flex:1,margin:"0 16px"},onChange:function(t){e.setState({left:t})}}),t().createElement(Ve,{tabs:r.right,active:h,style:{flex:1,margin:"0 16px"},onChange:function(t){e.setState({right:t})}})),t().createElement(l.Divider,{style:{flexShrink:0,display:"none"}}),t().createElement("div",{style:{display:"flex",flex:1,overflow:"hidden",padding:"0 5px 5px"}},t().createElement(l.Paper,{zDepth:1,style:De({overflowY:"auto",width:"50%",margin:"0 5px 5px",border:"1px solid #e0e0e0",borderRadius:5},r.leftStyle)},t().createElement(We,{tabs:r.left,active:y})),t().createElement(l.Paper,{zDepth:1,style:De({overflowY:"auto",width:"50%",margin:"0 5px 5px",border:"1px solid #e0e0e0",borderRadius:5},r.rightStyle)},t().createElement(We,{tabs:r.right,active:h}))))}}]),r}(t().Component);function Ge(e){return Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ge(e)}function Qe(){return Qe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Qe.apply(this,arguments)}function Ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(n),!0).forEach((function(t){tt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,nt(r.key),r)}}function Je(e,t){return Je=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Je(e,t)}function $e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function et(e){return et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},et(e)}function tt(e,t,n){return(t=nt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function nt(e){var t=function(e,t){if("object"!==Ge(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Ge(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Ge(t)?t:String(t)}var rt=s().requireLib("hoc"),ot=rt.ModernTextField,it=rt.DatePicker,at=rt.ThemedModernStyles,st=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Je(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=et(o);if(i){var n=et(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Ge(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return $e(e)}(this,e)});function s(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return tt($e(e=a.call.apply(a,[this].concat(n))),"formatDate",(function(t){return e.props.pydio.MessageHash.date_format.split(" ").shift().replace("Y",t.getFullYear()).replace("m",t.getMonth()+1).replace("d",t.getDate())})),e}return n=s,(r=[{key:"render",value:function(){var e,n,r,o=this.props,i=o.pydio,a=o.model,s=o.muiTheme,c=function(e){return i.MessageHash["share_center."+e]},u=at(s);return a&&a.cell&&(n=function(e,t){if(null===t)a.cell.AccessEnd="-1";else{var n=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());a.cell.AccessEnd=Math.floor(n/1e3)}a.notifyDirty()},a.cell.AccessEnd&&parseInt(a.cell.AccessEnd)>0&&(e=new Date(1e3*parseInt(a.cell.AccessEnd)),r=t().createElement(l.IconButton,{iconStyle:{color:"var(--md-sys-color-secondary)"},style:{position:"absolute",right:0,bottom:0,zIndex:1},iconClassName:"mdi mdi-close-circle",onClick:function(){n(null,null)}}))),t().createElement("div",{style:{padding:"0 8px"}},t().createElement(ot,{floatingLabelText:c(267),value:a.getLabel(),onChange:function(e,t){a.setLabel(t)},fullWidth:!0,variant:"v2"}),t().createElement(ot,{floatingLabelText:c(268),value:a.getDescription(),onChange:function(e,t){a.setDescription(t)},fullWidth:!0,variant:"v2"}),t().createElement("div",{style:{position:"relative"}},t().createElement(it,Qe({ref:"expirationDate",key:"start",value:e,minDate:new Date,maxDate:void 0,autoOk:!0,onChange:n,showYearSelector:!0,floatingLabelText:c("21"),mode:"landscape",formatDate:this.formatDate,fullWidth:!0},u.textFieldV2,{style:{flex:1},textFieldStyle:Xe(Xe({},u.textFieldV2.style),{},{flex:1})})),r))}}])&&Ze(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(e.Component);function lt(e){return lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lt(e)}function ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,yt(r.key),r)}}function ut(e,t){return ut=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ut(e,t)}function pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ft(e){return ft=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ft(e)}function dt(e,t,n){return(t=yt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yt(e){var t=function(e,t){if("object"!==lt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==lt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===lt(t)?t:String(t)}st=b((0,c.muiThemeable)()(st));var ht=n(689),mt=s().requireLib("components").ResourcePoliciesPanel,bt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ut(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ft(r);if(o){var n=ft(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===lt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return pt(e)}(this,e)});function a(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return dt(pt(e=i.call.apply(i,[this].concat(n))),"submit",(function(){var t=e.props,n=t.model,r=t.pydio,o=n.hasDirtyRootNodes();n.save().then((function(t){e.forceUpdate(),o&&n.getUuid()===r.user.getActiveRepository()&&(r.goTo("/"),r.fireContextRefresh())})).catch((function(e){r.UI.displayMessage("ERROR",e.message)}))})),e}return t=a,n=[{key:"getChildContext",value:function(){var e=this.props.pydio.MessageHash;return{messages:e,getMessage:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"share_center";try{return e[n+(n?".":"")+t]||t}catch(e){return t}},isReadonly:function(){return!1}}}},{key:"render",value:function(){var e=this.props,t=e.pydio,n=e.model,r=e.sendInvitations,o=function(e){return t.MessageHash["share_center."+e]},i={leftStyle:{padding:10},rightStyle:{padding:10},left:[{Label:o("35"),Value:"base",Component:ht.createElement(st,{pydio:t,model:n})},{Label:o(54),Value:"users",Component:ht.createElement(se,{pydio:t,cellAcls:n.getAcls(),excludes:[t.user.id],sendInvitations:r,onUserObjectAdd:n.addUser.bind(n),onUserObjectRemove:n.removeUser.bind(n),onUserObjectUpdateRight:n.updateUserRight.bind(n)})},{Label:o(253),Value:"permissions",AlwaysLast:!0,Component:ht.createElement(mt,{pydio:t,resourceType:"cell",description:o("cell.visibility.advanced"),resourceId:n.getUuid(),style:{margin:-10},skipTitle:!0,onSavePolicies:function(){},readonly:!1,cellAcls:n.getAcls()})}],right:[{Label:o(249),Value:"content",Component:ht.createElement(ve,{pydio:t,model:n,mode:"edit"})}]};return ht.createElement(Ye,{pydio:t,tabs:i,header:ht.createElement("div",{style:{fontSize:20,lineHeight:"26px",padding:6}},n.getLabel()),editorOneColumn:this.props.editorOneColumn,saveEnabled:n.isDirty(),onSaveAction:this.submit.bind(this),onCloseAction:this.props.onDismiss,onRevertAction:function(){n.revertChanges()}})}}],n&&ct(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(ht.Component);dt(bt,"childContextTypes",{messages:i().object,getMessage:i().func,isReadonly:i().func});const vt=require("pydio/http/resources-manager");var gt=n.n(vt);const wt=require("pydio/util/xml");var Ot=n.n(wt);const Et=require("pydio/http/api");var Pt=n.n(Et);const jt=require("cells-sdk");function kt(e){return kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kt(e)}function St(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==kt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==kt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===kt(o)?o:String(o)),r)}var o}var Rt=s().requireLib("boot").moment,xt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"mailerSupported",value:function(e){return e.Parameters.get("validMailer")}},{key:"getAuthorizations",value:function(){var e=s().getInstance(),t=e.getPluginConfigs("action.share"),n={folder_public_link:t.get("ENABLE_FOLDER_PUBLIC_LINK"),folder_workspaces:t.get("ENABLE_FOLDER_INTERNAL_SHARING"),file_public_link:t.get("ENABLE_FILE_PUBLIC_LINK"),file_workspaces:t.get("ENABLE_FILE_INTERNAL_SHARING"),editable_hash:t.get("HASH_USER_EDITABLE"),hash_min_length:t.get("HASH_MIN_LENGTH")||6,password_mandatory:!1,max_expiration:t.get("FILE_MAX_EXPIRATION"),max_downloads:t.get("FILE_MAX_DOWNLOAD")},r=t.get("SHARE_FORCE_PASSWORD");return r&&(n.password_mandatory=!0),n.password_placeholder=r?e.MessageHash["share_center.176"]:e.MessageHash["share_center.148"],n}},{key:"buildPublicUrl",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.Parameters;if(n)return"..."+r.get("PUBLIC_BASEURI")+"/"+t.LinkHash;if(t.LinkUrl&&t.LinkUrl.match(new RegExp("^http://|^https://")))return t.LinkUrl;var o=e.getFrontendUrl();return"".concat(o.protocol,"//").concat(o.host)+r.get("PUBLIC_BASEURI")+"/"+t.LinkHash}},{key:"nodeHasEditor",value:function(e,t){if(!t.getMetadata().has("mime_has_preview_editor")){var n=e.Registry.findEditorsForMime(t.getAjxpMime()),r=(n=n.filter((function(e){return"editor.browser"!==e.id&&"editor.other"!==e.id}))).filter((function(e){return e.canWrite}));t.getMetadata().set("mime_has_preview_editor",n.length>0),t.getMetadata().set("mime_has_writeable_editor",r.length>0)}return{preview:t.getMetadata().get("mime_has_preview_editor"),writeable:t.getMetadata().get("mime_has_writeable_editor")}}},{key:"compileLayoutData",value:function(t,n){var r,o,i=n.getNode();if(i.isLeaf()?(o=i.getAjxpMime(),r=Ot().XPathSelectNodes(t.getXmlRegistry(),"//template[contains(@name, 'unique_preview_')]")):r=Ot().XPathSelectNodes(t.getXmlRegistry(),"//template[contains(@name, 'minisite_')]"),!r.length)return[];if(1===r.length)return[{LAYOUT_NAME:r[0].getAttribute("element"),LAYOUT_LABEL:""}];var a=t.Parameters.get("theme"),s=[];return r.map((function(n){var r=n.getAttribute("theme");if(!r||r===a){var l=n.getAttribute("element"),c=n.getAttribute("name"),u=n.getAttribute("label");o&&"unique_preview_file"===c&&!e.nodeHasEditor(t,i).preview||(u?MessageHash[u]&&(u=MessageHash[u]):u=n.getAttribute("name"),s[c]=l,s.push({LAYOUT_NAME:c,LAYOUT_ELEMENT:l,LAYOUT_LABEL:u}))}})),s}},{key:"forceMailerOldSchool",value:function(){return n.g.pydio.getPluginConfigs("action.share").get("EMAIL_INVITE_EXTERNAL")}},{key:"qrcodeEnabled",value:function(){return n.g.pydio.getPluginConfigs("action.share").get("CREATE_QRCODE")}},{key:"sendCellInvitation",value:function(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i=e.prepareEmail(t,null,n),a=i.templateId,l=i.templateData,c=new jt.MailerMail,u=new jt.MailerServiceApi(Pt().getRestClient());c.To=[];var p=0;Object.keys(r).map((function(e){var t=r[e],n=new jt.MailerUser;return t.IdmUser&&t.IdmUser.Login&&t.IdmUser.Attributes&&(t.IdmUser.Attributes.hasEmail||t.IdmUser.Attributes.email)?(n.Uuid=t.IdmUser.Login,c.To.push(n)):p++,n}));var f=s().getInstance().MessageHash;if(c.To.length){c.TemplateId=a,c.TemplateData=l,u.send(c).then((function(){o()}));var d=f["core.mailer.1"].replace("%s",c.To.length);p>0&&(d+=" "+f["core.mailer.entries.ignored"]),s().getInstance().UI.displayMessage("SUCCESS",d)}else s().getInstance().UI.displayMessage("ERROR",f["core.mailer.entries.ignored"])}},{key:"prepareEmail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r={},o="",i=pydio.user;if(i.getPreference("displayName")?r.Inviter=i.getPreference("displayName"):r.Inviter=i.id,t){var a=t.getLink();if(e.isLeaf()?(o="PublicFile",r.FileName=a.Label||e.getLabel()):(o="PublicFolder",r.FolderName=a.Label||e.getLabel()),r.LinkPath="/public/"+a.LinkHash,a.MaxDownloads&&(r.MaxDownloads=a.MaxDownloads+""),a.AccessEnd){var s=Rt(new Date(1e3*a.AccessEnd));r.Expire=s.format("LL")}}else o="Cell",r.Cell=n.getLabel();return{templateId:o,templateData:r,message:"",linkModel:t}}}],null&&St(t.prototype,null),r&&St(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function _t(e){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_t(e)}function Lt(){return Lt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Lt.apply(this,arguments)}function Mt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==_t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==_t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===_t(o)?o:String(o)),r)}var o}function Ct(e,t){return Ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ct(e,t)}function Tt(e){return Tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Tt(e)}var Dt=s().requireLib("boot").moment,At=s().requireLib("components"),It=At.GenericCard,Ut=At.GenericLine,Nt=At.QuotaUsageLine,Bt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ct(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Tt(o);if(i){var n=Tt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===_t(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={edit:!1,model:new(we()),loading:!0},t._observer=function(){t.forceUpdate()},gt().loadClass("PydioActivityStreams").then((function(e){t.setState({asLib:e})})),gt().loadClass("PydioCoreActions").then((function(e){t.setState({coreActionsLib:e})}));var n=t.props.rootNode;return n&&(n.getMetadata().has("virtual_root")?n.isLoaded()?(t.state.rootNodes=[],n.getChildren().forEach((function(e){return t.state.rootNodes.push(e)}))):(n.observe("loaded",(function(){var e=[];n.getChildren().forEach((function(t){return e.push(t)})),t.setState({rootNodes:e})})),n.load()):t.state.rootNodes=[n]),t}return n=s,(r=[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.pydio,r=t.cellId;n.user.activeRepository===r?n.user.getActiveRepositoryAsCell().then((function(t){e.setState({model:t,loading:!1}),t.observe("update",e._observer)})):(this.state.model.observe("update",(function(){e.setState({loading:!1}),e.forceUpdate()})),this.state.model.load(this.props.cellId))}},{key:"componentWillUnmount",value:function(){this.state.model.stopObserving("update",this._observer)}},{key:"usersInvitations",value:function(e){xt.sendCellInvitation(this.props.node,this.state.model,e)}},{key:"render",value:function(){var e,n=this,r=this.props,o=r.mode,i=r.pydio,a=r.editorOneColumn,s=this.state,c=s.edit,u=s.model,p=s.asLib,f=s.coreActionsLib,d=s.rootNodes,y=s.loading,h=function(e){return i.MessageHash["share_center."+e]},m={width:420,minHeight:270};if(c)m=a?{width:420,height:500}:{width:700,height:500},e=t().createElement(bt,Lt({},this.props,{model:u,sendInvitations:this.usersInvitations.bind(this),editorOneColumn:a}));else if(u){var b,v,g,w=u.getRootNodes().map((function(e){return u.getNodeLabelInContext(e)})).join(", ");w||(w=u.getRootNodes().length+" item(s)"),"infoPanel"!==o&&(g=[],u.getUuid()!==i.user.activeRepository&&g.push(t().createElement(l.MenuItem,{primaryText:h(246),onClick:function(){i.triggerRepositoryChange(u.getUuid()),n.props.onDismiss()}})),u.isEditable()&&(b=function(){u.deleteCell().then((function(e){n.props.onDismiss()}))},v=function(){n.setState({edit:!0}),n.props.onHeightChange&&n.props.onHeightChange(500)},g.push(t().createElement(l.MenuItem,{primaryText:h(247),onClick:function(){return n.setState({edit:!0})}})),g.push(t().createElement(l.MenuItem,{primaryText:h(248),onClick:b}))));var O,E,P,j=[];if(!y&&u.cell&&u.cell.AccessEnd){var k=new Date(1e3*parseInt(u.cell.AccessEnd)),S=k<new Date;P=t().createElement(Ut,{iconClassName:S?"mdi mdi-alert-outline":"mdi mdi-calendar",iconStyle:S?{color:"var(--md-sys-color-error)"}:{},legend:h(S?"21b":"21"),data:Dt(k).calendar()})}if(p&&f&&d&&!y){var R=p.WatchSelector,x=f.BookmarkButton,_=t().createElement(R,{pydio:i,nodes:d,fullWidth:!0});O=t().createElement(Ut,{iconClassName:"mdi mdi-bell-outline",legend:i.MessageHash["meta.watch.selector.legend"],data:_,iconStyle:{marginTop:26},dataStyle:{paddingRight:16,marginTop:-6,marginBottom:6}}),E=t().createElement(x,{pydio:i,nodes:d,styles:{iconStyle:{color:"var(--md-sys-color-primary)"}}})}if(d&&!y&&d.forEach((function(e){e.getMetadata().get("ws_quota")&&j.push(t().createElement(Nt,{node:e}))})),e=t().createElement(It,{pydio:i,title:u.getLabel(),onDismissAction:this.props.onDismiss,otherActions:E,onDeleteAction:b,onEditAction:v,headerSmall:"infoPanel"===o,moreMenuItems:g},!y&&u.getDescription()&&t().createElement(Ut,{iconClassName:"mdi mdi-information",legend:h(145),data:u.getDescription()}),t().createElement(Ut,{iconClassName:"mdi mdi-account-multiple-outline",legend:h(54),data:u.getAclsSubjects(),placeHolder:!0,placeHolderReady:!y}),t().createElement(Ut,{iconClassName:"mdi mdi-folder-multiple-outline",legend:h(249),data:w,placeHolder:!0,placeHolderReady:!y}),P,j,"infoPanel"!==o&&(O||t().createElement(Ut,{placeHolder:!0,placeHolderReady:!y}))),"infoPanel"===o)return e}return t().createElement("div",{style:m},e)}}])&&Mt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);const qt=require("pydio/lang/observable");var Ft=n.n(qt);const Ht=require("pydio/util/pass");var zt=n.n(Ht);function Vt(e){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vt(e)}function Wt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Kt(r.key),r)}}function Yt(e,t){return Yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Yt(e,t)}function Gt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qt(e){return Qt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Qt(e)}function Kt(e){var t=function(e,t){if("object"!==Vt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Vt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Vt(t)?t:String(t)}var Xt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Yt(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Qt(r);if(o){var n=Qt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Vt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Gt(e)}(this,e)});function a(){var e,t,n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),t=Gt(e=i.call(this)),r=void 0,(n=Kt(n="dirty"))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,e.link=new jt.RestShareLink,e.link.Permissions=[jt.RestShareLinkAccessType.constructFromObject("Preview"),jt.RestShareLinkAccessType.constructFromObject("Download")],e.link.Policies=[],e.link.PoliciesContextEditable=!0,e.link.RootNodes=[],e.ValidPassword=!0,e.loadError=null,e}return t=a,(n=[{key:"hasError",value:function(){return this.loadError}},{key:"isEditable",value:function(){return this.link.PoliciesContextEditable}},{key:"isDirty",value:function(){return this.dirty}},{key:"getLinkUuid",value:function(){return this.link.Uuid}},{key:"getLink",value:function(){return this.link}},{key:"getPublicUrl",value:function(){return xt.buildPublicUrl(s().getInstance(),this.link)}},{key:"updateLink",value:function(e){this.link=e,this.notifyDirty()}},{key:"notifyDirty",value:function(){this.dirty=!0,this.notify("update")}},{key:"revertChanges",value:function(){this.originalLink&&(this.link=this.clone(this.originalLink),this.dirty=!1,this.updatePassword=this.createPassword=null,this.ValidPassword=!0,this.notify("update"))}},{key:"hasPermission",value:function(e){return this.link.Permissions.filter((function(t){return t===e})).length>0}},{key:"isExpired",value:function(){return!!(this.link.MaxDownloads&&parseInt(this.link.CurrentDownloads)>=parseInt(this.link.MaxDownloads))||(this.link.AccessEnd,!1)}},{key:"load",value:function(e){var t=this;return new jt.ShareServiceApi(Pt().getRestClient()).getShareLink(e).then((function(e){t.link=e,t.link.Permissions||(t.link.Permissions=[]),t.link.Policies||(t.link.Policies=[]),t.link.RootNodes||(t.link.RootNodes=[]),t.originalLink=t.clone(t.link),t.notify("update")})).catch((function(e){t.loadError=e,t.notify("update")}))}},{key:"setCreatePassword",value:function(e){var t=this;e?zt().checkPasswordStrength(e,(function(e,n){t.ValidPassword=e,t.ValidPasswordMessage=n})):this.ValidPassword=!0,this.createPassword=e,this.link.PasswordRequired=!0,this.notifyDirty()}},{key:"setUpdatePassword",value:function(e){var t=this;e?zt().checkPasswordStrength(e,(function(e,n){t.ValidPassword=e,t.ValidPasswordMessage=n})):this.ValidPassword=!0,this.updatePassword=e,this.notifyDirty()}},{key:"setCustomLink",value:function(e){this.customLink=e}},{key:"save",value:function(){var e=this;if(!this.ValidPassword)throw new Error(this.ValidPasswordMessage);var t=new jt.ShareServiceApi(Pt().getRestClient()),n=new jt.RestPutShareLinkRequest;this.createPassword?(n.PasswordEnabled=!0,n.CreatePassword=this.createPassword):this.updatePassword?(n.PasswordEnabled=!0,this.link.PasswordRequired?n.UpdatePassword=this.updatePassword:n.CreatePassword=this.updatePassword):n.PasswordEnabled=this.link.PasswordRequired;var r=xt.getAuthorizations();if(r.password_mandatory&&!n.PasswordEnabled)throw new Error(s().getMessages()["share_center.175"]);return parseInt(r.max_downloads)>0&&!parseInt(this.link.MaxDownloads)&&(this.link.MaxDownloads=""+parseInt(r.max_downloads),this.notify("update")),parseInt(r.max_expiration)>0&&!parseInt(this.link.AccessEnd)&&(this.link.AccessEnd=""+(Math.round(new Date/1e3)+60*parseInt(r.max_expiration)*60*24),this.notify("update")),this.customLink&&this.customLink!==this.link.LinkHash&&(n.UpdateCustomHash=this.customLink),n.ShareLink=this.link,t.putShareLink(n).then((function(t){e.link=t,e.dirty=!1,e.originalLink=e.clone(e.link),e.updatePassword=e.createPassword=e.customLink=null,e.ValidPassword=!0,e.notify("update"),e.notify("save")})).catch((function(e){var t=e.Detail||e.message||e;s().getInstance().UI.displayMessage("ERROR",t)}))}},{key:"deleteLink",value:function(e){var t=this;return new jt.ShareServiceApi(Pt().getRestClient()).deleteShareLink(this.link.Uuid).then((function(n){t.link=e,t.dirty=!1,t.updatePassword=t.createPassword=t.customLink=null,t.notify("update"),t.notify("delete")})).catch((function(e){var t=e.Detail||e.message||e;pydio.UI.displayMessage("ERROR",t)}))}},{key:"clone",value:function(e){return jt.RestShareLink.constructFromObject(JSON.parse(JSON.stringify(e)))}}])&&Wt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(Ft());function Zt(e){return Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zt(e)}function Jt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,on(r.key),r)}}function $t(){return $t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=nn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},$t.apply(this,arguments)}function en(e,t){return en=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},en(e,t)}function tn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nn(e){return nn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},nn(e)}function rn(e,t,n){return(t=on(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function on(e){var t=function(e,t){if("object"!==Zt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Zt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Zt(t)?t:String(t)}var an=s().requireLib("boot").moment,sn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&en(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=nn(r);if(o){var n=nn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Zt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return tn(e)}(this,e)});function a(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),rn(tn(e=i.call(this)),"cells",void 0),rn(tn(e),"links",void 0),rn(tn(e),"edit",void 0),rn(tn(e),"node",void 0),rn(tn(e),"saving",void 0),e.cells=[],e.links=[],e.edit=t,e}return t=a,n=[{key:"emptyLink",value:function(e){var t,n=this,r=new Xt,o=new jt.TreeNode,i=xt.getAuthorizations();o.Uuid=e.getMetadata().get("uuid"),r.getLink().Label=e.getLabel(),r.getLink().Description=pydio.MessageHash["share_center.257"].replace("%s",an(new Date).format("YYYY/MM/DD")),r.getLink().RootNodes.push(o);var a=[jt.RestShareLinkAccessType.constructFromObject("Download")];return e.isLeaf()?(t="pydio_unique_dl",xt.nodeHasEditor(pydio,e).preview&&!i.max_downloads?(t="pydio_unique_strip",a.push(jt.RestShareLinkAccessType.constructFromObject("Preview"))):i.max_downloads>0&&(r.getLink().MaxDownloads=i.max_downloads)):(t="pydio_shared_folder",a.push(jt.RestShareLinkAccessType.constructFromObject("Preview"))),r.getLink().ViewTemplateName=t,r.getLink().Permissions=a,i.max_expiration&&(r.getLink().AccessEnd=""+(Math.round(new Date/1e3)+60*parseInt(i.max_expiration)*60*24)),r.observe("update",(function(){n.notify("update")})),r.observe("save",(function(){n.updateUnderlyingNode()})),r}},{key:"createEmptyCell",value:function(){var e=this,t=new(we())(!0);t.setLabel(this.node.getLabel()),t.addRootNode(this.node),t.observe("update",(function(){e.notify("update")})),t.dirty=!1,this.cells.push(t),this.notify("update")}},{key:"addToExistingCell",value:function(e){var t=this,n=new(we())(!0);n.observe("update",(function(){t.notify("update")})),n.load(e).then((function(){n.addRootNode(t.node)}));var r=this.cells.filter((function(e){return!e.getUuid()}));r.length&&this.removeNewCell(r[0]),this.cells.push(n)}},{key:"updateUnderlyingNode",value:function(){this.skipUpdateUnderlyingNode||s().getInstance().getContextHolder().requireNodeReload(this.node)}},{key:"deleteLink",value:function(e){var t=this;return e.deleteLink(this.emptyLink(this.node).getLink()).then((function(e){t.updateUnderlyingNode()}))}},{key:"getNode",value:function(){return this.node}},{key:"load",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.node=e,this.cells=[],this.links=[],e.getMetadata().get("pydio_shares")&&JSON.parse(e.getMetadata().get("pydio_shares")).map((function(e){if(3===e.Scope){var n=new Xt;n.observe("update",(function(){t.notify("update")})),n.observe("save",(function(){t.updateUnderlyingNode()})),n.load(e.UUID),t.links.push(n)}else if(2===e.Scope){var r=new(we());r.observe("update",(function(){t.notify("update")})),r.load(e.UUID),t.cells.push(r)}})),this.edit&&!this.links.length&&this.links.push(this.emptyLink(e)),this.edit&&this.canCreateCells()&&!this.cells.length&&this.createEmptyCell(),n&&this.node.observe("node_replaced",(function(){t.load(t.node,!1)}))}},{key:"loadUniqueLink",value:function(e,t){var n=this;this.node=t;var r=new Xt;return r.observe("update",(function(){n.notify("update")})),r.load(e),this.links.push(r),r}},{key:"canCreateCells",value:function(){if(!this.node)return!1;var e=xt.getAuthorizations(),t=this.node.isLeaf();return t&&e.file_workspaces||!t&&e.folder_workspaces}},{key:"save",value:function(){var e=this;this.saving=!0,this.notify("update");var t=[];this.cells.map((function(e){e.isDirty()&&t.push(e.save())})),this.links.map((function(e){e.isDirty()&&t.push(e.save())})),Promise.all(t).then((function(){var t=e.node.getMetadata().get("uuid");e.cells=e.cells.filter((function(e){return e.hasRootNode(t)})),e.updateUnderlyingNode(),e.saving=!1})).catch((function(t){e.updateUnderlyingNode(),e.saving=!1}))}},{key:"deleteAll",value:function(){var e=this.node.getMetadata().get("uuid"),t=[];return this.cells.map((function(n){n.removeRootNode(e),t.push(n.save())})),this.links.map((function(e){t.push(e.deleteLink())})),Promise.all(t)}},{key:"removeNewCell",value:function(e){this.cells=this.cells.filter((function(t){return t!==e})),this.notify("update")}},{key:"revertChanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.cells=this.cells.filter((function(e){return e.getUuid()})),this.cells.map((function(e){e.isDirty()&&e.revertChanges()})),this.links.map((function(e){e.isDirty()&&e.revertChanges()})),!this.cells.length&&e&&this.canCreateCells()&&this.createEmptyCell(),this.notify("update")}},{key:"isDirty",value:function(){return!this.saving&&this.cells.filter((function(e){return e.isDirty()})).length||this.links.filter((function(e){return e.isDirty()})).length}},{key:"stopObserving",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.cells.map((function(e){e.stopObserving("update")})),this.links.map((function(e){e.stopObserving("update")})),$t(nn(a.prototype),"stopObserving",this).call(this,e,t)}},{key:"getCells",value:function(){if(this.node){var e=this.node.getMetadata().get("uuid");return this.cells.filter((function(t){return t.hasRootNode(e)}))}return this.cells}},{key:"getLinks",value:function(){return this.links}}],n&&Jt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(Ft());const ln=require("react-dom");var cn=n.n(ln);const un=require("clipboard");var pn=n.n(un);function fn(e){return fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fn(e)}function dn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dn(Object(n),!0).forEach((function(t){hn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function hn(e,t,n){return(t=gn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,gn(r.key),r)}}function vn(e,t,n){return t&&bn(e.prototype,t),n&&bn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function gn(e){var t=function(e,t){if("object"!==fn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==fn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===fn(t)?t:String(t)}function wn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&On(e,t)}function On(e,t){return On=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},On(e,t)}function En(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Pn(e);if(t){var o=Pn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===fn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function Pn(e){return Pn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Pn(e)}var jn=function(e){wn(o,e);var r=En(o);function o(e){var t;return mn(this,o),(t=r.call(this,e)).state={copyMessage:""},t}return vn(o,[{key:"componentDidMount",value:function(){this._clip&&this._clip.destroy(),this._button&&(this._clip=new(pn())(this._button,{text:function(e){return this.props.link}.bind(this)}),this._clip.on("success",function(){this.setState({copyMessage:this.props.getMessage("192")},this.clearCopyMessage)}.bind(this)),this._clip.on("error",function(){var e;e=0===n.g.navigator.platform.indexOf("Mac")?this.props.getMessage("144"):this.props.getMessage("share_center.143"),this.setState({copyMessage:e},this.clearCopyMessage)}.bind(this)))}},{key:"componentWillUnmount",value:function(){this._clip&&this._clip.destroy()}},{key:"clearCopyMessage",value:function(){setTimeout(function(){this.setState({copyMessage:""})}.bind(this),5e3)}},{key:"render",value:function(){var e=this,n=this.props,r=n.targetUser,o=n.link;return t().createElement("div",{style:{display:"flex"}},t().createElement("div",{style:{flex:1}},r.Display,t().createElement(l.IconButton,{pydio:this.props.pydio,ref:function(t){e._button=cn().findDOMNode(t)},iconClassName:"mdi mdi-link",tooltip:this.state.copyMessage||o,iconStyle:{fontSize:13,lineHeight:"17px"},style:{width:34,height:34,padding:6}})),t().createElement("div",{style:{width:40,textAlign:"center"}},r.DownloadCount))}}]),o}(t().Component),kn=function(e){wn(r,e);var n=En(r);function r(e,t){var o;return mn(this,r),(o=n.call(this,e,t)).state={open:!1},o}return vn(r,[{key:"render",value:function(){var e,n=this,r=this.props.linkModel,o=r.getLink();o.TargetUsers&&(e=o.TargetUsers);var i=Object.keys(e).map((function(n){var o=r.getPublicUrl()+"?u="+n;return t().createElement(jn,{targetUser:e[n],link:o})}));if(!i.length)return null;var a={borderBottom:this.state.open?"1px solid #757575":"",color:"rgba(0, 0, 0, 0.36)"};return t().createElement("div",{style:{lineHeight:"34px",padding:"4px 10px 4px",fontSize:14,backgroundColor:"#fafafa",borderRadius:2}},t().createElement("div",{style:yn({display:"flex"},a)},t().createElement("div",{style:{flex:1}},this.props.getMessage("245").replace("%s",i.length)," ",t().createElement("span",{className:"mdi mdi-chevron-"+(this.state.open?"up":"down"),style:{cursor:"pointer"},onClick:function(){n.setState({open:!n.state.open})}})),this.state.open&&t().createElement("div",{style:{width:40,textAlign:"center"}},"#DL")),this.state.open&&t().createElement("div",null,i))}}]),r}(t().Component);kn.propTypes={linkModel:i().instanceOf(Xt)},kn=b(kn),jn=b(jn);const Sn=require("qrcode.react");var Rn=n.n(Sn);const xn=require("pydio/util/path");var _n=n.n(xn);const Ln=require("pydio/util/lang");var Mn=n.n(Ln);function Cn(e){return Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cn(e)}function Tn(){return Tn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Tn.apply(this,arguments)}function Dn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Bn(r.key),r)}}function An(e,t){return An=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},An(e,t)}function In(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Un(e){return Un=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Un(e)}function Nn(e,t,n){return(t=Bn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Bn(e){var t=function(e,t){if("object"!==Cn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Cn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Cn(t)?t:String(t)}var qn=s().requireLib("hoc").ThemedModernStyles,Fn=s().requireLib("boot").Tooltip,Hn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&An(e,t)}(c,e);var r,o,i,a,s=(i=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Un(i);if(a){var n=Un(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Cn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return In(e)}(this,e)});function c(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return Nn(In(e=s.call.apply(s,[this].concat(r))),"state",{editLink:!1,copyMessage:"",showQRCode:!1}),Nn(In(e),"toggleEditMode",(function(){var t=e.props,n=t.linkModel,r=t.pydio;if(e.state.editLink&&e.state.customLink){var o=xt.getAuthorizations();if(o.hash_min_length&&e.state.customLink.length<o.hash_min_length)return void r.UI.displayMessage("ERROR",e.props.getMessage("223").replace("%s",o.hash_min_length));n.setCustomLink(e.state.customLink),n.save()}e.setState({editLink:!e.state.editLink,customLink:void 0})})),Nn(In(e),"changeLink",(function(t){var n=t.target.value;n=Mn().computeStringSlug(n),e.setState({customLink:n})})),Nn(In(e),"clearCopyMessage",(function(){n.g.setTimeout(function(){this.setState({copyMessage:""})}.bind(In(e)),5e3)})),Nn(In(e),"attachClipboard",(function(){var t=e.props,r=t.linkModel,o=t.pydio;e.detachClipboard(),e.refs["copy-button"]&&(e._clip=new(pn())(e.refs["copy-button"],{text:function(e){return xt.buildPublicUrl(o,r.getLink())}.bind(In(e))}),e._clip.on("success",function(){this.setState({copyMessage:this.props.getMessage("192")},this.clearCopyMessage)}.bind(In(e))),e._clip.on("error",function(){var e;e=0===n.g.navigator.platform.indexOf("Mac")?this.props.getMessage("144"):this.props.getMessage("143"),this.refs["public-link-field"].focus(),this.setState({copyMessage:e},this.clearCopyMessage)}.bind(In(e))))})),Nn(In(e),"detachClipboard",(function(){e._clip&&e._clip.destroy()})),Nn(In(e),"openMailer",(function(){e.props.showMailer(e.props.linkModel)})),Nn(In(e),"toggleQRCode",(function(){e.setState({showQRCode:!e.state.showQRCode})})),e}return r=c,(o=[{key:"componentDidUpdate",value:function(e,t){this.attachClipboard()}},{key:"componentDidMount",value:function(){this.attachClipboard()}},{key:"componentWillUnmount",value:function(){this.detachClipboard()}},{key:"confirmDisable",value:function(){var e=this.props.onDisableLink;confirm(this.props.getMessage("dialog.link.confirm.remove"))&&e()}},{key:"render",value:function(){var e=this,n=this.props,r=n.linkModel,o=n.pydio,i=xt.buildPublicUrl(o,r.getLink()),a=xt.getAuthorizations(),s=this.props.editAllowed&&a.editable_hash&&!this.props.isReadonly()&&r.isEditable();if(this.state.editLink&&s)return t().createElement("div",null,t().createElement("div",{style:{display:"flex",alignItems:"center",padding:6,borderRadius:2}},t().createElement("span",{style:{fontSize:16,display:"inline-block",maxWidth:160,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},_n().getDirname(i)+"/ "),t().createElement(l.TextField,{style:{flex:1,marginRight:10,marginLeft:10},autoFocus:!0,onChange:this.changeLink,value:void 0!==this.state.customLink?this.state.customLink:r.getLink().LinkHash}),t().createElement(J,{mdiIcon:"check",callback:this.toggleEditMode})),t().createElement("div",{style:{textAlign:"center",fontSize:13,opacity:.73,paddingTop:16}},this.props.getMessage("194")));var c,u=this.state,p=u.copyMessage,f=u.linkTooltip,d=[],y=this.props.muiTheme,h=t().createElement("div",{key:"copy",ref:"copy-button",style:{position:"absolute",right:0,bottom:7,width:30,height:30,padding:4,backgroundColor:"transparent",fontSize:16,cursor:"pointer"},onMouseOver:function(){e.setState({linkTooltip:!0})},onMouseOut:function(){e.setState({linkTooltip:!1})}},t().createElement(Fn,{label:p||this.props.getMessage("191"),horizontalPosition:"left",verticalPosition:"bottom",show:f}),t().createElement("span",{className:"copy-link-button mdi mdi-content-copy",style:{color:y.palette.mui3.primary}}));return this.props.showMailer&&d.push(t().createElement(J,{key:"outline",callback:this.openMailer,mdiIcon:"email-outline",messageId:"45"})),s&&d.push(t().createElement(J,{key:"pencil",callback:this.toggleEditMode,mdiIcon:"pencil",messageId:"193"})),xt.qrcodeEnabled()&&d.push(t().createElement(J,{key:"qrcode",callback:this.toggleQRCode,mdiIcon:"qrcode",messageId:"94"})),this.props.onDisableLink&&d.push(t().createElement(J,{key:"delete",destructive:!0,callback:function(){return e.confirmDisable()},mdiIcon:"link-off",messageId:"link.disable"})),d=d.length?t().createElement("div",{style:{display:"flex",marginTop:10}},t().createElement("span",{style:{flex:1}}),d,t().createElement("span",{style:{flex:1}})):null,c=this.state.showQRCode?t().createElement(l.Paper,{zDepth:1,style:{width:120,paddingTop:10,overflow:"hidden",margin:"0 auto",height:120,textAlign:"center"}},t().createElement(Rn(),{size:100,value:i,level:"Q"})):t().createElement(l.Paper,{zDepth:0,style:{width:120,overflow:"hidden",margin:"0 auto",height:0,textAlign:"center"}}),t().createElement("div",{className:"public-link-container"},t().createElement("div",{style:{marginTop:-8,position:"relative"}},t().createElement(l.TextField,Tn({floatingLabelText:this.props.getMessage("link.floatingLabel"),floatingLabelFixed:!0,type:"text",name:"Link",ref:"public-link-field",value:i,onFocus:function(e){e.target.select()},fullWidth:!0},qn(y).textFieldV2)),h),!1,d,c)}}])&&Dn(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),c}(t().Component);function zn(e){return zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zn(e)}function Vn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Kn(r.key),r)}}function Wn(e,t){return Wn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Wn(e,t)}function Yn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Gn(e){return Gn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Gn(e)}function Qn(e,t,n){return(t=Kn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Kn(e){var t=function(e,t){if("object"!==zn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==zn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===zn(t)?t:String(t)}function Xn(e,t,n){var r,o=[];return t.hasPermission("Preview")&&o.push(n("72")),t.hasPermission("Download")&&o.push(n("73")),t.hasPermission("Upload")&&(e.getNode().isLeaf()?o.push(n("74b")):o.push(n("74"))),o.length&&(r=o.join(", ").toLowerCase()),{title:n("71"),legend:r}}Nn(Hn,"propTypes",{linkModel:i().instanceOf(Xt),editAllowed:i().bool,onChange:i().func,showMailer:i().func}),Hn=b(Hn=(0,c.muiThemeable)()(Hn));var Zn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Wn(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Gn(o);if(i){var n=Gn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===zn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Yn(e)}(this,e)});function s(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Qn(Yn(e=a.call.apply(a,[this].concat(n))),"changePermission",(function(t){var n=t.target.name,r=t.target.checked,o=e.props,i=o.compositeModel,a=o.linkModel,s=a.getLink();if(r?s.Permissions.push(jt.RestShareLinkAccessType.constructFromObject(n)):s.Permissions=s.Permissions.filter((function(e){return e!==n})),i.getNode().isLeaf()){var l=xt.getAuthorizations().max_downloads;a.hasPermission("Preview")?(s.ViewTemplateName="pydio_unique_strip",s.MaxDownloads=0):(s.ViewTemplateName="pydio_unique_dl",l&&!s.MaxDownloads&&(s.MaxDownloads=l))}e.props.linkModel.updateLink(s)})),e}return n=s,(r=[{key:"render",value:function(){var e=this.props,n=e.linkModel,r=e.compositeModel,o=e.pydio,i=r.getNode(),a=[],s=xt.getAuthorizations();if(i.isLeaf()){var c=xt.nodeHasEditor(o,i),u=c.preview,p=c.writeable;a.push({NAME:"Download",LABEL:this.props.getMessage("73"),DISABLED:!u||!n.hasPermission("Preview")}),u&&!s.max_downloads&&(a.push({NAME:"Preview",LABEL:this.props.getMessage("72"),DISABLED:!n.hasPermission("Download")}),n.hasPermission("Preview")&&p&&a.push({NAME:"Upload",LABEL:this.props.getMessage("74b")}))}else a.push({NAME:"Preview",LABEL:this.props.getMessage("72"),DISABLED:!n.hasPermission("Upload")}),a.push({NAME:"Download",LABEL:this.props.getMessage("73")}),a.push({NAME:"Upload",LABEL:this.props.getMessage("74")});return t().createElement("div",null,a.map(function(e){return t().createElement(l.Checkbox,{key:e.NAME,disabled:e.DISABLED||this.props.isReadonly()||!n.isEditable(),type:"checkbox",name:e.NAME,label:e.LABEL,onCheck:this.changePermission,checked:n.hasPermission(e.NAME),labelStyle:{whiteSpace:"nowrap"},style:{margin:"10px 0"}})}.bind(this)),void 0)}}])&&Vn(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);function Jn(e){return Jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jn(e)}function $n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function er(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$n(Object(n),!0).forEach((function(t){ar(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$n(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function tr(){return tr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},tr.apply(this,arguments)}function nr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,sr(r.key),r)}}function rr(e,t){return rr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},rr(e,t)}function or(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ir(e){return ir=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ir(e)}function ar(e,t,n){return(t=sr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sr(e){var t=function(e,t){if("object"!==Jn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Jn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Jn(t)?t:String(t)}Qn(Zn,"propTypes",{linkModel:i().instanceOf(Xt),style:i().object}),Zn=b(Zn);var lr=s().requireLib("form").ValidPassword,cr=s().requireLib("hoc"),ur=cr.ThemedContainers.Popover,pr=cr.ModernTextField,fr=cr.ThemedModernStyles,dr=cr.DatePicker,yr=s().requireLib("boot").moment,hr={iconButton:{style:{width:40,height:40,padding:6},iconStyle:{color:"rgba(0,0,0,.5)",fontSize:20}},leftIcon:{margin:"0 16px 0 4px",color:"#757575"}},mr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rr(e,t)}(c,e);var n,r,o,i,a=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ir(o);if(i){var n=ir(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Jn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return or(e)}(this,e)});function c(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return ar(or(e=a.call.apply(a,[this].concat(r))),"state",{}),ar(or(e),"updateDLExpirationField",(function(t){var n=t.currentTarget.value;parseInt(n)<0&&(n=-parseInt(n));var r=e.props.linkModel,o=r.getLink();o.MaxDownloads=n,r.updateLink(o)})),ar(or(e),"updateDaysExpirationField",(function(t,n){n||(n=t.currentTarget.getValue());var r=e.props.linkModel,o=r.getLink();o.AccessEnd=n,r.updateLink(o)})),ar(or(e),"onDateChange",(function(t,n){var r=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate());e.updateDaysExpirationField(t,Math.floor(r/1e3)+"")})),ar(or(e),"resetPassword",(function(){var t=e.props.linkModel;t.setUpdatePassword(""),t.getLink().PasswordRequired=!1,t.notifyDirty()})),ar(or(e),"setUpdatingPassword",(function(t){zt().checkPasswordStrength(t,(function(n,r){e.setState({updatingPassword:t,updatingPasswordValid:n})}))})),ar(or(e),"changePassword",(function(){var t=e.props.linkModel,n=e.state.updatingPassword;t.setUpdatePassword(n),e.setState({pwPop:!1,updatingPassword:"",updatingPasswordValid:!1}),t.notifyDirty()})),ar(or(e),"updatePassword",(function(t,n){var r=e.props.linkModel;e.state.validPasswordStatus?e.setState({invalidPassword:null,invalid:!1},(function(){r.setUpdatePassword(t)})):e.setState({invalidPassword:t,invalid:!0})})),ar(or(e),"resetDownloads",(function(){if(window.confirm(e.props.getMessage("106"))){var t=e.props.linkModel;t.getLink().CurrentDownloads="0",t.notifyDirty()}})),ar(or(e),"resetExpiration",(function(){var t=e.props.linkModel;t.getLink().AccessEnd="0",t.notifyDirty()})),ar(or(e),"renderPasswordContainer",(function(){var n,r,o,i=e.props.linkModel,a=i.getLink(),c=xt.getAuthorizations();return a.PasswordRequired?(e.props.isReadonly()||!i.isEditable()||c.password_mandatory||(r=t().createElement(l.IconButton,tr({iconClassName:"mdi mdi-close-circle",onClick:e.resetPassword,tooltip:e.props.getMessage("174")},hr.iconButton))),!e.props.isReadonly()&&i.isEditable()&&(o=t().createElement("div",null,t().createElement(l.IconButton,tr({iconClassName:"mdi mdi-pencil",onClick:function(t){e.setState({pwPop:!0,pwAnchor:t.currentTarget})},tooltip:e.props.getMessage("181")},hr.iconButton)),t().createElement(ur,{open:e.state.pwPop,anchorEl:e.state.pwAnchor,anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},onRequestClose:function(){e.setState({pwPop:!1})}},t().createElement("div",{style:{width:380,padding:8}},t().createElement(lr,{name:"update",ref:"pwdUpdate",attributes:{label:e.props.getMessage("23")},value:e.state.updatingPassword?e.state.updatingPassword:"",onChange:function(t){e.setUpdatingPassword(t)},onValidStatusChange:function(t){return e.setState({updatingPasswordDiffer:!t})},variant:"v2"}),t().createElement("div",{style:{paddingTop:20,textAlign:"right"}},t().createElement(l.FlatButton,{label:s().getMessages()[54],onClick:function(){e.setState({pwPop:!1,updatingPassword:""})}}),t().createElement(l.FlatButton,{style:{minWidth:60},label:s().getMessages()[48],onClick:function(){e.changePassword()},disabled:!e.state.updatingPassword||!e.state.updatingPasswordValid||e.state.updatingPasswordDiffer})))))),n=t().createElement(pr,{floatingLabelText:e.props.getMessage("23"),disabled:!0,value:"********",fullWidth:!0,variant:"v2"})):!e.props.isReadonly()&&i.isEditable()&&(n=t().createElement(lr,{name:"share-password",ref:"pwd",attributes:{label:e.props.getMessage("23")},value:e.state.invalidPassword?e.state.invalidPassword:i.updatePassword,onChange:e.updatePassword.bind(or(e)),onValidStatusChange:function(t){e.setState({validPasswordStatus:t})},variant:"v2"})),n?t().createElement("div",{className:"password-container",style:{display:"flex",alignItems:"baseline",width:"100%",position:"relative"}},t().createElement("div",{style:{width:"100%",display:"inline-block"}},n),(r||o)&&t().createElement("div",{style:{position:"absolute",right:0,bottom:0,display:"flex"}},o,r)):null})),ar(or(e),"formatDate",(function(t){return e.props.getMessage("date_format","").split(" ").shift().replace("Y",t.getFullYear()).replace("m",t.getMonth()+1).replace("d",t.getDate())})),e}return n=c,(r=[{key:"render",value:function(){var e,n,r,o,i=this.props,a=i.linkModel,s=i.muiTheme,c=a.getLink(),u=this.renderPasswordContainer(),p=a.hasPermission("Download")&&!a.hasPermission("Preview")&&!a.hasPermission("Upload"),f=parseInt(c.MaxDownloads),d=parseInt(c.AccessEnd),y=!1,h=!1,m=new Date,b=xt.getAuthorizations();if(parseInt(b.max_expiration)>0&&(r=new Date).setDate(m.getDate()+parseInt(b.max_expiration)),parseInt(b.max_downloads)>0&&(f=Math.max(1,Math.min(f,parseInt(b.max_downloads)))),d&&(d<0&&(y=!0),n=new Date(1e3*d),parseInt(b.max_expiration)||(e=t().createElement(l.IconButton,{iconStyle:hr.iconButton.iconStyle,style:er(er({},hr.iconButton.style),{},{position:"absolute",right:0,bottom:0,zIndex:1}),iconClassName:"mdi mdi-close-circle",onClick:this.resetExpiration.bind(this)}))),f){var v,g=parseInt(c.CurrentDownloads)||0;g&&(v=t().createElement("a",{style:{cursor:"pointer"},onClick:this.resetDownloads.bind(this),title:this.props.getMessage("17")},"(",this.props.getMessage("16"),")"),g>=f&&(h=!0)),o=t().createElement("span",{className:"dlCounterString"},g+"/"+f," ",v)}var w={fontSize:13,fontWeight:500,color:s.palette.mui3["on-surface-variant"]},O=fr(s);return t().createElement("div",null,u,t().createElement("div",{style:{display:"flex",alignItems:"baseline",position:"relative"},className:y?"limit-block-expired":null},t().createElement(dr,tr({ref:"expirationDate",key:"start",value:n,minDate:new Date,maxDate:r,autoOk:!0,disabled:this.props.isReadonly()||!a.isEditable(),onChange:this.onDateChange,showYearSelector:!0,floatingLabelText:this.props.getMessage(y?"21b":"21"),mode:"landscape",formatDate:this.formatDate,fullWidth:!0},O.textFieldV2,{style:{flex:1},textFieldStyle:er(er({},O.textFieldV2.style),{},{flex:1})})),e),t().createElement("div",{style:{alignItems:"baseline",display:p?"flex":"none",position:"relative"},className:h?"limit-block-expired":null},t().createElement(pr,{type:"number",disabled:this.props.isReadonly()||!a.isEditable(),floatingLabelText:this.props.getMessage(h?"22b":"22"),value:f>0?f:"",onChange:this.updateDLExpirationField,fullWidth:!0,style:{flex:1},variant:"v2"}),t().createElement("span",{style:er({position:"absolute",right:10,top:14},w)},o)))}}])&&nr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),c}(t().Component);function br(e){return br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},br(e)}function vr(){return vr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},vr.apply(this,arguments)}function gr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gr(Object(n),!0).forEach((function(t){Or(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Or(e,t,n){return(t=kr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Er(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,kr(r.key),r)}}function jr(e,t,n){return t&&Pr(e.prototype,t),n&&Pr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function kr(e){var t=function(e,t){if("object"!==br(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==br(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===br(t)?t:String(t)}function Sr(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Rr(e,t)}function Rr(e,t){return Rr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Rr(e,t)}function xr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Lr(e);if(t){var o=Lr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===br(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _r(e)}(this,n)}}function _r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Lr(e){return Lr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Lr(e)}ar(mr,"propTypes",{linkModel:i().instanceOf(Xt).isRequired,style:i().object}),mr=b((0,c.muiThemeable)()(mr));var Mr=s().requireLib("form").ValidPassword,Cr=s().requireLib("hoc").ThemedModernStyles,Tr=function(e){Sr(r,e);var n=xr(r);function r(e){var t;return Er(this,r),(t=n.call(this,e)).state={active:!!e.active},t}return jr(r,[{key:"render",value:function(){var e=this,n=this.props,r=n.title,o=n.legend,i=n.children,a=this.state.active,s={title:{cursor:"pointer",fontSize:15,padding:16,paddingBottom:a?8:16,display:"flex",alignItems:"center",fontWeight:a?500:null},legend:{opacity:.4,fontSize:12,fontWeight:500,fontStyle:"italic"},content:{padding:"0 16px 8px"},chevron:{fontSize:24,color:"rgba(0,0,0,.3)",transition:"transform 250ms ease",transform:a?"rotate(90deg)":""}};return t().createElement(t().Fragment,null,t().createElement("div",{style:wr({},s.title),onClick:function(){e.setState({active:!a})}},t().createElement("span",{style:{flex:1}},r,o&&t().createElement("span",{style:s.legend}," - ",o)),t().createElement("span",{className:"mdi mdi-chevron-right",style:s.chevron})),a&&t().createElement("div",{style:wr({},s.content)},i))}}]),r}(t().Component),Dr=function(e){Sr(r,e);var n=xr(r);function r(){var e;Er(this,r);for(var t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];return Or(_r(e=n.call.apply(n,[this].concat(o))),"state",{showTemporaryPassword:!1,temporaryPassword:null,saving:!1}),Or(_r(e),"toggleLink",(function(){var t=e.props,n=t.linkModel;t.pydio,e.state.showTemporaryPassword?e.setState({showTemporaryPassword:!1,temporaryPassword:null}):!n.getLinkUuid()&&xt.getAuthorizations().password_mandatory?e.setState({showTemporaryPassword:!0,temporaryPassword:""}):(e.setState({saving:!0}),n.getLinkUuid()?e.props.compositeModel.deleteLink(n).catch((function(){e.setState({saving:!1})})).then((function(){e.setState({saving:!1})})):n.save().catch((function(){e.setState({saving:!1})})).then((function(){e.setState({saving:!1})})))})),Or(_r(e),"updateTemporaryPassword",(function(t,n){void 0===t&&(t=n.currentTarget.getValue()),e.setState({temporaryPassword:t})})),Or(_r(e),"enableLinkWithPassword",(function(){var t=e.props.linkModel;if(e.state.temporaryPasswordState){t.setCreatePassword(e.state.temporaryPassword);try{t.save()}catch(t){e.props.pydio.UI.displayMessage("ERROR",t.message)}e.setState({showTemporaryPassword:!1,temporaryPassword:null})}else e.props.pydio.UI.displayMessage("ERROR","Invalid Password")})),e}return jr(r,[{key:"render",value:function(){var e,n,r,o=this,i=this.props,a=i.linkModel,s=i.pydio,c=i.compositeModel,u=i.toggleOnly,p=i.additionalPanes,f=i.muiTheme,d=this.state,y=d.showTemporaryPassword,h=d.temporaryPassword,m=d.saving,b=xt.getAuthorizations(),v=c.getNode().isLeaf(),g=v&&b.file_public_link||!v&&b.folder_public_link,w={fontSize:13,fontWeight:500,color:f.palette.mui3["on-surface-variant"],padding:8,paddingTop:0};return a.getLinkUuid()?(this.props.isReadonly()||m||!a.isEditable()||!a.getLinkUuid()&&!g||(r=function(){return o.toggleLink()}),n=t().createElement(Hn,{pydio:s,linkModel:a,showMailer:this.props.showMailer,editAllowed:b.editable_hash&&a.isEditable(),onDisableLink:r,key:"public-link"}),e=[t().createElement(l.Divider,null),t().createElement(Tr,Xn(c,a,this.props.getMessage),t().createElement(Zn,{compositeModel:c,linkModel:a,pydio:s,key:"public-perm"}))],a.getLink().TargetUsers&&(e.push(t().createElement(l.Divider,null)),e.push(t().createElement(kn,{linkModel:a,pydio:s}))),e.push(t().createElement(l.Divider,null)),e.push(t().createElement(Tr,function(e,n,r){r("link.secure.title");var o,i,a=[],s=n.getLink();if(s.AccessEnd&&0!==parseInt(s.AccessEnd)){var l=new Date(1e3*parseInt(s.AccessEnd)),c=new Date,u=r("link.secure.expires");l<c&&(u=r("link.secure.expired"),o=t().createElement("span",{className:"mdi mdi-alert"})),a.push(u+" "+yr(l).fromNow())}return s.PasswordRequired&&a.push(r("link.secure.hasPassword")),s.MaxDownloads>0&&a.push(r("link.secure.maxdownloads").replace("%d",s.MaxDownloads)),a.length&&(i=t().createElement(t().Fragment,null,o,a.join(", "))),{title:r("link.secure.title"),legend:i}}(0,a,this.props.getMessage),t().createElement(mr,{pydio:s,linkModel:a}))),p&&p.forEach((function(n){e.push(t().createElement(l.Divider,null)),e.push(t().createElement(Tr,{title:n.title,legend:n.legend},n.content))}))):n=y?t().createElement("div",null,t().createElement("div",{className:"section-legend",style:{marginTop:20}},this.props.getMessage("215")),t().createElement("div",{style:{width:"100%"}},t().createElement(Mr,{attributes:{label:this.props.getMessage("23")},value:h,onChange:this.updateTemporaryPassword.bind(this),onValidStatusChange:function(e){return o.setState({temporaryPasswordState:e})},variant:"v2"})),t().createElement("div",{style:{textAlign:"center",marginTop:20}},t().createElement(l.RaisedButton,{label:this.props.getMessage("92"),secondary:!0,onClick:this.enableLinkWithPassword.bind(this),disabled:!this.state.temporaryPasswordState}))):g?t().createElement("div",{style:w},this.props.getMessage("190")):t().createElement("div",{style:w},this.props.getMessage(v?"225":"226")),t().createElement("div",{style:this.props.style},!(a.getLinkUuid()||y)&&t().createElement("div",{style:{padding:16}},t().createElement(l.Toggle,vr({disabled:this.props.isReadonly()||m||!a.isEditable()||!a.getLinkUuid()&&!g,onToggle:this.toggleLink,toggled:a.getLinkUuid()||y,label:this.props.getMessage("189")},Cr(f).toggleFieldV2))),m&&t().createElement("div",{style:{width:"100%",height:300,display:"flex",alignItems:"center",justifyContent:"center"}},t().createElement(l.CircularProgress,null)),!u&&!m&&t().createElement("div",{style:{padding:16}},n),!u&&!m&&e)}}]),r}(t().Component);function Ar(e){return Ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ar(e)}function Ir(){return Ir=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ir.apply(this,arguments)}function Ur(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Nr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ur(Object(n),!0).forEach((function(t){Br(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ur(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Br(e,t,n){return(t=Fr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Fr(r.key),r)}}function Fr(e){var t=function(e,t){if("object"!==Ar(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Ar(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Ar(t)?t:String(t)}function Hr(e,t){return Hr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Hr(e,t)}function zr(e){return zr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},zr(e)}Or(Dr,"propTypes",{linkModel:i().instanceOf(Xt),compositeModel:i().instanceOf(sn),pydio:i().instanceOf(s()),authorizations:i().object,showMailer:i().func}),Dr=b((0,c.muiThemeable)()(Dr));var Vr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Hr(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=zr(o);if(i){var n=zr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Ar(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={mailerData:null},t}return n=s,r=[{key:"componentWillReceiveProps",value:function(e){var t=this,n=e.subject,r=e.message,o=(e.users,e.linkModel),i=e.templateId;if(e.templateData,n||i){if(xt.forceMailerOldSchool()){var a=encodeURIComponent(n);return void(location.href="mailto:custom-email@domain.com?Subject="+a+"&Body="+r)}gt().loadClass("PydioMailer").then((function(n){t.setState({mailerData:Nr(Nr({},e),{},{enableIdentification:o&&o.getLink().TargetUsers,identifiedOnly:o&&o.getLink().RestrictToTargetUsers,crippleIdentificationKeys:!0}),MailerPanel:n.Pane})}))}else this.setState({mailerData:null})}},{key:"toggleMailerData",value:function(e){this.setState({mailerData:Nr(Nr({},this.state.mailerData),e)})}},{key:"dismissMailer",value:function(){this.props.onDismiss()}},{key:"mailerProcessPost",value:function(e,t,n,r,o,i){var a=this.state.mailerData,s=a.crippleIdentificationKeys,l=a.identifiedOnly,c=a.linkModel,u=c.getLink();u.TargetUsers||(u.TargetUsers={}),u.RestrictToTargetUsers=l;var p={};Object.keys(t).forEach((function(e){var n=s?Math.random().toString(36).substring(7):e;u.TargetUsers[n]=jt.RestShareLinkTargetUser.constructFromObject({Display:t[e].getLabel(),DownloadCount:0}),p[n]=e})),c.updateLink(u),c.save().then((function(){var t=new e,o=c.getPublicUrl(),a=new RegExp(o,"g");Object.keys(p).forEach((function(e){var i=o+"?u="+e,s=r.replace(a,i);t.addTarget(p[e],n,s)})),t.post((function(e){i(e)}))}))}},{key:"getMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"share_center";return this.props.pydio.MessageHash[t+(t?".":"")+e]}},{key:"render",value:function(){var e=this.state,n=e.mailerData,r=e.MailerPanel;if(!n)return null;var o=this.props.muiTheme;return t().createElement(r,Ir({},n,{onDismiss:this.dismissMailer.bind(this),overlay:!0,className:"share-center-mailer",panelTitle:this.props.pydio.MessageHash["share_center.45"],additionalPaneTop:void 0,processPost:n.enableIdentification?this.mailerProcessPost.bind(this):null,style:{width:420,margin:"0 auto",background:o.palette.mui3["surface-3"]}}))}}],r&&qr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);function Wr(e){return Wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wr(e)}function Yr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Wr(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Wr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===Wr(o)?o:String(o)),r)}var o}function Gr(e,t){return Gr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Gr(e,t)}function Qr(e){return Qr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Qr(e)}Vr=(0,c.muiThemeable)()(Vr);var Kr=s().requireLib("hoc").ModernSelectField,Xr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Gr(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Qr(o);if(i){var n=Qr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Wr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return n=s,(r=[{key:"onDropDownChange",value:function(e,t,n){var r=this.props.linkModel;r.getLink().ViewTemplateName=n,r.notifyDirty()}},{key:"render",value:function(){var e,n=this.props,r=n.linkModel,o=n.hideTitle,i=n.muiTheme,a=r.getLink().ViewTemplateName,s=this.props.layoutData.map((function(n){return a&&n.LAYOUT_ELEMENT===a&&(e=n.LAYOUT_LABEL),a||e||(a=n.LAYOUT_ELEMENT,e=n.LAYOUT_LABEL),t().createElement(l.MenuItem,{key:n.LAYOUT_ELEMENT,value:n.LAYOUT_ELEMENT,primaryText:n.LAYOUT_LABEL})})),c={fontSize:13,fontWeight:500,color:i.palette.mui3["on-surface-variant"]};return t().createElement("div",{style:this.props.style},!o&&t().createElement("div",{style:c},this.props.getMessage("151")),t().createElement(Kr,{variant:"v2",fullWidth:!0,value:a,onChange:this.onDropDownChange.bind(this),disabled:this.props.isReadonly()||this.props.readonly||!r.isEditable(),floatingLabelText:this.props.getMessage("151")},s))}}])&&Yr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);Xr.PropTypes={linkModel:i().instanceOf(Xt)};const Zr=Xr=b((0,c.muiThemeable)()(Xr)),Jr=require("pydio/http/policies");var $r=n.n(Jr);function eo(e){return eo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},eo(e)}function to(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function no(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,so(r.key),r)}}function ro(e,t){return ro=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ro(e,t)}function oo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function io(e){return io=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},io(e)}function ao(e,t,n){return(t=so(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function so(e){var t=function(e,t){if("object"!==eo(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==eo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===eo(t)?t:String(t)}var lo=s().requireLib("components").ResourcePoliciesPanel,co=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ro(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=io(o);if(i){var n=io(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===eo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return oo(e)}(this,e)});function s(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ao(oo(e=a.call.apply(a,[this].concat(n))),"onSavePolicies",(function(t){var n=e.props,r=n.linkModel,o=(n.pydio,r.getLink().UserLogin);$r().loadPolicies("user",o).then((function(n){if(n.length){var r=n[0].Resource,i=e.diffPolicies(n,t,r);$r().savePolicies("user",o,i)}}))})),ao(oo(e),"diffPolicies",(function(e,t,n){var r=[];return e.map((function(e){var n=e.Action+"///"+e.Subject;t.remove[n]||r.push(e)})),Object.keys(t.add).map((function(e){var t,o,i=new jt.ServiceResourcePolicy,a=(t=e.split("///"),o=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(t,o)||function(e,t){if(e){if("string"==typeof e)return to(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?to(e,t):void 0}}(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=a[0],l=a[1];i.Resource=n,i.Effect=jt.ServiceResourcePolicyPolicyEffect.constructFromObject("allow"),i.Subject=l,i.Action=s,r.push(i)})),r})),e}return n=s,(r=[{key:"render",value:function(){var e=this.props,n=e.linkModel,r=e.pydio,o=[];o["user:"+n.getLink().UserLogin]=!0;var i={READ:o,WRITE:o};return t().createElement("div",{style:this.props.style},n.getLink().Uuid&&t().createElement(lo,{pydio:r,resourceType:"link",description:this.props.getMessage("link.visibility.advanced"),resourceId:n.getLink().Uuid,skipTitle:!0,onSavePolicies:this.onSavePolicies.bind(this),subjectsDisabled:i,subjectsHidden:o,readonly:this.props.isReadonly()||!n.isEditable(),ref:"policies"}))}}])&&no(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);co.PropTypes={pydio:i().instanceOf(s()).isRequired,linkModel:i().instanceOf(Xt).isRequired};const uo=co=b(co);function po(e){return po="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},po(e)}function fo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==po(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==po(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===po(o)?o:String(o)),r)}var o}function yo(e,t){return yo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},yo(e,t)}function ho(e){return ho=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ho(e)}var mo=s().requireLib("hoc").ModernTextField,bo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&yo(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ho(o);if(i){var n=ho(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===po(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return n=s,(r=[{key:"render",value:function(){var e,n=this.props,r=n.pydio,o=n.model,i=n.linkModel,a=n.style,s=n.showLayout,l=function(e){return r.MessageHash["share_center."+e]},c=i.getLink(),u=xt.compileLayoutData(r,o);return s&&u.length>1&&(e=t().createElement(Zr,{linkModel:i,pydio:r,layoutData:u,hideTitle:!0})),t().createElement("div",{style:a},t().createElement(mo,{variant:"v2",floatingLabelText:l(265),value:c.Label,onChange:function(e,t){c.Label=t,i.updateLink(c)},fullWidth:!0}),t().createElement(mo,{variant:"v2",floatingLabelText:l(266),value:c.Description,onChange:function(e,t){c.Description=t,i.updateLink(c)},fullWidth:!0}),e)}}])&&fo(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);function vo(e){return vo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vo(e)}function go(){return go=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},go.apply(this,arguments)}function wo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wo(Object(n),!0).forEach((function(t){Eo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Eo(e,t,n){return(t=jo(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Po(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,jo(r.key),r)}}function jo(e){var t=function(e,t){if("object"!==vo(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==vo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===vo(t)?t:String(t)}function ko(e,t){return ko=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ko(e,t)}function So(e){return So=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},So(e)}(bo=b(bo)).PropTypes={pydio:i().instanceOf(s()),linkModel:i().instanceOf(Xt)},n(757).requireLib("boot").ThemeModifier;var Ro=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ko(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=So(o);if(i){var n=So(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===vo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),e.editorOneColumn=!0,t=a.call(this,e);var n=new sn(!0);return n.skipUpdateUnderlyingNode=!0,t.state={mode:t.props.mode||"view",model:n},t}return n=s,(r=[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.node,r=t.linkUuid,o=t.onRemoveLink,i=this.state.model;i.observe("update",(function(){e.forceUpdate()})),i.loadUniqueLink(r,n).observeOnce("delete",(function(){o&&o()}))}},{key:"componentWillUnmount",value:function(){this.state.model.stopObserving("update")}},{key:"componentWillReceiveProps",value:function(e){e.LinkUuid&&e.LinkUuid!==this.props.LinkUuid&&this.state.model.loadUniqueLink(e.LinkUuid,e.node)}},{key:"linkInvitation",value:function(e){try{var t=xt.prepareEmail(this.props.node,e);this.setState({mailerData:Oo(Oo({},t),{},{users:[],linkModel:e})})}catch(e){alert(e.message)}}},{key:"dismissMailer",value:function(){this.setState({mailerData:null})}},{key:"submit",value:function(){var e=this.state.model;try{e.getLinks().length&&e.getLinks()[0].save()}catch(e){this.props.pydio.UI.displayMessage("ERROR",e.message)}}},{key:"render",value:function(){var e,n,r=this.props,o=r.node,i=r.pydio,a=r.editorOneColumn,s=this.state,l=s.model,c=s.mailerData,u=function(e){return i.MessageHash["share_center."+e]};l.getLinks().length&&(e=l.getLinks()[0]),n=e&&e.getLinkUuid()&&e.isEditable()?t().createElement("div",null,t().createElement(Vr,go({},c,{pydio:i,onDismiss:this.dismissMailer.bind(this)})),t().createElement(bo,{pydio:i,linkModel:e,model:l})):t().createElement("div",{style:{fontSize:24,padding:"26px 10px 0 ",lineHeight:"26px"}},t().createElement(Vr,go({},c,{pydio:i,onDismiss:this.dismissMailer.bind(this)})),u(256).replace("%s",o.getLabel()));var p={left:[],right:[],leftStyle:{padding:0}},f=l.getLinks();return e&&(p.left.push({Label:u(251),Value:"public-link",Component:t().createElement(Dr,{pydio:i,compositeModel:l,linkModel:f[0],showMailer:xt.mailerSupported(i)?this.linkInvitation.bind(this):null})}),e.getLinkUuid()&&p.left.push({Label:u(253),Value:"link-visibility",Component:t().createElement(uo,{pydio:i,linkModel:f[0]}),AlwaysLast:!0})),t().createElement(Ye,{tabs:p,pydio:i,header:n,saveEnabled:l.isDirty(),onSaveAction:this.submit.bind(this),onCloseAction:this.props.onDismiss,onRevertAction:function(){l.revertChanges()},editorOneColumn:a,style:{width:"100%",height:null,flex:1,minHeight:550,color:"rgba(0,0,0,.83)",fontSize:13}})}}])&&Po(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);function xo(e){return xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xo(e)}function _o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_o(Object(n),!0).forEach((function(t){Mo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Mo(e,t,n){return(t=Do(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Co(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function To(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Do(r.key),r)}}function Do(e){var t=function(e,t){if("object"!==xo(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==xo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===xo(t)?t:String(t)}function Ao(e,t){return Ao=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ao(e,t)}function Io(e){return Io=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Io(e)}var Uo=s().requireLib("hoc").ThemedContainers.Popover,No=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ao(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Io(o);if(i){var n=Io(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===xo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=a.call(this,e);var n=null;return 0===e.compositeModel.getCells().length&&(n="NEWCELL"),t.state={edit:n},t}return n=s,(r=[{key:"addToCellsMenuItems",value:function(e){var n,r,o,i=this,a=[],s=this.props,c=s.pydio,u=s.compositeModel,p=u.getCells().map((function(e){return e.getUuid()}));return 0===p.filter((function(e){return!e})).length&&(a.push(t().createElement(l.MenuItem,{primaryText:e("cell.add.new"),onClick:function(){i.setState({addMenuOpen:!1}),u.createEmptyCell()},leftIcon:t().createElement(l.FontIcon,{className:"icomoon-cells-full-plus"})})),n=!0),c.user.getRepositoriesList().forEach((function(e){"shared"===e.getOwner()&&-1===p.indexOf(e.getId())&&(a.push(t().createElement(l.MenuItem,{primaryText:e.getLabel(),onClick:function(){i.setState({addMenuOpen:!1}),u.addToExistingCell(e.getId())},leftIcon:t().createElement(l.FontIcon,{className:"icomoon-cells"})})),r=!0)})),r&&n?o=e("cell.add.existing-or-new"):r?o=e("cell.add.existing"):n&&(o=e("cell.add.new")),{addItems:a,addLabel:o}}},{key:"removeCurrentNodeFromCell",value:function(e){var t=this.props.compositeModel;0===t.getCells().filter((function(t){return t!==e})).length&&t.createEmptyCell(),e.removeRootNode(t.getNode().getMetadata().get("uuid"))}},{key:"render",value:function(){var e=this,n=this.props,r=n.compositeModel,o=n.pydio,i=n.usersInvitations,a=n.muiTheme,s=(this.state.edit,function(e){return o.MessageHash["share_center."+e]}),c={fontSize:13,fontWeight:500,color:a.palette.mui3["on-surface-variant"],padding:8};if(r.getNode()&&!r.canCreateCells())return t().createElement("div",{style:c},s(r.getNode().isLeaf()?"227":"228"));var u=r.getCells().length>1,p=[];r.getCells().map((function(n){var r=t().createElement("div",{style:{margin:"0 -10px"}},t().createElement(se,{pydio:o,cellAcls:n.getAcls(),excludes:[o.user.id],onUserObjectAdd:n.addUser.bind(n),onUserObjectRemove:n.removeUser.bind(n),onUserObjectUpdateRight:n.updateUserRight.bind(n),sendInvitations:function(e){return i(e,n)},saveSelectionAsTeam:!1,withActionLinks:function(r){return n.isEditable()?[].concat(function(e){if(Array.isArray(e))return Co(e)}(o=r)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||function(e,t){if(e){if("string"==typeof e)return Co(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Co(e,t):void 0}}(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[t().createElement(J,{mdiIcon:"delete-forever",destructive:!0,messageId:s("cells.remove.node"),callback:function(){e.removeCurrentNodeFromCell(n)}})]):r;var o},readonly:!n.isEditable(),completerStyle:{margin:"-6px 8px 16px"}}));u?p.push(t().createElement(Tr,{title:n.getLabel(),legend:n.getAclsSubjects()},r)):p.push(t().createElement("div",{style:{padding:16}},r)),p.push(t().createElement(l.Divider,null))})),p.pop();var f,d=this.addToCellsMenuItems(s),y=d.addItems,h=d.addLabel;if(y.length){var m=this.props.muiTheme;f=t().createElement("span",{id:"share-dialog-addtocell-menu"},t().createElement(l.FlatButton,{iconClassName:"icomoon-cells-full-plus",style:{width:"100%"},iconStyle:{color:m.palette.accent2Color},primary:!0,tooltip:s(263),label:h,tooltipPosition:"bottom-left",onClick:function(t){e.setState({addMenuOpen:!0,addMenuAnchor:t.currentTarget})}}),t().createElement(Uo,{open:this.state.addMenuOpen,anchorEl:this.state.addMenuAnchor,onRequestClose:function(){e.setState({addMenuOpen:!1})},anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"bottom"}},t().createElement(l.Menu,{desktop:!0,listStyle:{paddingTop:0},width:250},t().createElement(l.Subheader,null,h),y)))}return t().createElement("div",{style:Lo(Lo({},this.props.style),{},{minHeight:300})},p,f&&t().createElement("div",{style:{position:"absolute",bottom:10,left:10}},f))}}])&&To(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component);function Bo(e){return Bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bo(e)}function qo(){return qo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},qo.apply(this,arguments)}function Fo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ho(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fo(Object(n),!0).forEach((function(t){zo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zo(e,t,n){return(t=Wo(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Vo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Wo(r.key),r)}}function Wo(e){var t=function(e,t){if("object"!==Bo(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Bo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Bo(t)?t:String(t)}function Yo(e,t){return Yo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Yo(e,t)}function Go(e){return Go=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Go(e)}No.PropTypes={pydio:i().instanceOf(s()),compositeModel:i().instanceOf(sn).isRequired,usersInvitations:i().func},No=(0,c.muiThemeable)()(No),n(757).requireLib("boot").ThemeModifier;var Qo=s().requireLib("boot").Tooltip,Ko=s().requireLib("components"),Xo=Ko.GenericCard,Zo=Ko.GenericLine,Jo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Yo(e,t)}(l,e);var r,o,i,a,s=(i=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Go(i);if(a){var n=Go(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Bo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=s.call(this,e)).state={mode:t.props.mode||"view",model:new sn("edit"===t.props.mode)},t}return r=l,(o=[{key:"confirmAndDismiss",value:function(){var e=this.state.model,t=this.props,n=t.pydio,r=t.onDismiss;e.isDirty()&&!confirm(n.MessageHash["share_center.dialog.close.confirm.unsaved"])||r()}},{key:"attachClipboard",value:function(){var e=this.props.pydio,t=function(t){return e.MessageHash["share_center."+t]},r=this.state.model;if(this.detachClipboard(),r.getLinks().length){var o=r.getLinks()[0];o.getLink()&&this.refs["copy-button"]&&(this._clip=new(pn())(this.refs["copy-button"],{text:function(t){return xt.buildPublicUrl(e,o.getLink())}.bind(this)}),this._clip.on("success",function(){var e=this;this.setState({copyMessage:t("192")},(function(){setTimeout((function(){e.setState({copyMessage:null})}),2500)}))}.bind(this)),this._clip.on("error",function(){var e,r=this;e=0===n.g.navigator.platform.indexOf("Mac")?t(144):t(143),this.setState({copyMessage:e},(function(){setTimeout((function(){r.setState({copyMessage:null})}),2500)}))}.bind(this)))}}},{key:"detachClipboard",value:function(){this._clip&&this._clip.destroy()}},{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.node,r=t.mode;this.state.model.observe("update",(function(){e.forceUpdate()})),this.state.model.load(n,"infoPanel"===r),this.attachClipboard()}},{key:"componentWillUnmount",value:function(){this.state.model.stopObserving("update"),this.detachClipboard()}},{key:"componentDidUpdate",value:function(){this.attachClipboard()}},{key:"componentWillReceiveProps",value:function(e){!e.node||e.node===this.props.node&&e.node.getMetadata("pydio_shares")===this.props.node.getMetadata("pydio_shares")||this.state.model.load(e.node,"infoPanel"===e.mode)}},{key:"usersInvitations",value:function(e,t){xt.sendCellInvitation(this.props.node,t,e)}},{key:"linkInvitation",value:function(e){try{var t=xt.prepareEmail(this.props.node,e);this.setState({mailerData:Ho(Ho({},t),{},{users:[],linkModel:e})})}catch(e){alert(e.message)}}},{key:"dismissMailer",value:function(){this.setState({mailerData:null})}},{key:"submit",value:function(){try{this.state.model.save()}catch(e){this.props.pydio.UI.displayMessage("ERROR",e.message)}}},{key:"deleteAllShares",value:function(){var e=this.props.pydio,t=this.state.model;e.UI.openComponentInModal("PydioReactUI","ConfirmDialog",{dialogTitleId:"share_center.composite.deleteAll",message:e.MessageHash["share_center.255"],validCallback:function(){t.stopObserving("update"),t.deleteAll().then((function(e){t.updateUnderlyingNode()}))}})}},{key:"render",value:function(){var e=this,n=this.props,r=n.node,o=n.mode,i=n.pydio,a=n.editorOneColumn,s=n.popoverPanel,l=n.popoverRequestClose,c=this.state,u=c.model,p=c.mailerData,f=c.linkTooltip,d=c.copyMessage,y=function(e){return i.MessageHash["share_center."+e]};if("edit"===o){var h,m=t().createElement("div",{style:{fontSize:20,padding:10}},t().createElement(Vr,qo({},p,{pydio:i,onDismiss:this.dismissMailer.bind(this)})),r&&y(256).replace("%s",r.getLabel())+(u.isDirty()?" *":"")),b={left:[],right:[]},v=u.getCells().filter((function(e){return e.getUuid()}));h=v.length>1?y("254c").replace("%d",v.length):1===v.length?y("254d").replace("%s",v[0].getLabel()):y("254b"),b.right.push({Label:h,Value:"cells",Icon:"mdi mdi-account-multiple",Component:t().createElement(No,{pydio:i,compositeModel:u,usersInvitations:this.usersInvitations.bind(this)})});var g,w=u.getLinks();if(w.length&&(g=w[0]),g){var O=[],E=!1;g.getLinkUuid()&&(E=!0,O.push(Ho(Ho({},(S=g,{title:y("265"),legend:S.getLink().Label})),{},{content:t().createElement(bo,{pydio:i,linkModel:w[0],model:u,showLayout:!0})})),w[0].isEditable()&&O.push({title:y("link.visibility.title"),content:t().createElement(uo,{pydio:i,linkModel:w[0],style:{margin:-10}})})),b.left.push({Label:y(121)+(E?" ("+y("link.active")+")":""),Value:"public-link",Icon:"mdi mdi-link",Component:t().createElement(Dr,{pydio:i,compositeModel:u,linkModel:w[0],showMailer:xt.mailerSupported(i)?this.linkInvitation.bind(this):null,additionalPanes:O})})}var P=!w.filter((function(e){return e.getLinkUuid()})).length&&v.length>0?"cells":null;return t().createElement(Ye,{tabs:b,defaultLeft:P,pydio:i,header:m,saveEnabled:u.isDirty(),onSaveAction:this.submit.bind(this),onCloseAction:function(){return e.confirmAndDismiss()},onRevertAction:function(){u.revertChanges(!0)},editorOneColumn:a,style:{width:"100%",height:null,flex:1,minHeight:350,fontSize:13}})}var j=[],k=[];u.getCells().map((function(e){k.push(e.getLabel())}));var S,R=u.getLinks();if(R.length){var x=R[0];if(x.hasError()){var _=x.hasError();j.push(t().createElement(Zo,{iconClassName:"mdi mdi-alert-outline",legend:"Error",data:_.Detail||_.Msg||_}))}else if(x.getLink()&&x.getLink().LinkHash){var L=xt.buildPublicUrl(i,x.getLink(),"infoPanel"===o);j.push(t().createElement(Zo,{iconClassName:"mdi mdi-link",legend:y(121),style:{overflow:"visible"},dataStyle:{overflow:"visible"},data:t().createElement("div",{ref:"copy-button",style:{cursor:"pointer",position:"relative"},onMouseOver:function(){e.setState({linkTooltip:!0})},onMouseOut:function(){e.setState({linkTooltip:!1})}},t().createElement(Qo,{label:d||y(191),horizontalPosition:"left",verticalPosition:"top",show:f}),L)}))}}return k.length&&j.push(t().createElement(Zo,{iconClassName:"mdi mdi-account-multiple",legend:y(254),data:k.join(", ")})),t().createElement(Xo,{pydio:i,title:i.MessageHash["share_center.50"],onDismissAction:this.props.onDismiss,onDeleteAction:function(){l&&l(),e.deleteAllShares()},onEditAction:function(){l&&l(),i.Controller.fireAction("share-edit-shared")},editTooltip:i.MessageHash["share_center.125"],deleteTooltip:i.MessageHash["share_center.composite.deleteAll"],headerSmall:"infoPanel"===o,popoverPanel:s,popoverRequestClose:l},j,!j.length&&t().createElement(Zo,{placeHolder:!0}))}}])&&Vo(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),l}(t().Component);function $o(e){return $o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$o(e)}function ei(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==$o(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==$o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===$o(o)?o:String(o)),r)}var o}function ti(e,t){return ti=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ti(e,t)}function ni(e){return ni=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ni(e)}var ri=s().requireLib("workspaces").InfoPanelCard,oi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ti(e,t)}(s,e);var n,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ni(o);if(i){var n=ni(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===$o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={popoverOpen:!1},t}return n=s,(r=[{key:"openPopover",value:function(e){this.setState({popoverOpen:!0,popoverAnchor:e.target})}},{key:"render",value:function(){var e=this.props,n=e.pydio,r=e.node,o=e.popoverPanel,i=e.popoverRequestClose;return r.isRoot()?t().createElement(ri,{popoverPanel:o},t().createElement("div",{style:{padding:0}},t().createElement(Bt,{cellId:n.user.activeRepository,pydio:n,mode:"infoPanel"}))):t().createElement(ri,{popoverPanel:o},t().createElement("div",{style:{padding:0}},t().createElement(Jo,{node:r,pydio:n,mode:"infoPanel",popoverPanel:o,popoverRequestClose:i})))}}])&&ei(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(t().Component),ii=n(689),ai=n(566)({displayName:"CompositeDialog",mixins:[n(757).requireLib("boot").ActionDialogMixin],getDefaultProps:function(){return{dialogTitle:"",dialogIsModal:!0,dialogPadding:!1,dialogSize:"md+"}},propTypes:{pydio:i().instanceOf(s()).isRequired,selection:i().instanceOf(ce()),readonly:i().bool},childContextTypes:{messages:i().object,getMessage:i().func,isReadonly:i().func},getChildContext:function(){var e=this,t=this.props.pydio.MessageHash;return{messages:t,getMessage:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"share_center";try{return t[n+(n?".":"")+e]||e}catch(t){return e}},isReadonly:function(){return e.props.readonly}}},shouldComponentUpdate:function(e,t){return!!this.props.selection.getUniqueNode()},render:function(){var e,t=this.props,n=t.pydio,r=t.selection;return r.getUniqueNode()&&(e=r.getUniqueNode()),ii.createElement(Jo,{editorOneColumn:!0,pydio:n,mode:"edit",node:e,onDismiss:this.props.onDismiss})}}),si=n(566),li=n.n(si);const ci=require("pydio/model/node");var ui=n.n(ci);function pi(e){return pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pi(e)}function fi(){return fi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},fi.apply(this,arguments)}function di(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?di(Object(n),!0).forEach((function(t){hi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):di(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function hi(e,t,n){return(t=gi(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,gi(r.key),r)}}function vi(e,t,n){return t&&bi(e.prototype,t),n&&bi(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function gi(e){var t=function(e,t){if("object"!==pi(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==pi(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===pi(t)?t:String(t)}function wi(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Oi(e,t)}function Oi(e,t){return Oi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Oi(e,t)}function Ei(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Pi(e);if(t){var o=Pi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===pi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function Pi(e){return Pi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Pi(e)}var ji=s().requireLib("boot"),ki=ji.ActionDialogMixin,Si=ji.Loader,Ri=s().requireLib("components"),xi=Ri.ModalAppBar,_i=Ri.EmptyStateView,Li=s().requireLib("hoc").ModernTextField,Mi=n(173).muiThemeable,Ci=function(e){wi(r,e);var n=Ei(r);function r(){return mi(this,r),n.apply(this,arguments)}return vi(r,[{key:"render",value:function(){var e=this.props,n=e.value,r=e.onChange,o=e.muiTheme,i=e.m,a={color:"#616161"},s={color:o.palette.accent1Color},c={marginRight:5};return t().createElement(l.Tabs,{style:{width:360},onChange:function(e){r(null,0,e)},value:n,tabItemContainerStyle:{background:"transparent"}},t().createElement(l.Tab,{label:t().createElement("span",null,t().createElement("span",{style:c,className:"mdi mdi-share-variant"}),i(243)),value:"LINKS",buttonStyle:"LINKS"===n?s:a}),t().createElement(l.Tab,{label:t().createElement("span",null,t().createElement("span",{style:c,className:"icomoon-cells"}),i(254)),value:"CELLS",buttonStyle:"CELLS"===n?s:a}))}}]),r}(t().Component);Ci=Mi()(Ci);var Ti=function(e){wi(r,e);var n=Ei(r);function r(e){var t;return mi(this,r),(t=n.call(this,e)).state={resources:[],loading:!1,selectedModel:null,shareType:e.defaultShareType||"LINKS"},t}return vi(r,[{key:"getChildContext",value:function(){var e=this.props.pydio.MessageHash;return{messages:e,getMessage:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"share_center";try{return e[n+(n?".":"")+t]||t}catch(e){return t}},isReadonly:function(){return!1}.bind(this)}}},{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){var e=this;this.setState({filter:""});var t=new jt.ShareServiceApi(Pt().getRestClient()),n=new jt.RestListSharedResourcesRequest;n.ShareType=jt.ListSharedResourcesRequestListShareType.constructFromObject(this.state.shareType),this.props.subject?n.Subject=this.props.subject:n.OwnedBySubject=!0,this.setState({loading:!0}),t.listSharedResources(n).then((function(t){e.setState({resources:t.Resources||[],loading:!1})})).catch((function(){e.setState({loading:!1})}))}},{key:"getLongestPath",value:function(e){if(!e.AppearsIn)return{path:e.Path,basename:e.Path};var t={};e.AppearsIn.map((function(e){t[e.Path]=e}));var n=Object.keys(t);n.sort();var r=n[n.length-1],o=_n().getBasename(r);return o||(o=t[r].WsLabel),{path:r,appearsIn:t[r],basename:o}}},{key:"goTo",value:function(e){var t=e.Path,n=e.WsLabel,r=e.WsUuid,o=t.split("/");o.shift();var i=new(ui())(o.join("/"));i.getMetadata().set("repository_id",r),i.getMetadata().set("repository_label",n),this.props.pydio.goTo(i),this.props.onRequestClose()}},{key:"render",value:function(){var e=this,n=this.state,r=n.loading,o=n.resources,i=n.filter,a=void 0===i?"":i,s=this.props,c=s.pydio,u=s.style,p=function(e){return c.MessageHash["share_center."+e]};o.sort((function(e,t){var n=e.Node.Path,r=t.Node.Path;return n===r?0:n>r?1:-1}));var f=c.Registry.getFilesExtensions();return t().createElement("div",{style:yi(yi({},u),{},{display:"flex",flexDirection:"column",overflow:"hidden"})},t().createElement("div",{style:{backgroundColor:"#F5F5F5",borderBottom:"1px solid #EEEEEE",display:"flex",paddingRight:16,paddingTop:3}},t().createElement(Ci,{m:p,value:this.state.shareType,onChange:function(t,n,r){e.setState({shareType:r},(function(){e.load()}))}}),t().createElement("span",{style:{flex:1}}),t().createElement("div",{style:{width:150}},t().createElement(Li,{hintText:p("sharelist.quick-filter"),value:a,onChange:function(t,n){e.setState({filter:n})},fullWidth:!0}))),r&&t().createElement(Si,{style:{height:400}}),!r&&0===o.length&&t().createElement(_i,{pydio:c,iconClassName:"mdi mdi-share-variant",primaryTextId:p(131),style:{flex:1,height:400,padding:"90px 0",backgroundColor:"transparent"}}),!r&&o.length>0&&t().createElement(l.List,{style:{flex:1,minHeight:400,maxHeight:400,overflowY:"auto",paddingTop:0}},o.map((function(t){var n,r=e.getLongestPath(t.Node),o=r.appearsIn,i=r.basename;if(-1===i.indexOf("."))n="mdi mdi-folder";else{var a=_n().getFileExtension(i);n=f.has(a)?"mdi mdi-"+f.get(a).fontIcon:"mdi mdi-file"}return t.Link&&t.Link.Label&&t.Link.Label!==i&&(i=t.Link.Label+" ("+i+")"),{primaryText:i,secondaryText:t.Link?p(251)+": "+t.Link.Description:p(284).replace("%s",t.Cells.length),icon:n,appearsIn:o}})).filter((function(e){return!a||-1!==e.primaryText.toLowerCase().indexOf(a.toLowerCase())})).map((function(n){var r=n.appearsIn,o=n.icon;return t().createElement(l.ListItem,{primaryText:n.primaryText,secondaryText:n.secondaryText,onClick:function(){r&&e.goTo(r)},disabled:!r,leftIcon:t().createElement(l.FontIcon,{className:o})})}))))}}]),r}(t().Component);Ti.childContextTypes={messages:i().object,getMessage:i().func,isReadonly:i().func};var Di=li()({displayName:"ShareViewModal",mixins:[ki],getDefaultProps:function(){return{dialogTitle:"",dialogSize:"lg",dialogPadding:!1,dialogIsModal:!1,dialogScrollBody:!1}},submit:function(){this.dismiss()},render:function(){var e=this;return t().createElement("div",{style:{width:"100%",display:"flex",flexDirection:"column"}},t().createElement(xi,{title:this.props.pydio.MessageHash["share_center.98"],showMenuIconButton:!1,iconClassNameRight:"mdi mdi-close",onRightIconButtonClick:function(){e.dismiss()}}),t().createElement(Ti,fi({},this.props,{style:{width:"100%",flex:1},onRequestClose:function(){e.dismiss()}})))}}),Ai=n(247),Ii=n.n(Ai),Ui=n(415),Ni=n.n(Ui),Bi=n(938),qi=n.n(Bi),Fi=n(549),Hi=n.n(Fi),zi=n(767),Vi=n.n(zi),Wi=n(35),Yi=n.n(Wi),Gi=n(144),Qi={};Qi.styleTagTransform=Yi(),Qi.setAttributes=Hi(),Qi.insert=qi().bind(null,"head"),Qi.domAPI=Ni(),Qi.insertStyleElement=Vi(),Ii()(Gi.Z,Qi),Gi.Z&&Gi.Z.locals&&Gi.Z.locals})(),window.ShareDialog=r})();