(()=>{"use strict";var e={305:e=>{e.exports=require("lodash.debounce")},455:e=>{e.exports=require("material-ui")},757:e=>{e.exports=require("pydio")},727:e=>{e.exports=require("pydio/model/meta-node-provider")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{r.r(n),r.d(n,{ASClient:()=>d,Activity:()=>pe,ActivityList:()=>Te,Callbacks:()=>nt,InfoPanel:()=>Ie,Listener:()=>et,OverlayPanel:()=>bt,UserPanel:()=>Qe,WatchSelector:()=>ut});const e=require("react");var t=r.n(e),o=r(455);const i=require("prop-types");var a=r.n(i),c=r(757),l=r.n(c);const u=require("pydio/http/api");var s=r.n(u);const f=require("cells-sdk");function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==p(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===p(o)?o:String(o)),n)}var o}var d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"loadActivityStreams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"USER_ID",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"outbox",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;if(!t)return Promise.resolve([]);var a=new f.ActivityServiceApi(s().getRestClient()),c=new f.ActivityStreamActivitiesRequest;return c.Context=e,c.ContextData=t,c.BoxName=r,o>-1&&(c.Offset=o),i>-1&&(c.Limit=i),c.Language=l().getInstance().user.getPreference("lang")||"",n&&(c.PointOfView=n),a.stream(c)}},{key:"UnreadInbox",value:function(e){var t=new f.ActivityServiceApi(s().getRestClient()),r=new f.ActivityStreamActivitiesRequest;return r.Context="USER_ID",r.ContextData=e,r.BoxName="inbox",r.UnreadCountOnly=!0,t.stream(r).then((function(e){return e.totalItems||0}))}}],null&&y(t.prototype,null),r&&y(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();const b=require("react-markdown");var m=r.n(b);const v=require("material-ui/styles"),h=require("pydio/util/path");var g=r.n(h);function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function j(e,t,r){return(t=_(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_(n.key),n)}}function x(e,t,r){return t&&E(e.prototype,t),r&&E(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _(e){var t=function(e,t){if("object"!==w(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===w(t)?t:String(t)}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&T(e,t)}function T(e,t){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},T(e,t)}function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=A(e);if(t){var o=A(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function A(e){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},A(e)}var M=r(455),R=M.Paper,D=M.IconButton,L=M.FlatButton,I=M.Divider,H=r(757),N=r(305),q=r(727),B=H.requireLib("boot").PydioContextConsumer,U=(H.requireLib("workspaces").FilePreview,H.requireLib("hoc").ThemedContainers.Popover);function W(e,t){var r=[],n=t.user.getActiveRepository();if(!(e&&e.partOf&&e.partOf.items&&e.partOf.items.length))return r;for(var o=0;o<e.partOf.items.length;o++){var i=e.partOf.items[o],a=i.rel.split("/");a.shift();var c=a.join("/");0!==c.indexOf("/")&&(c="/"+c);var l=new AjxpNode(c,"Document"===e.type);if(l.getMetadata().set("repository_id",i.id),l.getMetadata().set("repository_label",i.name),l.getMetadata().set("filename",c),i.id===n)return[l];r.push(l)}return r}var F=function(e){C(n,e);var r=k(n);function n(e){var t;P(this,n),t=r.call(this,e);var o=W(e.activity.object,e.pydio);return o.length&&!o[0].isLeaf()?t.state={previewLoaded:!0,previewFailed:!1,nodes:o}:t.state={previewLoaded:!1,previewFailed:!1,nodes:o},t}return x(n,[{key:"render",value:function(){var e=this,r=this.props.pydio,n=this.state,o=n.previewLoaded,i=n.nodes,a=n.previewFailed,c=i.length?i[0]:null,l={height:200,display:"flex",alignItems:"center",justifyContent:"center",fontSize:70};if(c&&c.isLeaf())if(o&&!a);else if(o&&a)S(S({},l),{},{flexDirection:"column"});else{var u=c.getMetadata().get("repository_id"),s=c.getMetadata().get("repository_label"),f=new q;c.observeOnce("error",(function(){e.setState({previewLoaded:!0,previewFailed:!0})})),f.loadLeafNodeSync(c,(function(t){t.getMetadata().set("repository_id",u),t.getMetadata().set("repository_label",s),i[0]=t,e.setState({previewLoaded:!0,nodes:i})}),!0,{tmp_repository_id:u})}for(var p,y=[],d=r.user.getActiveRepository(),b=function(){var e=i[m],n=t().createElement("div",{style:{display:"flex",alignItems:"center",paddingLeft:10}},t().createElement("div",{style:{flex:1,fontSize:13,fontWeight:500,color:"rgba(0,0,0,0.33)"}},r.MessageHash["notification_center.16"]," ",e.getMetadata().get("repository_label")),t().createElement(D,{iconClassName:"mdi mdi-open-in-new",tooltip:r.MessageHash["notification_center.6"],tooltipPosition:"top-center",onClick:function(){r.goTo(e)}}));if(e.getMetadata().get("repository_id")===d)return p=t().createElement("div",{style:{display:"flex",alignItems:"center"}},t().createElement("span",{style:{flex:1}})," ",t().createElement(L,{label:r.MessageHash["notification_center.6"],iconClassName:"mdi mdi-open-in-new",tooltip:"Open",tooltipPosition:"top-right",onClick:function(){r.goTo(e)}})),"break";y.push(n),m<i.length-1&&y.push(t().createElement(I,null))},m=0;m<i.length&&"break"!==b();m++);return p&&(y=[p]),t().createElement("div",null,!a&&t().createElement("div",{style:{padding:6}},y))}}]),n}(t().Component),z=function(e){C(n,e);var r=k(n);function n(e){var t;return P(this,n),(t=r.call(this,e)).state={showPopover:!1,popoverAnchor:null},t}return x(n,[{key:"render",value:function(){var e=this,r=this.props,n=r.pydio,o=r.activity,i=r.children,a=r.linkStyle;o.object.name||(o.object.name="");var c,l,u,s,f=W(o.object,n),p=o.object.name.replace("doc://","").split("/");p.shift();var y="/"+p.join("/");return f.length>1?(c=function(){n.goTo(f[0])},u=N((function(){e.setState({showPopover:!1})}),350),l=function(t){e.setState({showPopover:!0,popoverAnchor:t.currentTarget}),u.cancel()},s=t().createElement(U,{open:this.state.showPopover,anchorEl:this.state.popoverAnchor,onRequestClose:function(t){"clickAway"!==t&&e.setState({showPopover:!1})},anchorOrigin:{horizontal:"left",vertical:"bottom"},targetOrigin:{horizontal:"left",vertical:"top"},useLayerForClickAway:!1},t().createElement(R,{zDepth:2,style:{width:200,height:"auto",overflowY:"auto"},onMouseOver:function(t){e.setState({showPopover:!0}),u.cancel()},onMouseOut:u},t().createElement(F,{pydio:n,activity:o})))):1===f.length&&(c=function(){n.goTo(f[0])}),t().createElement("span",null,t().createElement("a",{title:y,style:S({cursor:"pointer",color:"rgb(66, 140, 179)"},a),onMouseOver:l,onMouseOut:u,onClick:c},i),s)}}]),n}(t().Component);function V(e){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(e)}function G(){return G=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},G.apply(this,arguments)}function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach((function(t){$(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function $(e,t,r){return(t=Z(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function K(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Z(n.key),n)}}function X(e,t,r){return t&&Q(e.prototype,t),r&&Q(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Z(e){var t=function(e,t){if("object"!==V(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==V(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===V(t)?t:String(t)}function ee(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&te(e,t)}function te(e,t){return te=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},te(e,t)}function re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=ne(e);if(t){var o=ne(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===V(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function ne(e){return ne=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ne(e)}z.PropTypes={activity:a().object,pydio:a().instanceOf(H)},z=B(z);var oe=l().requireLib("components"),ie=(oe.Timeline,oe.UserAvatar),ae=l().requireLib("boot").PydioContextConsumer,ce=l().requireLib("workspaces").FilePreview,le=l().requireLib("boot").moment,ue=function(e){ee(n,e);var r=re(n);function n(){return K(this,n),r.apply(this,arguments)}return X(n,[{key:"render",value:function(){return t().createElement("span",null,this.props.children)}}]),n}(t().Component);function se(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return function(o){ee(a,o);var i=re(a);function a(){return K(this,a),i.apply(this,arguments)}return X(a,[{key:"render",value:function(){var o=this.props,i=o.href,a=o.children,c=J({cursor:"pointer",color:"rgb(66, 140, 179)",fontWeight:500},n),l=null;if(i.startsWith("doc://"))return"Delete"===r.type?t().createElement("a",{style:{textDecoration:"line-through"}},a):t().createElement(z,{pydio:e,activity:r,linkStyle:c},a);if(i.startsWith("user://")){var u=i.replace("user://","");return t().createElement(ie,{userId:u,displayAvatar:!1,richOnClick:!0,style:J(J({},c),{},{display:"inline-block"}),pydio:e})}if(i.startsWith("workspaces://")){var s=i.replace("workspaces://","");e.user&&e.user.getRepositoriesList().get(s)&&(l=function(){e.triggerRepositoryChange(s)})}return t().createElement("a",{title:"",style:c,onClick:l},a)}}]),a}(t().Component)}var fe=function(r){ee(o,r);var n=re(o);function o(){return K(this,o),n.apply(this,arguments)}return X(o,[{key:"render",value:function(){var r=this.props,n=r.activity,o=r.listContext,i=r.inlineActor;if(!n.summary)return t().createElement("span",null,n.type," ",n.actor?" - "+n.actor.name:"");var a,c={paragraph:ue,link:se(pydio,n,{color:"inherit"})};return"NODE-LEAF"===o&&(c.link=function(){return null}),i&&n.actor&&(a=t().createElement(ie,{userId:n.actor.id,userLabel:n.actor.name,displayLocalLabel:!0,userType:"user",pydio:l().getInstance(),style:{display:"inline-block"},labelStyle:{display:"inline-block"},displayAvatar:!1,richOnHover:!1})),t().createElement(e.Fragment,null,a,a?" - ":null,t().createElement(m(),{source:n.summary,renderers:c,style:{display:"inline"},containerTagName:i?"span":"div"}))}}]),o}(t().Component),pe=function(e){ee(n,e);var r=re(n);function n(){return K(this,n),r.apply(this,arguments)}return X(n,[{key:"computeIcon",value:function(e){var t,r="";switch(e.type){case"Create":r="Document"===e.object.type?"file-plus":"folder-plus",t="Created";break;case"Delete":r="delete",t="Deleted";break;case"Edit":case"Update":r="pencil",t="Modified";break;case"UpdateMeta":r="tag-multiple",t="Modified";break;case"UpdateComment":r="message-outline",t="Commented";break;case"Read":r="eye",t="Accessed";break;case"Move":r="file-send",t="Moved";break;case"Share":r="share-variant","Cell"===e.object.type?r="icomoon-cells":"Workspace"===e.object.type&&(r="folder"),t="Shared"}return-1===r.indexOf("icomoon-")&&(r="mdi mdi-"+r),{title:t,className:r}}},{key:"render",value:function(){var e,r,n=this.props,i=n.pydio,a=n.activity,c=n.listContext,l=n.displayContext,u=n.oneLiner,s=n.muiTheme,f={margin:"0px 10px 6px"};r="popover"===l?{fontSize:13,color:"rgba(0,0,0,0.53)",margin:"6px 0",padding:6}:{padding:"6px 22px 13px",marginTop:6,borderRadius:2,borderLeft:"2px solid #e0e0e0",marginLeft:14,color:"rgba(0,0,0,0.83)",overflow:"hidden"};var p=this.computeIcon(a).className,y=s.palette.mui3.tertiary;if("popover"===l){f={margin:0};var d,b,m=W(a.object,i);m.length?(d=t().createElement("div",{style:{padding:"12px 20px 12px 20px",position:"relative"}},t().createElement(ce,G({pydio:i,node:m[0],loadThumbnail:!0},{style:{height:36,width:36,borderRadius:"50%"},mimeFontStyle:{fontSize:20,lineHeight:"36px",textAlign:"center"}})),t().createElement("span",{className:p,style:{position:"absolute",bottom:8,right:12,fontSize:18,color:y}})),b=m[0].getLabel()||g().getBasename(m[0].getPath())):(d=t().createElement("div",{style:{margin:"12px 20px 12px 20px",backgroundColor:"rgb(237, 240, 242)",alignItems:"initial",height:36,width:36,borderRadius:"50%",textAlign:"center"}},t().createElement(o.FontIcon,{className:p,style:{lineHeight:"36px",color:y}})),b=a.object?a.object.name:a.name),e=t().createElement("div",{style:{display:"flex",alignItems:"flex-start",overflow:"hidden",paddingBottom:8}},d,t().createElement("div",{style:{flex:1,overflow:"hidden",paddingRight:16}},t().createElement("div",{style:{marginTop:12,marginBottom:2,fontSize:14,fontWeight:500,whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}},b),t().createElement("div",{style:{opacity:.73}},t().createElement(fe,{activity:a,listContext:c}))))}else e=t().createElement("div",{style:r},secondary);return t().createElement("div",{style:f},!u&&t().createElement("div",{style:{display:"flex",alignItems:"center"}},a.actor&&t().createElement(ie,{useDefaultAvatar:!0,userId:a.actor.id,userLabel:a.actor.name,displayLocalLabel:!0,userType:"user",pydio:i,style:{display:"flex",alignItems:"center",maxWidth:"60%"},labelStyle:{fontSize:14,fontWeight:500,paddingLeft:10,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},avatarStyle:{flexShrink:0},avatarSize:28,richOnHover:!0}),t().createElement("span",{style:{fontSize:13,display:"inline-block",flex:1,height:18,color:"rgba(0,0,0,0.23)",fontWeight:500,paddingLeft:8,whiteSpace:"nowrap"}},le(a.updated).fromNow())),e)}}]),n}(t().Component);function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}function de(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?de(Object(r),!0).forEach((function(t){me(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function me(e,t,r){return(t=we(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ve(e){return function(e){if(Array.isArray(e))return he(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return he(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?he(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ge(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,we(n.key),n)}}function we(e){var t=function(e,t){if("object"!==ye(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ye(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===ye(t)?t:String(t)}function Oe(e,t){return Oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Oe(e,t)}function Se(e){return Se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Se(e)}pe.PropTypes={activity:a().object,listContext:a().string,displayContext:a().oneOf(["infoPanel","popover"])},pe=ae(pe=(0,v.muiThemeable)()(pe));var je=l().requireLib("boot"),Pe=je.PydioContextConsumer,Ee=je.moment,xe=l().requireLib("components"),_e=xe.EmptyStateView,Ce=xe.Timeline,Te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Oe(e,t)}(l,e);var r,n,i,a,c=(i=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Se(i);if(a){var r=Se(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===ye(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),t=c.call(this,e),e.items?t.state={data:{items:e.items},offset:0,loadMore:!1,loading:!1}:t.state={data:[],offset:0,loadMore:!0,loading:!1},t}return r=l,(n=[{key:"mergeMoreFeed",value:function(e,t){var r=e.items.map((function(e){return e.id})),n=t.items.filter((function(e){return-1===r.indexOf(e.id)}));if(!n.length)return this.setState({loadMore:!1}),e;var o=e;return o.items=[].concat(ve(e.items),ve(n)),o.totalItems=o.items.length,o}},{key:"loadForProps",value:function(e){var t=this,r=e.context,n=e.pointOfView,o=e.contextData,i=e.limit,a=this.state,c=a.offset,l=a.data;void 0===i&&(i=-1),c>0&&(i=100),this.setState({loading:!0,error:null}),d.loadActivityStreams(r,o,"outbox",n,c,i).then((function(e){c>0&&l&&l.items?e&&e.items&&t.setState({data:t.mergeMoreFeed(l,e)}):t.setState({data:e}),e&&e.items&&e.items.length||t.setState({loadMore:!1}),t.setState({loading:!1})})).catch((function(e){t.setState({loading:!1,error:e})}))}},{key:"componentWillMount",value:function(){var e=this.props,t=e.items,r=e.contextData;t||r&&this.loadForProps(this.props)}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.items?this.setState({data:{items:e.items},offset:0,loadMore:!1}):e.contextData===this.props.contextData&&e.context===this.props.context||this.setState({offset:0,loadMore:!0},(function(){t.loadForProps(e)}))}},{key:"render",value:function(){var e,r=this,n=[],i=this.state,a=i.data,c=i.loadMore,l=i.loading,u=i.error,s=this.props,f=s.listContext,p=s.groupByDate,y=s.displayContext,d=s.pydio,b="mdi mdi-pulse",m=l?d.MessageHash["notification_center.17"]:d.MessageHash["notification_center.18"];u&&(m=u.Detail||u.msg||u,b="mdi mdi-alert-circle-outline");var v=function(){r.setState({offset:a.items.length+1},(function(){r.loadForProps(r.props)}))},h=l?d.MessageHash["notification_center.20"]:d.MessageHash["notification_center.19"];if(null!==a&&a.items){if("NODE-LEAF"===f||"NODE-COLLECTION"===f)return t().createElement(Ce,{items:a.items,className:"small",useSelection:!1,itemUuid:function(e){return e.id},itemMoment:function(e){return Ee(e.updated)},itemDesc:function(e){return t().createElement(fe,{activity:e,listContext:f,inlineActor:!0})},itemActions:function(){return[]},itemAnnotations:function(){return null},color:"#2196f3",loadMoreAction:a.items.length&&c?v:null,loadMoreLabel:h,loadMoreDisabled:l});var g={fontSize:13,color:"var(--md-sys-color-outline)",fontWeight:500};a.items.forEach((function(r,o){var i=Ee(r.updated).fromNow();p&&i!==e&&(n.length?(n.pop(),n.push(t().createElement("div",{style:be({padding:"20px 16px 0"},g)},i))):n.push(t().createElement("div",{style:be({padding:"0 16px"},g)},i))),n.push(t().createElement(pe,{key:r.id,activity:r,listContext:f,oneLiner:p,displayContext:y})),p&&(e=i,n.push(t().createElement("div",{style:{borderTop:"1px solid rgba(0,0,0,.03)",width:"100%"}})))})),p&&n.pop()}if(n.length&&c&&n.push(t().createElement("div",{style:{paddingLeft:16}},t().createElement(o.FlatButton,{primary:!0,label:h,disabled:l,onClick:v}))),n.length)return t().createElement(o.List,{style:this.props.style},n);var w,O,S={backgroundColor:"transparent"};return"popover"===y?S=be(be({},S),{},{minHeight:250}):"infoPanel"===y&&(S=be(be({},S),{},{paddingBottom:20,paddingTop:10}),w={fontSize:40},O={fontSize:13}),t().createElement(_e,{pydio:this.props.pydio,iconClassName:b,primaryTextId:m,style:S,iconStyle:w,legendStyle:O})}}])&&ge(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),l}(t().Component);function ke(e){return ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ke(e)}function Ae(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ke(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ke(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===ke(o)?o:String(o)),n)}var o}function Me(e,t){return Me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Me(e,t)}function Re(e){return Re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Re(e)}Te.PropTypes={context:a().string,contextData:a().string,boxName:a().string,pointOfView:a().oneOf(["GENERIC","ACTOR","SUBJECT"]),displayContext:a().oneOf(["mainList","infoPanel","popover"])},Te=Pe(Te);var De=Pydio.requireLib("boot").PydioContextConsumer,Le=Pydio.requireLib("workspaces").InfoPanelCard,Ie=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Me(e,t)}(c,e);var r,n,o,i,a=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Re(o);if(i){var r=Re(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===ke(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),a.apply(this,arguments)}return r=c,(n=[{key:"render",value:function(){var e=this.props,r=e.node,n=e.pydio,o=e.popoverPanel;if(!1===n.getPluginConfigs("core.activitystreams").get("ACTIVITY_SHOW_ACTIVITIES"))return null;var i=r.isLeaf()?"activity.leaf":"activity.folder",a=!r.isLeaf(),c=r.isLeaf()?n.MessageHash["notification_center.11"]:n.MessageHash["notification_center.10"];return t().createElement(Le,{key:i,identifier:i,defaultOpen:a,title:c,popoverPanel:o},t().createElement(Te,{context:"NODE_ID",contextData:r.getMetadata().get("uuid"),boxName:"outbox",style:{overflowY:"scroll",maxHeight:380,padding:"8px 12px"},listContext:"NODE-"+(r.isLeaf()?"LEAF":"COLLECTION"),pointOfView:"ACTOR",displayContext:"infoPanel"}))}}])&&Ae(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),c}(t().Component);Ie=De(Ie);var He=r(305),Ne=r.n(He);const qe=require("color");var Be=r.n(qe);function Ue(e){return Ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ue(e)}function We(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?We(Object(r),!0).forEach((function(t){ze(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):We(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ze(e,t,r){return(t=Ge(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ve(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ge(n.key),n)}}function Ge(e){var t=function(e,t){if("object"!==Ue(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Ue(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Ue(t)?t:String(t)}function Ye(e,t){return Ye=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ye(e,t)}function Je(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $e(e){return $e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},$e(e)}var Ke=l().requireLib("hoc").ThemedContainers.Popover,Qe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ye(e,t)}(l,e);var r,n,i,a,c=(i=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=$e(i);if(a){var r=$e(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Ue(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Je(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=c.call(this,e)).state={unreadStatus:0,open:!1,data:[]},t.reloadData=Ne()(t.reloadData.bind(Je(t)),500),t.reloadUnread=Ne()(t.reloadUnread.bind(Je(t)),500),t}return r=l,(n=[{key:"reloadData",value:function(){var e=this;d.loadActivityStreams("USER_ID",this.props.pydio.user.id,"inbox").then((function(t){e.setState({data:t})})).catch((function(t){e.setState({error:t})}))}},{key:"reloadUnread",value:function(){var e=this;d.UnreadInbox(this.props.pydio.user.id).then((function(t){e.setState({unreadStatus:t})})).catch((function(e){}))}},{key:"onStatusChange",value:function(){this.props.onUnreadStatusChange&&this.props.onUnreadStatusChange(this.state.unreadStatus)}},{key:"handleTouchTap",value:function(e){e.preventDefault(),this.reloadData(),this.setState({open:!0,anchorEl:e.currentTarget,unreadStatus:0},this.onStatusChange.bind(this))}},{key:"handleRequestClose",value:function(){this.setState({open:!1})}},{key:"componentWillMount",value:function(){var e=this;this.reloadUnread(),this.props.pydio.observe("websocket_event:activity",(function(t){e.state.open?e.reloadData():e.reloadUnread()}))}},{key:"render",value:function(){var e=this.props,r=e.pydio,n=e.iconStyle,i=e.muiTheme,a=this.state,c=a.open,l=a.anchorEl,u=a.unreadStatus,s={borderRadius:"50%"};return c&&n&&n.color&&(s=Fe(Fe({},s),{},{backgroundColor:Be()(n.color).fade(.9).toString()})),t().createElement("span",null,t().createElement("div",{style:{position:"relative",display:"inline-block"},badgeContent:this.state.unreadStatus,secondary:!0,badgeStyle:this.state.unreadStatus?null:{display:"none"}},t().createElement(o.IconButton,{onClick:this.handleTouchTap.bind(this),iconClassName:this.props.iconClassName||"mdi mdi-bell",tooltip:(u?u+" ":"")+this.props.pydio.MessageHash["notification_center.4"],className:"userActionButton alertsButton",iconStyle:n,style:s}),u>0&&t().createElement("div",{style:{width:6,height:6,borderRadius:"50%",top:9,right:6,position:"absolute",backgroundColor:i.palette.accent1Color}})),t().createElement(Ke,{open:c,anchorEl:l,anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"},onRequestClose:this.handleRequestClose.bind(this),style:{width:320},zDepth:3,panelTitle:r.MessageHash["notification_center.1"],panelIconClassName:"mdi mdi-bell"},this.state.data&&t().createElement(Te,{items:this.state.data.items,style:{overflowY:"scroll",maxHeight:420,paddingTop:20},groupByDate:!0,displayContext:"popover"})))}}])&&Ve(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),l}(t().Component);function Xe(e){return Xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xe(e)}function Ze(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Xe(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Xe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Xe(o)?o:String(o)),n)}var o}Qe=(0,v.muiThemeable)()(Qe);var et=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"dynamicBuilder",value:function(e){var t=r.g.pydio,n=t.MessageHash,o=t.getUserSelection().getUniqueNode();if(!o)return[];var i,a=[];return o.getMetadata().get("meta_watched")&&(i=o.getMetadata().get("meta_watched")),a.push({name:n["meta.watch.11"],alt:n["meta.watch."+(o.isLeaf()?"12":"12b")],icon_class:i&&"META_WATCH_CHANGE"===i?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_change")}.bind(this)}),a.push({name:n["meta.watch.9"],alt:n["meta.watch."+(o.isLeaf()?"10":"10b")],icon_class:i&&"META_WATCH_READ"===i?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_read")}.bind(this)}),a.push({name:n["meta.watch.13"],alt:n["meta.watch."+(o.isLeaf()?"14":"14b")],icon_class:i&&"META_WATCH_BOTH"===i?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_both")}.bind(this)}),i&&(a.push({separator:!0}),a.push({name:n["meta.watch.3"],alt:n["meta.watch."+(o.isLeaf()?"8":"4")],icon_class:"mdi mdi-close-circle-outline",callback:function(e){this.apply("watch_stop")}.bind(this)})),a}}],null&&Ze(t.prototype,null),n&&Ze(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function tt(e){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tt(e)}function rt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==tt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==tt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===tt(o)?o:String(o)),n)}var o}var nt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"toggleWatch",value:function(e,t){if(t){var r=pydio.getUserSelection().getUniqueNode(),n=r.getMetadata().get("uuid"),o=pydio.user.id,i=new f.ActivitySubscription,a=new f.ActivityOwnerType;i.UserId=o,i.ObjectId=n,i.ObjectType=a.NODE;var c=[];"watch_change"!==t&&"watch_both"!==t||c.push("change"),"watch_read"!==t&&"watch_both"!==t||c.push("read"),i.Events=c,new f.ActivityServiceApi(s().getRestClient()).subscribe(i).then((function(e){var n=r.getMetadata().get("overlay_class")||"";if("watch_stop"===t)r.getMetadata().delete("meta_watched"),r.getMetadata().set("overlay_class",n.replace("mdi mdi-bell",""));else{r.getMetadata().set("meta_watched","META_"+t.toUpperCase());var o=n.replace("mdi mdi-bell","").split(",");o.push("mdi mdi-bell"),r.getMetadata().set("overlay_class",o.join(","))}r.notify("node_replaced")}))}}}],null&&rt(t.prototype,null),r&&rt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ot(e){return ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ot(e)}function it(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ot(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ot(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===ot(o)?o:String(o)),n)}var o}function at(e,t){return at=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},at(e,t)}function ct(e){return ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ct(e)}var lt=l().requireLib("hoc").ModernSelectField;const ut=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&at(e,t)}(u,e);var r,n,i,a,c=(i=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ct(i);if(a){var r=ct(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===ot(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function u(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var r=(t=c.call(this,e)).props.nodes;return t.state=t.valueFromNodes(r),t}return r=u,n=[{key:"valueFromNodes",value:function(){var e=!1,t=void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(r){var n=r.getMetadata().get("meta_watched")||"";void 0!==t&&n!==t&&(e=!0),t=n})),{value:t,mixed:e}}},{key:"onSelectorChange",value:function(e){var t=this;if("mixed"!==e){var r=this.props,n=r.pydio,o=r.nodes;this.setState({saving:!0});var i=o.map((function(t){var r=t.getMetadata().get("uuid"),o=n.user.id,i=new f.ActivitySubscription,a=new f.ActivityOwnerType;i.UserId=o,i.ObjectId=r,i.ObjectType=a.NODE;var c=[];return"META_WATCH_CHANGE"!==e&&"META_WATCH_BOTH"!==e||c.push("change"),"META_WATCH_READ"!==e&&"META_WATCH_BOTH"!==e||c.push("read"),i.Events=c,new f.ActivityServiceApi(s().getRestClient()).subscribe(i).then((function(r){var n=t.getMetadata().get("overlay_class")||"";if(""===e)t.getMetadata().delete("meta_watched"),t.getMetadata().set("overlay_class",n.replace("mdi mdi-bell",""));else{t.getMetadata().set("meta_watched",e);var o=n.replace("mdi mdi-bell","").split(",");o.push("mdi mdi-bell"),t.getMetadata().set("overlay_class",o.join(","))}t.notify("node_replaced")}))}));Promise.all(i).then((function(){t.setState({value:e,mixed:!1}),window.setTimeout((function(){t.setState({saving:!1})}),250)})).catch((function(){t.setState({saving:!1})}))}}},{key:"render",value:function(){var e=this,r=this.state,n=r.value,i=r.mixed,a=r.saving,c=l().getInstance().MessageHash;return a?t().createElement(lt,{value:"saving",onChange:function(e,t,r){},disabled:!0},t().createElement(o.MenuItem,{value:"saving",primaryText:c["meta.watch.selector.saving"]+"..."})):t().createElement(lt,{value:i?"mixed":n,onChange:function(t,r,n){e.onSelectorChange(n)}},i&&t().createElement(o.MenuItem,{value:"mixed",primaryText:c["meta.watch.selector.mixed"]+"..."}),t().createElement(o.MenuItem,{value:"",primaryText:c["meta.watch.selector.ignore"]}),t().createElement(o.MenuItem,{value:"META_WATCH_READ",primaryText:c["meta.watch.selector.read"]}),t().createElement(o.MenuItem,{value:"META_WATCH_CHANGE",primaryText:c["meta.watch.selector.change"]}),t().createElement(o.MenuItem,{value:"META_WATCH_BOTH",primaryText:c["meta.watch.selector.both"]}))}}],n&&it(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),u}(t().Component);function st(e){return st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},st(e)}function ft(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==st(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==st(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===st(o)?o:String(o)),n)}var o}function pt(e,t){return pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},pt(e,t)}function yt(e){return yt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},yt(e)}var dt=l().requireLib("workspaces").InfoPanelCard,bt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pt(e,t)}(c,e);var r,n,o,i,a=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=yt(o);if(i){var r=yt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===st(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),a.apply(this,arguments)}return r=c,(n=[{key:"render",value:function(){var e=this.props,r=e.pydio,n=e.node,o=e.style,i=e.popoverPanel;return t().createElement(dt,{identifier:"meta-user",style:o,title:r.MessageHash["meta.watch.1-off"],popoverPanel:i},t().createElement("div",{style:{padding:"0 16px 10px"}},t().createElement(ut,{pydio:r,nodes:[n]})))}}])&&ft(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),c}(e.Component)})(),window.PydioActivityStreams=n})();