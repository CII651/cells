(()=>{"use strict";var e={173:e=>{e.exports=require("material-ui/styles")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{r.r(n),r.d(n,{Callbacks:()=>Ut,Dashboard:()=>Yt,Editor:()=>Nn,Forms:()=>_n,PoliciesBoard:()=>Ar,RolesDashboard:()=>ir,TreeGroupsDialog:()=>Gr});const e=require("react");var t=r.n(e);const o=require("create-react-class");var i=r.n(o);const a=require("prop-types");var s=r.n(a);const l=require("material-ui"),c=require("pydio");var u=r.n(c);const p=require("pydio/lang/observable");var f=r.n(p);const d=require("pydio/http/api");var y=r.n(d);const m=require("cells-sdk");var h="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),b=new Uint8Array(16);function g(){if(!h)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return h(b)}for(var v=[],O=0;O<256;++O)v[O]=(O+256).toString(16).substr(1);const P=function(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||g)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var i=0;i<16;++i)t[n+i]=o[i];return t||function(e,t){var r=t||0,n=v;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}(o)};function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function S(e){return function(e){if(Array.isArray(e))return E(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return E(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function j(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==w(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===w(o)?o:String(o)),n)}var o}function R(e,t){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},R(e,t)}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}(s,e);var t,r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=k(o);if(i){var r=k(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this)).acls=[],t.dirty=!1,t.parentRoles=r,t.parentAcls={},e?t.idmRole=e:(t.idmRole=new m.IdmRole,t.idmRole.Uuid=P()),t.makeSnapshot(),t}return t=s,r=[{key:"load",value:function(){return this.loadAcls()}},{key:"isDirty",value:function(){return this.dirty}},{key:"getIdmRole",value:function(){return this.buildProxy(this.idmRole)}},{key:"makeSnapshot",value:function(){var e=this;this.snapshot=m.IdmRole.constructFromObject(JSON.parse(JSON.stringify(this.idmRole))),this.aclSnapshot=[],this.acls.forEach((function(t){e.aclSnapshot.push(m.IdmACL.constructFromObject(JSON.parse(JSON.stringify(t))))}))}},{key:"updateParentRoles",value:function(e){var t=this;this.parentRoles=e,this.loadAcls(!0).then((function(){t.notify("update")}))}},{key:"loadAcls",value:function(){var e,t=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=new m.ACLServiceApi(y().getRestClient()),o=new m.RestSearchACLRequest;o.Queries=[];var i=new m.IdmACLSingleQuery;return i.RoleIDs=[],r||(i.RoleIDs=[this.idmRole.Uuid]),(e=i.RoleIDs).push.apply(e,S(this.parentRoles.map((function(e){return e.Uuid})))),o.Queries.push(i),n.searchAcls(o).then((function(e){var n=s.FormatPolicyAclFromStore(e.ACLs||[]);t.parentRoles.length?(r||(t.acls=n.filter((function(e){return e.RoleID===t.idmRole.Uuid}))),t.parentRoles.forEach((function(e){t.parentAcls[e.Uuid]=n.filter((function(t){return t.RoleID===e.Uuid}))}))):t.acls=n,r||t.makeSnapshot()}))}},{key:"revert",value:function(){this.idmRole=this.snapshot,this.acls=this.aclSnapshot,this.dirty=!1,this.makeSnapshot(),this.notify("update")}},{key:"save",value:function(){var e=this,t=new m.RoleServiceApi(y().getRestClient()),r=new m.ACLServiceApi(y().getRestClient());return t.setRole(this.idmRole.Uuid,this.idmRole).then((function(t){e.idmRole=t;var n=new m.RestSearchACLRequest;n.Queries=[];var o=new m.IdmACLSingleQuery;return o.RoleIDs=[e.idmRole.Uuid],n.Queries.push(o),r.searchAcls(n).then((function(t){var o=t.ACLs||[],i=s.FormatPolicyAclToStore(e.acls),a=e.diffAcls(o,i),l=a.inserts,c=a.deletes;return Promise.all(c.map((function(e){return r.deleteAcl(e)}))).then((function(){return Promise.all(l.map((function(e){return r.putAcl(e)}))).then((function(t){return r.searchAcls(n).then((function(t){e.acls=s.FormatPolicyAclFromStore(t.ACLs||[]),e.makeSnapshot(),e.dirty=!1,e.notify("update")}))}))}))}))}))}},{key:"diffAcls",value:function(e,t){var r=this,n=e.filter((function(e){return!t.find((function(t){return r.equals(e,t)}))}));return{inserts:t.filter((function(t){return!e.find((function(e){return r.equals(t,e)}))})),deletes:n}}},{key:"equals",value:function(e,t){return e.NodeID===t.NodeID&&e.Action.Name===t.Action.Name&&e.Action.Value===t.Action.Value&&e.WorkspaceID===t.WorkspaceID}},{key:"setParameter",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PYDIO_REPO_SCOPE_ALL",o=this.acls.filter((function(t){return t.Action.Name===e&&t.WorkspaceID===n}));if(o.length){var i=o[0],a=void 0;this.parentRoles.forEach((function(t){a=r.getAclValue(r.parentAcls[t.Uuid],e,n,a)})),void 0!==a&&a===t?this.acls=this.acls.filter((function(e){return e!==i})):i.Action.Value=JSON.stringify(t)}else{var s=new m.IdmACL;s.RoleID=this.idmRole.Uuid,s.WorkspaceID=n,s.Action=new m.IdmACLAction,s.Action.Name=e,s.Action.Value=JSON.stringify(t),this.acls.push(s)}this.dirty=!0,this.notify("update")}},{key:"deleteParameter",value:function(e){this.acls=this.acls.filter((function(t){return t!==e})),this.dirty=!0,this.notify("update")}},{key:"getParameterValue",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"PYDIO_REPO_SCOPE_ALL",n=void 0;return this.parentRoles.forEach((function(o){n=t.getAclValue(t.parentAcls[o.Uuid],e,r,n)})),this.getAclValue(this.acls,e,r,n)}},{key:"listParametersAndActions",value:function(){var e=this,t=function(e){return e.Action.Name&&(0===e.Action.Name.indexOf("parameter:")||0===e.Action.Name.indexOf("action:"))},r=this.acls||[];return r=r.filter(t),this.parentRoles.forEach((function(n){var o=e.parentAcls[n.Uuid]||[];o=o.filter(t).filter((function(e){return!r.filter((function(t){return t.Action.Name===e.Action.Name})).length})).map((function(e){var t=m.IdmACL.constructFromObject(JSON.parse(JSON.stringify(e)));return t.INHERITED=!0,t})),r=[].concat(S(r),S(o))})),r}},{key:"getAclValue",value:function(e,t,r,n){if(!e)return n;var o=e.filter((function(e){return e.Action.Name===t&&e.WorkspaceID===r}));try{return JSON.parse(o[0].Action.Value)}catch(e){return n}}},{key:"getAclString",value:function(e,t){var r,n,o,i,a=this,s=!1;if(e){var l=e.RootNodes,c=l[Object.keys(l).shift()];r=e.UUID,n=c.Uuid}else n=t;this.parentRoles.forEach((function(e){var t=a._aclStringForAcls(a.parentAcls[e.Uuid],r,n);void 0!==t&&(i=t)}));var u=this._aclStringForAcls(this.acls,r,n);if(void 0!==u)o=u;else{if(void 0===i)return{aclString:""};o=i,s=!0}return{aclString:Object.keys(o).filter((function(e){return o[e]})).join(","),inherited:s}}},{key:"_aclStringForAcls",value:function(e,t,r){if(e){var n={read:!1,write:!1,deny:!1},o=e.filter((function(e){return e.Action.Name&&0===e.Action.Name.indexOf("policy:")&&(!t||e.WorkspaceID===t)&&e.NodeID===r&&"1"===e.Action.Value}));return o.length?(n[o[0].Action.Name]=!0,n):(Object.keys(n).forEach((function(o){e.filter((function(e){return e.Action.Name===o&&(!t||e.WorkspaceID===t)&&e.NodeID===r&&"1"===e.Action.Value})).length&&(n[o]|=!0)})),n.read||n.write||n.deny?n:void 0)}}},{key:"updateAcl",value:function(e,t,r){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=[],a=!1;t?(i=[t],a=o&&Object.keys(o.RootNodes).indexOf(t)>-1):i=Object.keys(e.RootNodes),this.acls=e?this.acls.filter((function(t){return!(("read"===t.Action.Name||"write"===t.Action.Name||"deny"===t.Action.Name||t.Action.Name&&0===t.Action.Name.indexOf("policy:"))&&t.WorkspaceID===e.UUID&&i.indexOf(t.NodeID)>-1&&"1"===t.Action.Value)})):this.acls.filter((function(e){return!(("read"===e.Action.Name||"write"===e.Action.Name||"deny"===e.Action.Name||e.Action.Name&&0===e.Action.Name.indexOf("policy:"))&&e.NodeID===t&&"1"===e.Action.Value)})),""!==r&&r.split(",").forEach((function(t){i.forEach((function(r){var i=new m.IdmACL;i.NodeID=r,e?i.WorkspaceID=e.UUID:a&&(i.WorkspaceID=o.UUID),i.RoleID=n.idmRole.Uuid,i.Action=m.IdmACLAction.constructFromObject({Name:t,Value:"1"}),n.acls.push(i)}))})),this.dirty=!0,this.notify("update")}},{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,r,n){return e[r]=n,t.dirty=!0,t.notify("update"),!0},get:function(e,r){var n=e[r];return n instanceof Array?n:n instanceof Object?t.buildProxy(n):n}})}}],n=[{key:"FormatPolicyAclFromStore",value:function(e){return e.map((function(e){return e.Action&&"policy"===e.Action.Name&&(e.Action.Name="policy:"+e.Action.Value,e.Action.Value="1"),e}))}},{key:"FormatPolicyAclToStore",value:function(e){return e.map((function(e){if(e.Action&&0===e.Action.Name.indexOf("policy:")){var t=m.IdmACL.constructFromObject(JSON.parse(JSON.stringify(e)));return t.Action.Name="policy",t.Action.Value=e.Action.Name.split(":")[1],t}return e}))}}],r&&j(t.prototype,r),n&&j(t,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(f());function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function x(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return M(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?M(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function N(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==A(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==A(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===A(o)?o:String(o)),n)}var o}function _(e,t){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_(e,t)}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}var T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_(e,t)}(a,e);var t,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=I(n);if(o){var r=I(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===A(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this)).acls=[];var r=[];return e?(t.idmUser=e,t.idmUser.Roles&&(t.idmRole=t.idmUser.Roles.filter((function(e){return e.Uuid===t.idmUser.Uuid}))[0],t.idmUser.IsGroup||(r=t.idmUser.Roles.filter((function(e){return e.Uuid!==t.idmUser.Uuid})))),t.idmUser.Attributes||(t.idmUser.Attributes={})):(t.idmUser=new m.IdmUser,t.idmUser.Uuid=P(),t.idmRole=m.IdmRole.constructFromObject({Uuid:t.idmUser.Uuid}),t.idmUser.Roles=[t.idmRole],t.idmUser.Attributes={}),t.role=new C(t.idmRole,r),t.role.observe("update",(function(){t.dirty|=t.role.isDirty(),t.notify("update")})),t.makeSnapshot(),t}return t=a,r=[{key:"load",value:function(){var e=this;this.role.load().then((function(){e.notify("update")}))}},{key:"isDirty",value:function(){return this.dirty}},{key:"save",value:function(){var e=this;return PydioApi.getRestClient().getIdmApi().updateIdmUser(this.idmUser).then((function(t){return e.idmUser=t,e.role.isDirty()?e.role.save().then((function(){e.makeSnapshot(),e.dirty=!1,e.notify("update")})):(e.makeSnapshot(),e.dirty=!1,e.notify("update"),Promise.resolve(e))}))}},{key:"revert",value:function(){this.idmUser=this.snapshot,this.makeSnapshot(),this.dirty=!1,this.notify("update"),this.role.revert()}},{key:"makeSnapshot",value:function(){this.snapshot=m.IdmUser.constructFromObject(JSON.parse(JSON.stringify(this.idmUser)))}},{key:"getRole",value:function(){return this.role}},{key:"addRole",value:function(e){var t=this,r=this.idmUser.Roles.filter((function(e){return e.Uuid!==t.idmUser.Uuid}));r=[].concat(x(r.filter((function(t){return t.Uuid!==e.Uuid}))),[e]),this.idmUser.Roles=[].concat(x(r),[this.idmRole]),this.dirty=!0,this.role.updateParentRoles(r)}},{key:"removeRole",value:function(e){var t=this,r=this.idmUser.Roles.filter((function(r){return r.Uuid!==t.idmUser.Uuid&&r.Uuid!==e.Uuid}));this.idmUser.Roles=[].concat(x(r),[this.idmRole]),this.dirty=!0,this.role.updateParentRoles(r)}},{key:"switchRoles",value:function(e,t){for(var r,n,o,i=this,a=this.idmUser.Roles.filter((function(e){return e.Uuid!==i.idmUser.Uuid})),s=0;s<a.length;s++)a[s].Uuid===e?(r=s,o=a[s]):a[s].Uuid===t&&(n=s);a[r]=a[n],a[n]=o,this.idmUser.Roles=[].concat(x(a),[this.idmRole]),this.dirty=!0,this.role.updateParentRoles(a)}},{key:"getIdmUser",value:function(){return this.buildProxy(this.idmUser)}},{key:"buildProxy",value:function(e){var t=this;return new Proxy(e,{set:function(e,r,n){return e[r]=n,t.dirty=!0,t.notify("update"),!0},get:function(e,r){var n=e[r];return n instanceof Array?n:n instanceof Object?t.buildProxy(n):n}})}}],r&&N(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),a}(f());const D=require("pydio/util/lang");var U=r.n(D);function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function B(){return B=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},B.apply(this,arguments)}function F(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==L(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===L(o)?o:String(o)),n)}var o}function q(e,t){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},q(e,t)}function W(e){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},W(e)}var H={contextTypes:{messages:s().object,getMessage:s().func,getPydioRoleMessage:s().func,getRootMessage:s().func}};function V(r){return function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&q(e,t)}(l,e);var n,o,i,a,s=(i=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=W(i);if(a){var r=W(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===L(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),s.apply(this,arguments)}return n=l,o=[{key:"render",value:function(){var e=this.props.pydio;e||(e=u().getInstance());var n=e.MessageHash;return t().createElement(r,B({},this.props,{getMessage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pydio_role";return n[t+(t?".":"")+e]||e},getPydioRoleMessage:function(e){return n["role_editor."+e]||e},getRootMessage:function(e){return n[e]||e},getAdminMessage:function(e){return n["ajxp_admin."+e]||e}}))}}],o&&F(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),l}(e.Component)}function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function G(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==z(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===z(o)?o:String(o)),n)}var o}function K(e,t){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},K(e,t)}function J(e){return J=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},J(e)}s().object,s().func,s().func,s().func;const $=V(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&K(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=J(o);if(i){var r=J(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={acl:e.acl},t}return r=s,(n=[{key:"componentWillReceiveProps",value:function(e){this.setState({acl:e.acl})}},{key:"getAcl",value:function(){return this.state.acl}},{key:"updateAcl",value:function(){if(!this.props.disabled){var e,t=this.refs.deny.isChecked(),r=!t&&this.refs.read.isChecked(),n=!t&&this.refs.write.isChecked(),o=[];t?o.push("deny"):(r&&o.push("read"),n&&o.push("write")),e=o.join(","),this.props.onChange&&this.props.onChange(e,this.props.acl),this.setState({acl:e})}}},{key:"handleChangePolicy",value:function(e,t){var r="policy:"+t;this.props.onChange?this.props.onChange(r,this.props.acl):this.setState({acl:r})}},{key:"render",value:function(){var e=this.props,r=e.hideDeny,n=e.hideLabels,o=e.disabled,i=e.getMessage,a=this.state.acl||"";if(a.startsWith("policy:"))return t().createElement("div",{style:{display:"flex",alignItems:"center",width:132,height:40}},"Custom policy");var s={width:44};return t().createElement("div",{style:{display:"flex",alignItems:"center",width:132,height:40}},t().createElement(l.Checkbox,{ref:"read",label:n?"":i("react.5a","ajxp_admin"),value:"read",onCheck:this.updateAcl.bind(this),disabled:o||a.indexOf("deny")>-1,checked:-1===a.indexOf("deny")&&-1!==a.indexOf("read"),style:s}),t().createElement(l.Checkbox,{ref:"write",label:n?"":i("react.5b","ajxp_admin"),value:"write",onCheck:this.updateAcl.bind(this),disabled:o||a.indexOf("deny")>-1,checked:-1===a.indexOf("deny")&&-1!==a.indexOf("write"),style:s}),!r&&t().createElement(l.Checkbox,{ref:"deny",label:n?"":i("react.5","ajxp_admin"),value:"-",disabled:o,onCheck:this.updateAcl.bind(this),checked:-1!==a.indexOf("deny"),style:s}))}}])&&G(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component));function Y(e){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y(e)}function Q(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Y(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Y(o)?o:String(o)),n)}var o}function X(e,t){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},X(e,t)}function Z(e){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Z(e)}const ee=V(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&X(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Z(o);if(i){var r=Z(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return r=s,(n=[{key:"onAclChange",value:function(e,t){var r=this.props,n=r.role,o=r.workspace;n.updateAcl(o,null,e)}},{key:"render",value:function(){var e=this.props,r=e.workspace,n=e.role,o=e.getPydioRoleMessage;if(!r.RootNodes||!Object.keys(r.RootNodes).length)return t().createElement(PydioComponents.ListEntry,{className:"workspace-acl-entry",firstLine:t().createElement("span",{style:{textDecoration:"line-through",color:"#ef9a9a"}},r.Label+" ("+o("workspace.roots.invalid")+")")});var i=n.getAclString(r),a=i.aclString,s=i.inherited,l=t().createElement($,{acl:a,onChange:this.onAclChange.bind(this),hideLabels:!0}),c=r.Label+(s?" ("+o("38")+")":"");return t().createElement(PydioComponents.ListEntry,{className:(s?"workspace-acl-entry-inherited ":"")+"workspace-acl-entry",firstLine:c,actions:l})}}])&&Q(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component));function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==te(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===te(o)?o:String(o)),n)}var o}function ne(e,t){return ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ne(e,t)}function oe(e){return oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},oe(e)}var ie=u().requireLib("components").MaterialTable,ae=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ne(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=oe(o);if(i){var r=oe(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===te(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={loading:!0,workspaces:[]};var r=new m.WorkspaceServiceApi(y().getRestClient()),n=new m.RestSearchWorkspaceRequest;return n.Queries=[m.IdmWorkspaceSingleQuery.constructFromObject({scope:"ADMIN"})],r.searchWorkspaces(n).then((function(e){var r=e.Workspaces||[];r.sort(U().arraySorter("Label",!1,!0)),t.setState({workspaces:r,loading:!1})})).catch((function(e){t.setState({loading:!1})})),t}return r=s,(n=[{key:"render",value:function(){var e=this.props,r=e.role,n=e.advancedAcl,o=this.state,i=o.workspaces,a=o.loading;if(!r)return t().createElement("div",null);var s=[{name:"acl",label:"",style:{paddingLeft:0,paddingRight:0},renderCell:function(e){return t().createElement(ee,{workspace:e,role:r,advancedAcl:n})}}];return t().createElement("div",{className:"material-list"},t().createElement(ie,{data:i,columns:s,hideHeaders:!0,paginate:[10,25,50,100],defaultPageSize:25,showCheckboxes:!1,emptyStateString:a?u().getInstance().MessageHash["ajxp_admin.loading"]:""}))}}])&&re(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function le(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==se(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===se(o)?o:String(o)),n)}var o}function ce(e,t){return ce=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ce(e,t)}function ue(e){return ue=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ue(e)}var pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ce(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ue(o);if(i){var r=ue(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===se(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=a.call(this,e);var r=function(t){return e.pydio.MessageHash["pydio_role."+t]||t},n=[],o=new m.IdmWorkspace;if(o.UUID="homepage",o.Label=r("workspace.statics.home.title"),o.Description=r("workspace.statics.home.description"),o.Slug="homepage",o.RootNodes={"homepage-ROOT":m.TreeNode.constructFromObject({Uuid:"homepage-ROOT"})},n.push(o),e.showSettings){var i=new m.IdmWorkspace;i.UUID="settings",i.Label=r("workspace.statics.settings.title"),i.Description=r("workspace.statics.settings.description"),i.Slug="settings",i.RootNodes={"settings-ROOT":m.TreeNode.constructFromObject({Uuid:"settings-ROOT"})},n.push(i)}return n.sort(U().arraySorter("Label",!1,!0)),t.state={workspaces:n},t}return r=s,(n=[{key:"render",value:function(){var e=this.props.role,r=this.state.workspaces;return e?t().createElement("div",{style:{backgroundColor:"white"},className:"material-list"},r.map((function(r){return t().createElement(ee,{workspace:r,role:e})}))):t().createElement("div",null)}}])&&le(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);const fe=require("pydio/util/path");var de=r.n(fe),ye=r(173);function me(e){return me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},me(e)}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==me(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==me(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===me(o)?o:String(o)),n)}var o}function ge(e,t){return ge=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ge(e,t)}function ve(e){return ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ve(e)}var Oe=u().requireLib("form").FormPanel,Pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ge(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ve(o);if(i){var r=ve(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===me(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={parameters:[]},AdminComponents.PluginsLoader.getInstance(e.pydio).formParameters("//global_param[contains(@scope,'role')]|//param[contains(@scope,'role')]").then((function(e){t.setState({parameters:e})})),t}return r=s,(n=[{key:"getPydioRoleMessage",value:function(e){return this.props.pydio.MessageHash["role_editor."+e]||e}},{key:"onParameterChange",value:function(e,t,r){var n=this.props.role,o=n.getIdmRole();if("applies"===e)o.AutoApplies=t.split(",");else if("roleLabel"===e)o.Label=t;else if("roleForceOverride"===e)o.ForceOverride=t;else{var i=this.getParameterByName(e);i.aclKey&&n.setParameter(i.aclKey,t)}}},{key:"getParameterByName",value:function(e){return this.state.parameters.filter((function(t){return t.name===e}))[0]}},{key:"render",value:function(){var e=this.props,r=e.role,n=e.pydio,o=this.state.parameters;if(!o)return t().createElement("div",null,n.MessageHash["ajxp_admin.loading"]);var i,a={admin:"157",standard:"156",shared:"158",anon:"159"},s=Object.keys(a).map((function(e){return e+"|"+n.MessageHash["settings."+a[e]]})).join(","),l=[{name:"roleId",label:this.getPydioRoleMessage("31"),type:"string",readonly:!0,description:this.getPydioRoleMessage("role.id.description")},{name:"roleLabel",label:this.getPydioRoleMessage("32"),type:"string",description:this.getPydioRoleMessage("role.label.description")},{name:"applies",label:this.getPydioRoleMessage("33"),type:"select",multiple:!0,choices:s,description:this.getPydioRoleMessage("role.autoapply.description")},{name:"roleForceOverride",label:this.getPydioRoleMessage("role.override.label"),type:"boolean",description:this.getPydioRoleMessage("role.override.description")}].concat(function(e){if(Array.isArray(e))return he(e)}(i=o)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(i)||function(e,t){if(e){if("string"==typeof e)return he(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?he(e,t):void 0}}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c={applies:[]};if(r){var u=r.getIdmRole(),p=u.AutoApplies||[];c={roleId:u.Uuid,applies:p.filter((function(e){return!!e})),roleLabel:u.Label,roleForceOverride:u.ForceOverride||!1},o.map((function(e){e.aclKey&&r.getParameterValue(e.aclKey)&&(c[e.name]=r.getParameterValue(e.aclKey))}))}return t().createElement(Oe,{parameters:l,onParameterChange:this.onParameterChange.bind(this),values:c,depth:-2,variant:"v2"})}}])&&be(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);function we(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Pe.PropTypes={pydio:s().instanceOf(u()).isRequired,pluginsRegistry:s().instanceOf(XMLDocument),role:s().instanceOf(C)};const Se=i()({displayName:"UserRolesPicker",mixins:[H],propTypes:{profile:s().string,roles:s().array,addRole:s().func,removeRole:s().func,switchRoles:s().func},getInitialState:function(){return{availableRoles:[]}},componentDidMount:function(){var e=this;y().getRestClient().getIdmApi().listRoles().then((function(t){e.setState({availableRoles:t})}))},onChange:function(e,t,r){-1!==r&&this.props.addRole(r)},remove:function(e){var t=this.state.availableRoles.filter((function(t){return t.Uuid===e}))[0];this.props.removeRole(t)},orderUpdated:function(e,t,r){this.props.switchRoles(e,t)},render:function(){var e=[],r=[],n=[],o=this.context,i=this.props,a=i.roles,s=i.loadingMessage,c=i.profile,u=this.state.availableRoles;a.map(function(t){t.GroupRole?"ROOT_GROUP"===t.Uuid?e.push("/ "+o.getMessage("user.25","ajxp_admin")):e.push(o.getMessage("user.26","ajxp_admin").replace("%s",t.Label||t.Uuid)):t.UserRole?n.push(o.getMessage("user.27","ajxp_admin")):t.AutoApplies&&-1!==t.AutoApplies.indexOf(c)?e.push(t.Label+" [auto]"):r.push({payload:t.Uuid,text:t.Label})}.bind(this));var p,f=[t().createElement(l.MenuItem,{value:-1,primaryText:o.getMessage("20")})].concat(function(e){if(Array.isArray(e))return we(e)}(p=u.filter((function(e){return-1===a.indexOf(e)})).map((function(e){return t().createElement(l.MenuItem,{value:e,primaryText:e.Label||e.Uuid})})))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(p)||function(e,t){if(e){if("string"==typeof e)return we(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?we(e,t):void 0}}(p)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),d={padding:10,fontSize:14,backgroundColor:"rgb(246 246 248)",borderRadius:2,margin:"8px 0"};return t().createElement("div",{className:"user-roles-picker",style:{padding:0,paddingBottom:12,margin:"-30px 20px 40px",backgroundColor:"white",borderRadius:6,border:"1px solid #dfe3e5"}},t().createElement("div",{style:{paddingLeft:16,display:"flex",alignItems:"center"}},t().createElement("div",{style:{flex:1,fontSize:16}},o.getMessage("roles.picker.title")," ",s?" ("+o.getMessage("21")+")":""),t().createElement("div",{className:"roles-picker-menu",style:{marginBottom:-12}},t().createElement(l.DropDownMenu,{underlineStyle:{display:"none"},onChange:this.onChange,value:-1},f))),t().createElement("div",{className:"roles-list",style:{margin:"0 16px",paddingBottom:1}},e.map((function(e){return t().createElement("div",{key:"group-"+e,style:d},e)})),t().createElement(PydioComponents.SortableList,{key:"sortable",values:r,removable:!0,onRemove:this.remove,onOrderUpdated:this.orderUpdated,itemClassName:"role-item role-item-sortable"}),n.map((function(e){return t().createElement("div",{key:"user-"+e,style:d},e)}))))}});function Ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function je(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Re(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?je(Object(r),!0).forEach((function(t){ke(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):je(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ke(e,t,r){return(t=xe(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ce(e){return Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ce(e)}function Ae(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,xe(n.key),n)}}function xe(e){var t=function(e,t){if("object"!==Ce(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Ce(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Ce(t)?t:String(t)}function Me(e,t){return Me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Me(e,t)}function Ne(e){return Ne=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ne(e)}var _e=u().requireLib("form").FormPanel,Ie=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Me(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ne(o);if(i){var r=Ne(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Ce(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={parameters:[]},AdminComponents.PluginsLoader.getInstance(e.pydio).formParameters('//global_param[contains(@scope,"user")]|//param[contains(@scope,"user")]').then((function(e){t.setState({parameters:e})})),t}return r=s,(n=[{key:"getBinaryContext",value:function(){var e=this.props.user;return"user_id="+e.getIdmUser().Login+(e.getIdmUser().Attributes&&e.getIdmUser().Attributes.avatar?"?"+e.getIdmUser().Attributes.avatar:"")}},{key:"getPydioRoleMessage",value:function(e){return this.props.pydio.MessageHash["role_editor."+e]||e}},{key:"onParameterChange",value:function(e,t,r){var n=this.props.user,o=this.state.parameters.filter((function(t){return t.name===e})),i=n.getIdmUser(),a=n.getRole();"displayName"===e||"email"===e||"profile"===e||"avatar"===e?i.Attributes[e]=t:o.length&&o[0].aclKey&&a.setParameter(o[0].aclKey,t)}},{key:"buttonCallback",value:function(e){var t=this.props.user;if("update_user_pwd"===e)this.props.pydio.UI.openComponentInModal("AdminPeople","Editor.User.UserPasswordDialog",{user:t});else{var r=t.getIdmUser(),n="user_set_lock-lock"===e?"logout":"pass_change",o=[];if(r.Attributes.locks){var i=JSON.parse(r.Attributes.locks);i&&"object"===Ce(i)&&(o=i)}o.indexOf(n)>-1?(o=o.filter((function(e){return e!==n})),"user_set_lock-lock"===e&&delete r.Attributes.failedConnections):o.push(n),r.Attributes.locks=JSON.stringify(o),t.save()}}},{key:"render",value:function(){var e=this,r=this.props,n=r.user,o=r.pydio,i=this.state,a=i.parameters,s=i.showLegends;if(!a)return t().createElement("div",null,"Loading...");var c,u={profiles:[]},p=[];if(n){var f=n.getIdmUser(),d=n.getRole();if(f.Attributes.locks&&"object"===Ce(p=JSON.parse(f.Attributes.locks)||[])&&void 0===p.length){var y=[];Object.keys(p).forEach((function(e){!0===p[e]&&y.push(e)})),p=y}c=t().createElement(Se,{profile:f.Attributes?f.Attributes.profile:"",roles:f.Roles,addRole:function(e){return n.addRole(e)},removeRole:function(e){return n.removeRole(e)},switchRoles:function(e,t){return n.switchRoles(e,t)}});var m=f.Attributes||{};u=Re(Re({},u),{},{avatar:m.avatar,displayName:m.displayName,email:m.email,profile:m.profile,login:f.Login}),a.map((function(e){e.aclKey&&d.getParameterValue(e.aclKey)&&(u[e.name]=d.getParameterValue(e.aclKey))}))}var h,b=[{name:"login",label:this.getPydioRoleMessage("21"),description:o.MessageHash["pydio_role.31"],type:"string",readonly:!0},{name:"profile",label:this.getPydioRoleMessage("22"),description:o.MessageHash["pydio_role.32"],type:"select",choices:"admin|Administrator,standard|Standard,shared|Shared"}].concat(function(e){if(Array.isArray(e))return Ee(e)}(h=a)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(h)||function(e,t){if(e){if("string"==typeof e)return Ee(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ee(e,t):void 0}}(h)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),g=n.getIdmUser().Login===o.user.id;return t().createElement("div",null,t().createElement("h3",{className:"paper-right-title",style:{display:"flex",alignItems:"center",paddingLeft:26,paddingRight:26}},t().createElement("div",{style:{flex:1}},o.MessageHash["pydio_role.24"],t().createElement("div",{className:"section-legend"},o.MessageHash["pydio_role.54"])),t().createElement("div",{style:{lineHeight:"24px"}},t().createElement(l.IconButton,{iconClassName:"mdi mdi-help-circle-outline",tooltip:"Show/hide form legends",tooltipPosition:"bottom-left",onClick:function(){e.setState({showLegends:!s})}}),t().createElement(l.IconMenu,{iconButtonElement:t().createElement(l.IconButton,{primary:!0,tooltip:"Security Actions",tooltipPosition:"bottom-left",iconClassName:"mdi mdi-lock"+(p.indexOf("logout")>-1?"-open":""),iconStyle:{color:p.indexOf("logout")>-1?"#e53935":""}}),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},tooltip:"Actions"},t().createElement(l.MenuItem,{disabled:g,primaryText:this.getPydioRoleMessage("25"),onClick:function(){return e.buttonCallback("update_user_pwd")}}),t().createElement(l.MenuItem,{disabled:g,primaryText:this.getPydioRoleMessage(p.indexOf("logout")>-1?"27":"26"),onClick:function(){return e.buttonCallback("user_set_lock-lock")}}),t().createElement(l.MenuItem,{disabled:g,primaryText:this.getPydioRoleMessage(p.indexOf("pass_change")>-1?"28b":"28"),onClick:function(){return e.buttonCallback("user_set_lock-pass_change")}})))),t().createElement(_e,{parameters:b,onParameterChange:this.onParameterChange.bind(this),values:u,depth:-2,variant:"v2",variantShowLegend:s,binary_context:this.getBinaryContext()}),c)}}])&&Ae(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);function Te(e){return Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Te(e)}function De(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ue(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Te(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Te(o)?o:String(o)),n)}var o}function Le(e,t){return Le=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Le(e,t)}function Be(e){return Be=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Be(e)}Ie.PropTypes={pydio:s().instanceOf(u()).isRequired,pluginsRegistry:s().instanceOf(XMLDocument),user:s().instanceOf(T)};var Fe=u().requireLib("form").FormPanel,qe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Le(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Be(o);if(i){var r=Be(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Te(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={parameters:[]},AdminComponents.PluginsLoader.getInstance(e.pydio).formParameters('//global_param[contains(@scope,"group")]|//param[contains(@scope,"group")]').then((function(e){t.setState({parameters:e})})),t}return r=s,(n=[{key:"getPydioRoleMessage",value:function(e){return this.props.pydio.MessageHash["role_editor."+e]||e}},{key:"onParameterChange",value:function(e,t,r){var n=this.props.group,o=this.state.parameters.filter((function(t){return t.name===e})),i=n.getIdmUser(),a=n.getRole();"displayName"===e||"email"===e||"profile"===e?i.Attributes[e]=t:o.length&&o[0].aclKey&&a.setParameter(o[0].aclKey,t)}},{key:"render",value:function(){var e=this.props,r=e.group,n=(e.pydio,this.state.parameters);if(!n)return t().createElement("div",null,"Loading...");var o={};if(r){var i=r.getIdmUser(),a=r.getRole(),s=i.GroupLabel;i.Attributes&&i.Attributes.displayName&&(s=i.Attributes.displayName),o={groupPath:LangUtils.trimRight(i.GroupPath,"/")+"/"+i.GroupLabel,displayName:s},n.map((function(e){e.aclKey&&a.getParameterValue(e.aclKey)&&(o[e.name]=a.getParameterValue(e.aclKey))}))}var l,c=[{name:"groupPath",label:this.getPydioRoleMessage("34"),type:"string",readonly:!0},{name:"displayName",label:this.getPydioRoleMessage("35"),type:"string"}].concat(function(e){if(Array.isArray(e))return De(e)}(l=n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(l)||function(e,t){if(e){if("string"==typeof e)return De(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?De(e,t):void 0}}(l)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return t().createElement("div",null,t().createElement(Fe,{parameters:c,onParameterChange:this.onParameterChange.bind(this),values:o,variant:"v2",depth:-2}))}}])&&Ue(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);qe.PropTypes={pydio:s().instanceOf(u()).isRequired,pluginsRegistry:s().instanceOf(XMLDocument),group:s().instanceOf(T)};const We=require("pydio/util/xml");var He=r.n(We);function Ve(e){return Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ve(e)}function ze(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ge(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ze(Object(r),!0).forEach((function(t){Ke(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ze(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ke(e,t,r){return(t=Xe(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Je(){return Je=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Je.apply(this,arguments)}function $e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ye(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ye(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Xe(n.key),n)}}function Xe(e){var t=function(e,t){if("object"!==Ve(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Ve(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Ve(t)?t:String(t)}function Ze(e,t){return Ze=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ze(e,t)}function et(e){return et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},et(e)}var tt=u().requireLib("form");const rt=V(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ze(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=et(o);if(i){var r=et(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Ve(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={editMode:!1},t}return r=s,(n=[{key:"onChangeParameter",value:function(e,t){if(e!==t){var r=this.props,n=r.role,o=r.acl,i=o.Action.Name;n.setParameter(i,e,o.WorkspaceID)}}},{key:"deleteParameter",value:function(){var e=this.props,t=e.role,r=e.acl;t.deleteParameter(r)}},{key:"overrideParameter",value:function(){var e=this.props,t=e.role,r=e.acl,n=r.Action.Name,o=$e(n.split(":"),3),i=o[0],a=(o[1],o[2],"");"action"===i&&(a=!1),t.setParameter(n,a,r.WorkspaceID)}},{key:"onInputEditMode",value:function(e){this.setState({editMode:e})}},{key:"toggleEditMode",value:function(){this.refs.formElement&&this.refs.formElement.toggleEditMode()}},{key:"toggleActionStatus",value:function(e,t){var r=this.props,n=r.role,o=r.acl;n.setParameter(o.Action.Name,t,o.WorkspaceID)}},{key:"render",value:function(){var e,r=this.props,n=r.acl,o=r.actions,i=r.parameters,a=r.pydio,s=r.getMessage,c=r.getPydioRoleMessage,u=$e(n.Action.Name.split(":"),3),p=u[0],f=u[1],d=u[2];e="DEFAULT_START_REPOSITORY"===d?n.Action.Value:JSON.parse(n.Action.Value);var y,m,h,b=n.INHERITED,g=d;if("parameter"===p&&i[f]){var v=i[f].filter((function(e){return e.parameter===d}));v.length&&(y=v[0])}else if("action"===p&&o[f]){var O=o[f].filter((function(e){return e.action===d}));O.length&&(y=O[0])}if("parameter"===p){var P={type:"string",label:g,name:d};if(y&&(P=tt.Manager.parameterNodeToHash(y.xmlNode)),"user"===P.scope)return null;g=P.label,m=tt.createFormElement({ref:"formElement",attributes:P,name:d,value:e,onChange:this.onChangeParameter.bind(this),disabled:b,onChangeEditMode:this.onInputEditMode.bind(this),displayContext:"grid"})}else y&&(g=He().XPathGetSingleNodeText(y.xmlNode,"gui/@text")||g,a.MessageHash[g]&&(g=a.MessageHash[g])),m=t().createElement("div",{className:"role-action-toggle"},t().createElement(l.Toggle,{name:this.props.name,onToggle:this.toggleActionStatus.bind(this),toggled:!!e,label:s(e?"2":"3"),labelPosition:"right"}));var w={style:{opacity:.2},hoveredStyle:{opacity:1}};return"parameter"===p?this.state.editMode?h=t().createElement(l.IconButton,Je({iconClassName:"mdi mdi-content-save",tooltip:s("6"),onClick:this.toggleEditMode.bind(this)},w)):(h=t().createElement(l.IconButton,Je({iconClassName:"mdi mdi-close",tooltip:s("4"),onClick:this.deleteParameter.bind(this)},w)),b&&(h=t().createElement(l.IconButton,Je({iconClassName:"mdi mdi-content-copy",tooltip:s("5"),onClick:this.overrideParameter.bind(this)},w)))):h=b?t().createElement("div",{style:{width:48,height:48}}):t().createElement(l.IconButton,Je({iconClassName:"mdi mdi-close",tooltip:s("4"),onClick:this.deleteParameter.bind(this)},w)),t().createElement("tr",{className:(b?"inherited":"")+(this.state.editMode?" edit-mode":""),style:Ge({},this.props.style)},t().createElement("td",{style:{width:"40%",fontWeight:500}},b?"["+c("38")+"]":""," ",g),t().createElement("td",{style:{wordBreak:"break-all"}},m),t().createElement("td",{style:{width:50}},h))}}])&&Qe(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component));function nt(e){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nt(e)}function ot(){return ot=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ot.apply(this,arguments)}function it(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function at(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==nt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===nt(o)?o:String(o)),n)}var o}function st(e,t){return st=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},st(e,t)}function lt(e){return lt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},lt(e)}var ct=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&st(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=lt(o);if(i){var r=lt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===nt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={actions:{},parameters:{},workspaces:{}};var r=new m.WorkspaceServiceApi(PydioApi.getRestClient()),n=new m.RestSearchWorkspaceRequest;return n.Queries=[m.IdmWorkspaceSingleQuery.constructFromObject({scope:"ADMIN"})],r.searchWorkspaces(n).then((function(e){var r=e.Workspaces||[],n={};r.forEach((function(e){n[e.UUID]=e})),t.setState({workspaces:n})})),t}return r=s,(n=[{key:"componentDidMount",value:function(){var e=this;AdminComponents.PluginsLoader.getInstance(this.props.pydio).allPluginsActionsAndParameters().then((function(t){e.setState({actions:t.ACTIONS,parameters:t.PARAMETERS})}))}},{key:"onCreateParameter",value:function(e,t,r,n,o){var i,a=this.props.role,s=t+":"+r+":"+n;if("action"===t)i=!1;else if(o&&o.xmlNode){var l=o.xmlNode;i=l.getAttribute("default")?l.getAttribute("default"):"","boolean"===l.getAttribute("type")?i="true"===i:"integer"===l.getAttribute("type")&&(i=parseInt(i))}a.setParameter(s,i,e)}},{key:"addParameter",value:function(e){var t=this,r=this.props,n=r.pydio,o=r.roleType,i=this.state,a=i.actions,s=i.parameters;n.UI.openComponentInModal("AdminPeople","Editor.Params.ParameterCreate",{pydio:n,actions:a,parameters:s,workspaceScope:e,createParameter:function(r,n,o,i){t.onCreateParameter(e,r,n,o,i)},roleType:o})}},{key:"render",value:function(){var e=this,r=this.props,n=r.role,o=r.pydio;if(!n)return null;var i=this.state.workspaces,a=function(e){return o.MessageHash["pydio_role."+e]||e},s=n.listParametersAndActions(),c={PYDIO_REPO_SCOPE_ALL:{},PYDIO_REPO_SCOPE_SHARED:{}};s.forEach((function(e){c[e.WorkspaceID]||(c[e.WorkspaceID]={});var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return it(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?it(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.Action.Name.split(":"),3),r=(t[0],t[1],t[2]);c[e.WorkspaceID][r]=e}));var u=[t().createElement(l.MenuItem,{primaryText:a("parameters.scope.selector.title"),value:1}),t().createElement(l.MenuItem,{primaryText:a("parameters.scope.all"),onClick:function(){e.addParameter("PYDIO_REPO_SCOPE_ALL")}}),t().createElement(l.MenuItem,{primaryText:a("parameters.scope.shared"),onClick:function(){e.addParameter("PYDIO_REPO_SCOPE_SHARED")}}),t().createElement(l.Divider,null)].concat(Object.keys(i).map((function(r){return t().createElement(l.MenuItem,{primaryText:i[r].Label,onClick:function(){e.addParameter(r)}})})));return t().createElement("div",null,t().createElement("h3",{className:"paper-right-title",style:{display:"flex"}},t().createElement("span",{style:{flex:1,paddingRight:20}},a("46"),t().createElement("div",{className:"section-legend"},a("47"))),t().createElement("div",{style:{width:160}},t().createElement(l.SelectField,{fullWidth:!0,value:1},u))),t().createElement("div",{style:{padding:"0 20px",backgroundColor:"white"}},Object.keys(c).map((function(r){var s,u,p=!1;return s="PYDIO_REPO_SCOPE_ALL"===r?a("parameters.scope.all"):"PYDIO_REPO_SCOPE_SHARED"===r?a("parameters.scope.shared"):i[r]?a("parameters.scope.workspace").replace("%s",i[r].Label):a("parameters.scope.workspace").replace("%s",r),u=Object.keys(c[r]).length?Object.keys(c[r]).map((function(i){var a={backgroundColor:p?"#FAFAFA":"white"};return p=!p,t().createElement(rt,ot({pydio:o,acl:c[r][i],role:n},e.state,{style:a}))})):t().createElement("tr",null,t().createElement("td",{colSpan:3,style:{padding:"14px 0"}},a("parameters.empty"))),t().createElement("table",{style:{width:"100%",marginBottom:20}},t().createElement("tr",{style:{borderBottom:"1px solid #e0e0e0"}},t().createElement("td",{colSpan:2,style:{fontSize:15,paddingTop:10}},s),t().createElement("td",{style:{width:50}},t().createElement(l.IconButton,{iconClassName:"mdi mdi-plus",onClick:function(){e.addParameter(r)},tooltip:a("parameters.custom.add")}))),u)}))))}}])&&at(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);function ut(e){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(e)}function pt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ut(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ut(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===ut(o)?o:String(o)),n)}var o}function ft(e,t){return ft=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ft(e,t)}function dt(e){return dt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},dt(e)}var yt=AdminComponents,mt=yt.PaperEditorLayout,ht=(yt.PaperEditorNavEntry,yt.PaperEditorNavHeader,yt.PluginsLoader),bt=yt.AdminStyles,gt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ft(e,t)}(c,e);var n,o,i,a,s=(i=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=dt(i);if(a){var r=dt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===ut(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),r=s.call(this,e,t),e.node?r.state=r.nodeToState(e.node):e.idmRole&&(r.state={idmRole:e.idmRole,roleType:"role",currentPane:"info"},r.loadRoleData(!0)),ht.getInstance(r.props.pydio).loadPlugins().then((function(e){r.setState({pluginsRegistry:e})})),r}return n=c,o=[{key:"componentWillReceiveProps",value:function(e){var t=this,r=this.props,n=r.node,o=r.idmRole;e.node===n&&e.idmRole===o||(e.node?this.setState(this.nodeToState(e.node)):e.idmRole&&this.setState({idmRole:e.idmRole,roleType:"role",currentPane:"info"},(function(){t.loadRoleData(!0)})))}},{key:"componentDidMount",value:function(){var e=this;this.loadRoleData(!0),this.props.registerCloseCallback&&this.props.registerCloseCallback((function(){if(e.state&&e.state.dirty&&!r.g.confirm(e.getPydioRoleMessage("19")))return!1}))}},{key:"componentWillUnmount",value:function(){this._websocketObserver&&this.props.pydio.stopObserving("websocket_event:idm",this._websocketObserver)}},{key:"nodeToState",value:function(e){var t,r=this,n=this.props.pydio,o="group"===e.getAjxpMime()?"group":"user",i=e.getMetadata().get("IdmUser");return(t=new T(i)).observe("update",(function(){r.forceUpdate()})),t.load(),this._websocketObserver&&n.stopObserving("websocket_event:idm",this._websocketObserver),this._websocketObserver=function(e){if(e.User&&"UPDATE"===e.Type&&e.User.Uuid===i.Uuid){if(e.Attributes&&e.Attributes.ctx_username===n.user.id)return void console.log("ignore change coming from same user");var t=r.state.observableUser;if(t.isDirty()&&!confirm("User was modified externally, you should revert your changes (click OK to reload)"))return void t.save();var o=new T(e.User);o.observe("update",(function(){r.forceUpdate()})),o.load(),r.setState({observableUser:o})}},n.observe("websocket_event:idm",this._websocketObserver),{observableUser:t,roleLabel:de().getBasename(e.getPath()),roleType:o,dirty:!1,currentPane:"info",localModalContent:{}}}},{key:"loadRoleData",value:function(e){var t=this;e&&this.setState({loadingMessage:this.getMessage("loading","ajxp_admin")});var r=this.state.idmRole,n=new C(r);n.load().then((function(){t.setState({loadingMessage:null,observableRole:n}),n.observe("update",(function(){t.forceUpdate()}))}))}},{key:"getChildContext",value:function(){var e=this.context.pydio.MessageHash;return{messages:e,getMessage:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pydio_role";return e[r+(r?".":"")+t]||t},getPydioRoleMessage:function(t){return e["role_editor."+t]||t},getRootMessage:function(t){return e[t]||t}}}},{key:"getMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pydio_role";return this.getChildContext().getMessage(e,t)}},{key:"getPydioRoleMessage",value:function(e){return this.getChildContext().getMessage(e,"role_editor")}},{key:"getRootMessage",value:function(e){return this.getChildContext().getMessage(e,"")}},{key:"setSelectedPane",value:function(e){this.setState({currentPane:e})}},{key:"showModal",value:function(e){this.setState({modal:e})}},{key:"hideModal",value:function(){this.setState({modal:null})}},{key:"logAction",value:function(e){this.setState({snackbar:e,snackOpen:!0})}},{key:"hideSnackBar",value:function(){this.setState({snackOpen:!1})}},{key:"render",value:function(){var e,r=this,n=this.props,o=n.advancedAcl,i=n.pydio,a=n.muiTheme,s=this.state,c=s.observableRole,u=s.observableUser,p=s.pluginsRegistry,f=s.currentPane,d=s.modal,y="",m="",h=this.getMessage("24"),b=!1;if("user"===this.state.roleType){var g=u.getIdmUser();y=g.Attributes&&g.Attributes.displayName?g.Attributes.displayName:g.Login,b="admin"===g.Attributes.profile,e=t().createElement(Ie,{user:u,pydio:i,pluginsRegistry:p})}else"group"===this.state.roleType?(m=this.getMessage("26"),h=this.getMessage("27"),y=u.getIdmUser().GroupLabel,u.getIdmUser().Attributes&&u.getIdmUser().Attributes.displayName&&(y=u.getIdmUser().Attributes.displayName),e=t().createElement(qe,{group:u,pydio:i,pluginsRegistry:p})):"role"===this.state.roleType&&(y=c?c.getIdmRole().Label:"...",m=this.getMessage("28"),h=this.getMessage("29"),b=!0,e=t().createElement(Pe,{role:c,pydio:i,pluginsRegistry:p}));var v=!0,O=function(){},P=function(){};u?(v=!u.isDirty(),O=function(){u.save().then(r.props.afterSave)},P=function(){u.revert()}):c&&(v=!c.isDirty(),O=function(){c.save(r.props.afterSave)},P=function(){c.revert()});var w=[mt.actionButton(this.getMessage("plugins.6","ajxp_admin"),"mdi mdi-undo",P,v),mt.actionButton(this.getRootMessage("53"),"mdi mdi-content-save",O,v)],S=[{value:"info",label:h},{value:"workspaces",label:this.getMessage("35")},{value:"pages",label:this.getMessage("36")},{value:"params",label:this.getMessage("38")}],E=[],j=function(e){return f===e?"layout-fill":""},R=function(e){return f===e?{overflow:"auto"}:{height:0,overflow:"hidden"}};E.push(t().createElement("div",{key:"info",className:"avatar-provider "+j("info"),style:R("info")},m&&!this.state.loadingMessage?t().createElement("h3",{className:"paper-right-title"},m):null,e)),"workspaces"===f?E.push(t().createElement("div",{key:"workspaces",className:j("workspaces"),style:R("workspaces")},t().createElement("h3",{className:"paper-right-title"},this.getRootMessage("250"),t().createElement("div",{className:"section-legend"},this.getMessage("43")),t().createElement("div",{className:"read-write-header"},t().createElement("span",{className:"header-read"},this.getMessage("react.5a","ajxp_admin")),t().createElement("span",{className:"header-write"},this.getMessage("react.5b","ajxp_admin")),t().createElement("span",{className:"header-deny"},this.getMessage("react.5","ajxp_admin"))),t().createElement("br",null)),t().createElement(ae,{key:"workspaces-list",role:u?u.getRole():c,roleType:this.state.roleType,advancedAcl:o,showModal:this.showModal.bind(this),hideModal:this.hideModal.bind(this)}))):"pages"===f?E.push(t().createElement("div",{key:"pages",className:j("pages"),style:R("pages")},t().createElement("h3",{className:"paper-right-title"},this.getMessage("44"),t().createElement("div",{className:"section-legend"},this.getMessage("45")),t().createElement("div",{className:"read-write-header"},t().createElement("span",{className:"header-read"},this.getMessage("react.5a","ajxp_admin")),t().createElement("span",{className:"header-write"},this.getMessage("react.5b","ajxp_admin")),t().createElement("span",{className:"header-deny"},this.getMessage("react.5","ajxp_admin"))),t().createElement("br",null)),t().createElement(pe,{key:"pages-list",role:u?u.getRole():c,roleType:this.state.roleType,advancedAcl:o,showModal:this.showModal.bind(this),hideModal:this.hideModal.bind(this),showSettings:b,pydio:i}))):"params"===f&&E.push(t().createElement("div",{key:"params",className:j("params"),style:R("params")},t().createElement(ct,{pydio:i,role:u?u.getRole():c,roleType:this.state.roleType})));var k=null;return this.state.loadingMessage&&(k=t().createElement("div",{className:"loader-container layout-fill vertical-layout"},t().createElement("div",{className:"loader-message",style:{margin:"auto",color:"rgba(0,0,0,0.33)",fontWeight:"500",fontSize:16}},this.state.loadingMessage))),t().createElement(mt,{title:y,titleLeftIcon:"mdi mdi-account",titleActionBar:w,closeAction:function(){r.props.onRequestTabClose()},contentFill:!0,leftNavItems:S,leftNavSelected:f,leftNavChange:function(e){r.setSelectedPane(e)},className:"edit-object-"+this.state.roleType},t().createElement(l.Snackbar,{message:this.state.snackbar||"",open:this.state.snackOpen,autoHideDuration:4e3,ref:"snack",action:"Dismiss",onRequestClose:this.hideSnackBar.bind(this)}),d,k,E,bt(a.palette).formSimpleCss())}}],o&&pt(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),c}(t().Component);gt.contextTypes={pydio:s().instanceOf(u())},gt.childContextTypes={messages:s().object,getMessage:s().func,getPydioRoleMessage:s().func,getRootMessage:s().func},gt.propTypes={node:s().instanceOf(AjxpNode),closeEditor:s().func,registerCloseCallback:s().func},gt=(0,ye.muiThemeable)()(gt);const vt=require("pydio/model/data-model");var Ot=r.n(vt);const Pt=require("lodash.debounce");var wt=r.n(Pt);const St=require("pydio/model/node");var Et=r.n(St);function jt(e){return jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jt(e)}function Rt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function kt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Rt(Object(r),!0).forEach((function(t){Ct(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ct(e,t,r){return(t=xt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function At(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,xt(n.key),n)}}function xt(e){var t=function(e,t){if("object"!==jt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==jt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===jt(t)?t:String(t)}function Mt(e,t){return Mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Mt(e,t)}function Nt(e){return Nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Nt(e)}var _t=u().requireLib("hoc").ModernTextField,It=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Mt(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Nt(o);if(i){var r=Nt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===jt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t=a.call(this,e);var r=new(Ot());return r.setRootNode(new(Et())),t.state={dataModel:r,displayResult:e.displayResultsState,crtValue:""},t.searchDebounced=wt()(t.triggerSearch,350),t}return r=s,(n=[{key:"displayResultsState",value:function(){this.setState({displayResult:!0})}},{key:"hideResultsState",value:function(){this.setState({displayResult:!1}),this.props.hideResults()}},{key:"triggerSearch",value:function(){var e=this,t=this.state.crtValue;if(t){var r=this.state.dataModel,n=this.props.limit||100;r.getRootNode().setChildren([]);var o=y().getRestClient().getIdmApi().listGroups("/",t,!0,0,n),i=y().getRestClient().getIdmApi().listUsers("/",t,!0,0,n);Promise.all([o,i]).then((function(n){var o=n[0],i=n[1];o.Groups.map((function(e){var t=e.Attributes&&e.Attributes.displayName?e.Attributes.displayName:e.GroupLabel,n=new(Et())("/idm/users"+U().trimRight(e.GroupPath,"/")+"/"+e.GroupLabel,!1,t);n.getMetadata().set("IdmUser",e),n.getMetadata().set("ajxp_mime","group"),r.getRootNode().addChild(n)})),i.Users.map((function(e){var t=e.Attributes&&e.Attributes.displayName?e.Attributes.displayName:e.Login,n=new(Et())("/idm/users"+e.Login,!0,t);n.getMetadata().set("IdmUser",e),n.getMetadata().set("ajxp_mime","user_editable"),r.getRootNode().addChild(n)})),r.getRootNode().setLoaded(!0),e.displayResultsState(),e.props.displayResults(t,r)}))}else{this.hideResultsState();try{this.refs.query.refs.input.blur()}catch(e){}}}},{key:"keyDown",value:function(e){"Enter"===e.key?(e.preventDefault(),this.triggerSearch()):this.searchDebounced()}},{key:"render",value:function(){var e=this,r=this.state.crtValue;return t().createElement("div",{className:this.props.className?this.props.className:"",style:kt({display:"flex",alignItems:"center"},this.props.style)},t().createElement("div",{style:{flex:1}}),t().createElement("div",{style:{maxWidth:190}},t().createElement("form",{autoComplete:"off"},t().createElement(_t,{ref:"query",onKeyDown:this.keyDown.bind(this),hintText:this.props.textLabel,fullWidth:!0,value:r,onChange:function(t,r){e.setState({crtValue:r})}}))))}}])&&At(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);function Tt(e){return Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tt(e)}function Dt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Tt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Tt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Tt(o)?o:String(o)),n)}var o}It.PropTypes={textLabel:s().string,displayResults:s().func,hideResults:s().func,displayResultsState:s().bool,limit:s().number,style:s().object};var Ut=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"deleteAction",value:function(e,t){var r,n,o=(r=t&&t.length?t[0]:pydio.getUserSelection()).getUniqueNode();switch(o.getMetadata().get("ajxp_mime")){case"user_editable":n="settings.34";break;case"group":n="settings.126"}var i=function(){};if(o.getParent()){var a=o.getParent();i=function(){a.reload(null,!0)}}pydio.UI.openConfirmDialog({message:MessageHash[n],validCallback:function(){var e=r.getSelectedNodes();!function t(){if(e.length){var r=e.shift();y().getRestClient().getIdmApi().deleteIdmUser(r.getMetadata().get("IdmUser")).then((function(){i(),t()})).catch((function(e){u().getInstance().UI.displayMessage("ERROR",e.message),t()}))}}()}})}},{key:"applyDND",value:function(e,t){t.getStep()===PydioComponents.DNDActionParameter.STEP_CAN_DROP?AdminComponents.DNDActionsManager.canDropNodeOnNode(t.getSource(),t.getTarget()):t.getStep()===PydioComponents.DNDActionParameter.STEP_END_DRAG&&AdminComponents.DNDActionsManager.dropNodeOnNode(t.getSource(),t.getTarget())}},{key:"bulkMoveAction",value:function(e,t){var r=u().getInstance(),n=t[0].getSelectedNodes();r.UI.openComponentInModal("AdminPeople","TreeGroupsDialog",{pydio:r,dataModel:r.getContextHolder(),submitValue:function(e,t){!function e(){if(n.length){var r=n.shift();AdminComponents.DNDActionsManager.dropNodeOnNode(r,t),e()}}()}})}}],null&&Dt(t.prototype,null),r&&Dt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();const Lt=require("pydio/util/func");var Bt=r.n(Lt);const Ft=require("pydio/http/resources-manager");var qt=r.n(Ft);function Wt(e){return Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wt(e)}function Ht(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;if(!e)return Promise.resolve(t);var r=e.split("."),n=r.shift(),o=r.join(".");return qt().loadClass(n).then((function(r){var i=Bt().getFunctionByName(o,r);if(!i){if("object"===Wt(r)&&r[n]){var a=Bt().getFunctionByName(o,r[n]);if(a)return a}if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw new Error("cannot find editor component")}return i})).catch((function(r){if(t)return console.error("Cannot find editor component, using default instead",e,t),t;throw r}))}function Vt(e){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vt(e)}function zt(){return zt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},zt.apply(this,arguments)}function Gt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Kt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Gt(Object(r),!0).forEach((function(t){Jt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Jt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Vt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Vt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Vt(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var $t=u().requireLib("boot").JobsStore,Yt=i()({displayName:"Dashboard",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:s().instanceOf(Ot()).isRequired,rootNode:s().instanceOf(Et()).isRequired,currentNode:s().instanceOf(Et()).isRequired,accessByName:s().func.isRequired,openEditor:s().func.isRequired},getInitialState:function(){var e=this.props;return{searchResultData:!1,currentNode:e.currentNode,dataModel:e.dataModel,showAnon:!1}},componentDidMount:function(){var e=this,t=$t.getInstance();this._jStoreObserver=function(r){r&&0===r.indexOf("delete-group-")&&t.getJobs().then((function(t){try{"Finished"===t.get(r).Tasks[0].Status&&e.reloadList()}catch(e){}}))},t.observe("tasks_updated",this._jStoreObserver)},componentWillUnmounnt:function(){$t.getInstance().stopObserving("tasks_updated",this._jStoreObserver)},componentWillReceiveProps:function(e){!this.state.searchResultData&&e.currentNode&&0===e.currentNode.getPath().indexOf("/idm/users")&&this.setState({currentNode:e.currentNode,dataModel:e.dataModel})},reloadList:function(){this.refs.mainlist&&this.refs.mainlist.reload()},renderListUserAvatar:function(e){var r=e.getMetadata().get("IdmUser"),n=this.props.pydio;if(r.Attributes&&r.Attributes.avatar){var o=n.Parameters.get("ENDPOINT_REST_API")+"/frontend/binaries/USER/"+r.Login+"?"+r.Attributes.avatar+"&dim=33";return t().createElement("div",{style:{width:33,height:33,backgroundImage:"url("+o+")",backgroundSize:"cover",borderRadius:"50%",backgroundPosition:"center",margin:16}})}var i=e.isLeaf()?"mdi mdi-account":"mdi mdi-folder";return t().createElement(l.FontIcon,{className:i,style:{backgroundColor:"#9e9e9e",color:"white",borderRadius:"50%",margin:16,width:33,height:33,fontSize:18,padding:6,textAlign:"center"}})},renderListEntryFirstLine:function(e){var r=e.getMetadata().get("IdmUser"),n=r.Attributes?r.Attributes.profile:"",o=[],i={display:"inline-block",marginLeft:5,fontSize:14};return"shared"===n?o.push(t().createElement("span",{className:"mdi mdi-share-variant",style:Kt(Kt({},i),{},{color:"#009688"}),title:this.context.getMessage("user.13")})):"admin"===n&&o.push(t().createElement("span",{className:"mdi mdi-security",style:Kt(Kt({},i),{},{color:"#03a9f4"})})),r.Attributes&&r.Attributes.locks&&r.Attributes.locks.indexOf("logout")>-1&&o.push(t().createElement("span",{className:"mdi mdi-lock",style:Kt(Kt({},i),{},{color:"#E53934"})})),t().createElement("span",null,e.getLabel()," ",o)},renderListEntrySecondLine:function(e){var t=e.getMetadata().get("IdmUser");if(e.isLeaf()){if("/idm/users"===e.getPath())return this.context.getMessage("user.8");var r=[];r.push(t.Login);var n=t.Attributes||{};n.profile&&r.push("Profile "+n.profile),n.last_connection_readable&&r.push(this.context.getMessage("user.9")+" "+n.last_connection_readable);var o=t.Roles;return o&&o.length&&r.push(this.context.getMessage("user.11").replace("%i",o.length)),r.join(" - ")}return this.context.getMessage("user.12")+": "+e.getPath().replace("/idm/users","")},renderListEntrySelector:function(e){return"/idm/users"!==e.getPath()&&e.isLeaf()},displaySearchResults:function(e,t){this.setState({searchResultTerm:e,searchResultData:{term:e,toggleState:this.hideSearchResults},currentNode:t.getContextNode(),dataModel:t})},hideSearchResults:function(){this.setState({searchResultData:!1,currentNode:this.props.currentNode,dataModel:this.props.dataModel})},createUserAction:function(){pydio.UI.openComponentInModal("AdminPeople","Forms.CreateUserForm",{dataModel:this.props.dataModel,openRoleEditor:this.openRoleEditor.bind(this)})},createGroupAction:function(){pydio.UI.openComponentInModal("AdminPeople","Forms.CreateRoleOrGroupForm",{type:"group",openRoleEditor:this.openRoleEditor.bind(this)})},openUsersImporter:function(){pydio.UI.openComponentInModal("EnterprisePeople","UsersImportDialog",{dataModel:this.props.dataModel})},openRoleEditor:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"activity",n=this.props,o=n.pydio,i=n.rolesEditorClass,a=n.rolesEditorProps;if(this.refs.editor&&this.refs.editor.isDirty()&&!window.confirm(o.MessageHash["role_editor.19"]))return!1;var s=Kt({ref:"editor",node:e,pydio:o,initialEditSection:r,onRequestTabClose:this.closeRoleEditor,afterSave:function(){t.reloadList()}},a);Ht(i,gt).then((function(e){t.props.openRightPane({COMPONENT:e,PROPS:s})})).catch((function(e){console.log(e)}))},closeRoleEditor:function(){if(this.refs.editor&&this.refs.editor.isDirty()&&!window.confirm(this.props.pydio.MessageHash["role_editor.19"]))return!1;this.props.closeRightPane()},deleteAction:function(e){var t=new(Ot());t.setSelectedNodes([e]),Ut.deleteAction(null,[t])},renderNodeActions:function(e){var r=this,n=e.getAjxpMime();if(e.getMetadata().has("IdmUser")&&!e.getMetadata().get("IdmUser").PoliciesContextEditable)return t().createElement("div",null);var o={color:"rgba(0,0,0,0.3)",fontSize:20},i=[];return"user_editable"===n||"group"===n?(i.push(t().createElement(l.IconButton,{key:"edit",iconClassName:"mdi mdi-pencil",onClick:function(t){t.stopPropagation(),r.openRoleEditor(e)},iconStyle:o})),i.push(t().createElement(l.IconButton,{key:"delete",iconClassName:"mdi mdi-delete",onClick:function(t){t.stopPropagation(),r.deleteAction(e)},iconStyle:o}))):"user"===n&&(i.push(t().createElement(l.IconButton,{key:"edit",iconClassName:"mdi mdi-pencil",onClick:function(t){t.stopPropagation(),r.openRoleEditor(e)},iconStyle:o})),i.push(t().createElement(l.IconButton,{key:"delete",iconClassName:"mdi mdi-delete",disabled:!0,iconStyle:{color:"rgba(0,0,0,0.15)",fontSize:20},onClick:function(e){e.stopPropagation()}}))),t().createElement("div",null,i)},filterNodes:function(e){if(!e.getMetadata().has("IdmUser"))return!0;var t=this.state,r=t.showAnon;return!(!t.displaySearchResult&&!r)||"anon"!==(e.getMetadata().get("IdmUser").Attributes||{}).profile},applyFilter:function(e){var t=this;if("toggle-anon"!==e){var r=this.props.currentNode;r.getMetadata().set("userProfileFilter",e),r.getMetadata().delete("paginationData"),this.setState({currentNode:r},(function(){t.reloadList()}))}else this.setState({showAnon:!this.state.showAnon})},render:function(){var e=this,r=this.props,n=r.accessByName,o=r.muiTheme,i=r.rootNode,a=r.pydio,s=AdminComponents.AdminStyles(o.palette),c=this.state,u=c.searchResultData,p=c.currentNode,f=c.dataModel,d=c.showAnon,y=t().createElement(It,{displayResults:this.displaySearchResults,displayResultsState:u,hideResults:this.hideSearchResults,limit:50,textLabel:this.context.getMessage("user.7"),className:"media-small-hide"}),m=[],h=function(){return[]},b=null,g=[];n("Create")&&(h=this.renderNodeActions.bind(this),g=[a.Controller.getActionByName("move"),a.Controller.getActionByName("delete")],b=this.openRoleEditor.bind(this),m=[t().createElement(l.FlatButton,zt({primary:!0,label:this.context.getMessage("user.1"),onClick:this.createUserAction},s.props.header.flatButton)),t().createElement(l.FlatButton,zt({primary:!0,label:this.context.getMessage("user.2"),onClick:this.createGroupAction},s.props.header.flatButton))]);var v="";p.getMetadata().has("userProfileFilter")&&(v=p.getMetadata().get("userProfileFilter"));var O=""===v?"rgba(0,0,0,0.4)":o.palette.accent1Color,P=t().createElement(l.IconMenu,{iconButtonElement:t().createElement(l.IconButton,{style:{marginRight:-16,marginLeft:8},iconStyle:{color:O},iconClassName:"mdi mdi-filter-variant",tooltip:this.context.getMessage("user.filter.tooltip"),tooltipPosition:"bottom-left"}),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},value:v,onChange:function(t,r){e.applyFilter(r)},desktop:!0},t().createElement(l.MenuItem,{value:"",primaryText:this.context.getMessage("user.filter.all")}),t().createElement(l.MenuItem,{value:"!shared",primaryText:this.context.getMessage("user.filter.internal")}),t().createElement(l.MenuItem,{value:"shared",primaryText:this.context.getMessage("user.filter.shared")}),t().createElement(l.MenuItem,{value:"admin",primaryText:this.context.getMessage("user.filter.admins")}),t().createElement(l.Divider,null),t().createElement(l.MenuItem,{value:"toggle-anon",primaryText:this.context.getMessage("user.filter.anon"),secondaryText:d?t().createElement(l.FontIcon,{className:"mdi mdi-check"}):null})),w=AdminComponents.AdminStyles().body,S=w.block.props,E=w.block.container,j=Kt(Kt({height:48,lineHeight:"48px",fontSize:12,fontWeight:500},w.block.header),{},{borderBottom:"1px solid "+w.tableMaster.row.borderBottomColor,padding:"0 20px"}),R={width:226,borderRight:"1px solid"+w.tableMaster.row.borderBottomColor,overflowY:"auto",flex:"none"};return!1!==u&&(R=Kt(Kt({},R),{},{opacity:.6})),t().createElement("div",{className:"main-layout-nav-to-stack vertical-layout people-dashboard"},t().createElement(AdminComponents.Header,{title:this.context.getMessage("2","settings"),icon:"mdi mdi-account-multiple",actions:m,centerContent:y}),t().createElement(l.Paper,zt({},S,{style:E,className:"horizontal-layout layout-fill"}),t().createElement("div",{className:"hide-on-vertical-layout vertical-layout tab-vertical-layout",style:R},t().createElement("div",{style:{flex:1}},t().createElement("div",{style:j},this.context.getMessage("user.3")),t().createElement(PydioComponents.DNDTreeView,{showRoot:!0,rootLabel:this.context.getMessage("user.5"),node:i,dataModel:this.props.dataModel,className:"users-groups-tree",paddingOffset:10,noPaginator:!0}))),t().createElement("div",{zDepth:0,className:"layout-fill vertical-layout people-list"},t().createElement(PydioComponents.SimpleList,{ref:"mainlist",pydio:a,node:p,dataModel:f,clearSelectionOnReload:!1,openEditor:b,entryRenderIcon:this.renderListUserAvatar.bind(this),entryRenderFirstLine:this.renderListEntryFirstLine.bind(this),entryRenderSecondLine:this.renderListEntrySecondLine.bind(this),entryEnableSelector:this.renderListEntrySelector.bind(this),entryRenderActions:h,searchResultData:u,elementHeight:PydioComponents.SimpleList.HEIGHT_TWO_LINES,hideToolbar:!1,toolbarStyle:{backgroundColor:w.block.header.backgroundColor,height:48,borderBottom:j.borderBottom},multipleActions:g,additionalActions:P,filterNodes:this.filterNodes.bind(this)}))))}});function Qt(e){return Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qt(e)}function Xt(){return Xt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Xt.apply(this,arguments)}function Zt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function er(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Zt(Object(r),!0).forEach((function(t){tr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function tr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Qt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Qt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Qt(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Yt=(0,ye.muiThemeable)()(Yt);var rr=r(173).muiThemeable,nr=u().requireLib("components").MaterialTable,or=u().requireLib("hoc").ModernTextField,ir=i()({displayName:"RolesDashboard",mixins:[AdminComponents.MessagesConsumerMixin],getInitialState:function(){return{roles:[],loading:!1,showTechnical:!1}},load:function(){var e=this,t=this.state.showTechnical;this.setState({loading:!0}),u().startLoading(),y().getRestClient().getIdmApi().listRoles(t,0,-1).then((function(t){u().endLoading(),e.setState({roles:t,loading:!1})})).catch((function(t){u().endLoading(),e.setState({loading:!1})}))},componentDidMount:function(){this.load()},openTableRows:function(e){e.length&&e[0].role.PoliciesContextEditable&&this.openRoleEditor(e[0].role)},openRoleEditor:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"activity",n=this.props,o=n.pydio,i=n.rolesEditorClass,a=n.rolesEditorProps;return!(this.refs.editor&&this.refs.editor.isDirty()&&!window.confirm(o.MessageHash["role_editor.19"])||(Ht(i,gt).then((function(n){t.props.openRightPane({COMPONENT:n,PROPS:er({ref:"editor",idmRole:e,pydio:o,initialEditSection:r,onRequestTabClose:t.closeRoleEditor},a)})})).catch((function(e){console.log(e)})),0))},closeRoleEditor:function(){return!(this.refs.editor&&this.refs.editor.isDirty()&&!window.confirm(this.props.pydio.MessageHash["role_editor.19"])||(this.props.closeRightPane(),0))},deleteAction:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=this.props.pydio;n.UI.openConfirmDialog({message:n.MessageHash["settings.126"],destructive:[r||e],validCallback:function(){y().getRestClient().getIdmApi().deleteRole(e).then((function(){t.load()}))}})},createRoleAction:function(){var e=this;pydio.UI.openComponentInModal("AdminPeople","Forms.CreateRoleOrGroupForm",{type:"role",roleNode:this.state.currentNode,openRoleEditor:this.openRoleEditor.bind(this),roles:this.state.roles,reload:function(){e.load()}})},computeTableData:function(e){var t=this.state.roles,r=[];return t.map((function(t){var n=t.Label;e&&-1===n.toLowerCase().indexOf(e.toLowerCase())||r.push({role:t,roleId:t.Uuid,roleLabel:n,isDefault:t.AutoApplies.join(", ")||"-",lastUpdated:t.LastUpdated})})),r},render:function(){var e=this,r=this.props,n=r.muiTheme,o=r.accessByName,i=AdminComponents.AdminStyles(n.palette),a=this.state,s=a.searchRoleString,c=a.showTechnical,u=o("Create"),p=null,f=[];u&&(f.push(t().createElement(l.FlatButton,Xt({},i.props.header.flatButton,{primary:!0,label:this.context.getMessage("user.6"),onClick:this.createRoleAction.bind(this)}))),p=this.openTableRows.bind(this)),f.push(t().createElement(l.IconMenu,{iconButtonElement:t().createElement(l.IconButton,Xt({iconClassName:"mdi mdi-filter-variant"},i.props.header.iconButton)),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},onChange:function(){e.setState({showTechnical:!c},(function(){e.load()}))}},t().createElement(l.MenuItem,{primaryText:this.context.getMessage("dashboard.technical.show","role_editor"),value:"show",rightIcon:c?t().createElement(l.FontIcon,{className:"mdi mdi-check"}):null}),t().createElement(l.MenuItem,{primaryText:this.context.getMessage("dashboard.technical.hide","role_editor"),value:"hide",rightIcon:c?null:t().createElement(l.FontIcon,{className:"mdi mdi-check"})})));var d=t().createElement("div",{style:{display:"flex"}},t().createElement("div",{style:{flex:1}}),t().createElement("div",{style:{width:190}},t().createElement(or,{fullWidth:!0,hintText:this.context.getMessage("47","role_editor")+"...",value:s||"",onChange:function(t,r){return e.setState({searchRoleString:r})}}))),y=[{name:"roleLabel",label:this.context.getMessage("32","role_editor"),style:{width:"35%",fontSize:15},headerStyle:{width:"35%"},sorter:{type:"string",default:!0}},{name:"lastUpdated",useMoment:!0,label:this.context.getMessage("last_update","role_editor"),hideSmall:!0,sorter:{type:"number"}},{name:"isDefault",label:this.context.getMessage("114","settings"),style:{width:"20%"},headerStyle:{width:"20%"},hideSmall:!0,sorter:{type:"string"}}],m=[];u&&(m.push({iconClassName:"mdi mdi-pencil",tooltip:"Edit",onClick:function(t){e.openRoleEditor(t.role)},disable:function(e){return!e.role.PoliciesContextEditable}}),m.push({iconClassName:"mdi mdi-delete",tooltip:"Delete",onClick:function(t){e.deleteAction(t.role.Uuid,t.role.Label)},disable:function(e){return!e.role.PoliciesContextEditable}}));var h=this.computeTableData(s),b=AdminComponents.AdminStyles().body,g=b.tableMaster,v=b.block.props,O=b.block.container;return t().createElement("div",{className:"main-layout-nav-to-stack vertical-layout"},t().createElement(AdminComponents.Header,{title:this.context.getMessage("69","settings"),icon:"mdi mdi-account-multiple",actions:f,centerContent:d,reloadAction:function(){e.load()},loading:this.state.loading}),t().createElement("div",{className:"layout-fill"},t().createElement(AdminComponents.SubHeader,{legend:this.context.getMessage("dashboard.description","role_editor")}),t().createElement(l.Paper,Xt({},v,{style:O}),t().createElement(nr,{data:h,columns:y,actions:m,onSelectRows:p,deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:g,paginate:[10,25,50,100],storageKey:"console.roles.list"}))))}});function ar(e){return ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ar(e)}function sr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ar(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ar(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===ar(o)?o:String(o)),n)}var o}function lr(e,t){return lr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},lr(e,t)}function cr(e){return cr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},cr(e)}ir=rr()(ir);var ur=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lr(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=cr(o);if(i){var r=cr(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===ar(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return r=s,(n=[{key:"componentDidMount",value:function(){this.props.create&&this.openEditor()}},{key:"openEditor",value:function(){var e=this,t=this.props,r=t.pydio,n=t.policy,o=t.rule,i=t.openRightPane,a=t.rulesEditorClass;return!(this.refs.editor&&this.refs.editor.isDirty()&&!window.confirm(r.MessageHash["role_editor.19"])||!a||(Ht(a,null).then((function(t){i({COMPONENT:t,PROPS:{ref:"editor",policy:n,rule:o,pydio:r,saveRule:e.props.onRuleChange,create:e.props.create,onRequestTabClose:e.closeEditor.bind(e)}})})).catch((function(e){console.error(e)})),0))}},{key:"closeEditor",value:function(e){var t=this.props,r=t.pydio,n=t.closeRightPane;if(e&&e.isDirty()){if(e.isCreate())return this.props.onRemoveRule(this.props.rule,!0),n(),!0;if(!window.confirm(r.MessageHash["role_editor.19"]))return!1}return n(),!0}},{key:"removeRule",value:function(){var e=this.props,t=e.pydio,r=e.onRemoveRule,n=e.rule;t.UI.openConfirmDialog({message:t.MessageHash["ajxp_admin.policies.rule.delete.confirm"],destructive:[n.description],validCallback:function(){r(n)}})}},{key:"render",value:function(){var e=this.props,r=e.rule,n=e.readonly,o=e.isLast,i="allow"===r.effect?"#33691e":"#d32f2f",a=[];return n||(a=[t().createElement("span",{className:"mdi mdi-pencil",style:{fontSize:16,color:"rgba(0,0,0,.33)",cursor:"pointer",marginLeft:12},onClick:this.openEditor.bind(this)}),t().createElement("span",{className:"mdi mdi-delete",style:{fontSize:16,color:"rgba(0,0,0,.33)",cursor:"pointer",marginLeft:12},onClick:this.removeRule.bind(this)})]),r.description,t().createElement("div",{style:{display:"flex",padding:"6px 0 5px",borderBottom:o?null:"1px solid white"}},t().createElement(l.FontIcon,{className:"mdi mdi-traffic-light",color:i,style:{fontSize:16,marginRight:10}}),t().createElement("div",{style:{flex:1}},r.description,a))}}])&&sr(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);function pr(e){return pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pr(e)}function fr(){return fr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fr.apply(this,arguments)}function dr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function yr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?dr(Object(r),!0).forEach((function(t){mr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function mr(e,t,r){return(t=br(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,br(n.key),n)}}function br(e){var t=function(e,t){if("object"!==pr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==pr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===pr(t)?t:String(t)}function gr(e,t){return gr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},gr(e,t)}function vr(e){return vr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},vr(e)}var Or=u().requireLib("hoc").ModernTextField,Pr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&gr(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=vr(o);if(i){var r=vr(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===pr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={policy:e.policy},t}return r=s,n=[{key:"componentWillReceiveProps",value:function(e){this.setState({policy:e.policy})}},{key:"componentDidMount",value:function(){this.props.newPolicyWithRule&&this.onAddRule(null,this.props.newPolicyWithRule)}},{key:"onNameChange",value:function(e){var t=yr({},this.state.policy);t.Name=e,this.props.savePolicy(t)}},{key:"onDescriptionChange",value:function(e){var t=yr({},this.state.policy);t.Description=e,this.props.savePolicy(t)}},{key:"saveLabels",value:function(){var e=this.state,t=e.pName,r=e.pDesc,n=e.policy;t&&(n.Name=t),r&&(n.Description=r),this.setState({pName:null,pDesc:null}),this.props.savePolicy(n)}},{key:"onRuleChange",value:function(e){var t=yr({},this.state.policy);t.Policies?(t.Policies=t.Policies.filter((function(t){return t.id!==e.id})),t.Policies.push(e)):t.Policies=[e],this.props.savePolicy(t)}},{key:"onRemoveRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=yr({},this.state.policy);r.Policies=r.Policies.filter((function(t){return t.id!==e.id})),this.props.savePolicy(r,t)}},{key:"onAddRule",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=yr({},this.state.policy);n.Policies||(n.Policies=[]);var o=P(),i=[],a=[];"acl"===n.ResourceGroup?(i=["policy:"+n.Uuid],a=["acl"]):"oidc"===n.ResourceGroup&&(a=["oidc"]),n.Policies.push({id:o,description:r,actions:[],subjects:i,resources:a,effect:"deny"}),this.setState({policy:n,openRule:o},(function(){t.setState({openRule:null})}))}},{key:"render",value:function(){var e,r=this,n=this.props,o=n.readonly,i=n.pydio,a=this.state,s=a.policy,c=a.openRule,u=function(e){return i.MessageHash["ajxp_admin.policies."+e]||e},p=s.Policies.map((function(e,n){return t().createElement(ur,fr({},r.props,{key:e.description,rule:e,isLast:n===s.Policies.length-1,create:c===e.id,onRuleChange:r.onRuleChange.bind(r),onRemoveRule:r.onRemoveRule.bind(r)}))})),f={iconStyle:{fontSize:18,color:"rgba(0,0,0,.33)"},style:{padding:8,width:36,height:36},tooltipPosition:"top-right"},d=t().createElement("div",{style:{display:"flex",alignItems:"center"}},t().createElement("div",{style:{fontSize:14,fontWeight:500}},"Rules"),!o&&t().createElement(l.IconButton,fr({iconClassName:"mdi mdi-plus",tooltip:u("rule.create"),onClick:this.onAddRule.bind(this)},f,{tooltipPosition:"bottom-right"})));if(!o){var y=this.state,m=y.showLabels,h=y.pName,b=y.pDesc,g=h&&h!==s.Name||b&&b!==s.Description;e=t().createElement("div",{style:{marginTop:10,paddingTop:10}},t().createElement("div",{style:{display:"flex",alignItems:"center"}},t().createElement("div",{style:{fontSize:14,fontWeight:500}},"Edit Labels"),t().createElement(l.IconButton,fr({iconClassName:"mdi mdi-chevron-"+(m?"down":"right"),tooltip:u("policy.editLabels"),onClick:function(){return r.setState({showLabels:!m})}},f))),t().createElement("div",{style:{display:m?"flex":"none"}},t().createElement("div",{style:{marginRight:6,flex:1}},t().createElement(Or,{value:h||s.Name,fullWidth:!0,onChange:function(e,t){r.setState({pName:t})}})),t().createElement("div",{style:{marginLeft:6,flex:1}},t().createElement(Or,{value:b||s.Description,fullWidth:!0,onChange:function(e,t){r.setState({pDesc:t})}})),t().createElement("div",{style:{width:80}},t().createElement(l.IconButton,{disabled:!g,iconClassName:"mdi mdi-content-save",tooltip:u("policy.saveLabels"),tooltipPosition:"top-center",onClick:function(){r.saveLabels()},iconStyle:{fontSize:20,color:"rgba(0,0,0,"+(g?".43":".10")+")"},style:{padding:14}}))))}return t().createElement("div",{style:{padding:"12px 24px",backgroundColor:"#f5f5f5"}},d,p,e)}}],n&&hr(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);function wr(e){return wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wr(e)}function Sr(){return Sr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Sr.apply(this,arguments)}function Er(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function jr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Er(Object(r),!0).forEach((function(t){Rr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Er(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Rr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==wr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==wr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===wr(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var kr=u().requireLib("components").MaterialTable,Cr=["acl","rest","oidc"],Ar=i()({displayName:"PoliciesBoard",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:s().instanceOf(Ot()).isRequired,rootNode:s().instanceOf(Et()).isRequired,currentNode:s().instanceOf(Et()).isRequired,openEditor:s().func.isRequired,openRightPane:s().func.isRequired,closeRightPane:s().func.isRequired,readonly:s().bool},componentWillMount:function(){this.listPolicies()},getInitialState:function(){return{policies:{},popoverOpen:!1,anchorEl:null}},groupByResourcesGroups:function(e){var t=[],r=new RegExp("-ro$|-rw$|-wo$");return Cr.map((function(n){var o=e.PolicyGroups.filter((function(e){var t=e.ResourceGroup||"rest";return!e.Uuid.match(r)&&t===n}));o.length&&(o.sort((function(e,t){return e.Name.toLowerCase()<t.Name.toLowerCase()?-1:e.Name.toLowerCase()===t.Name.toLowerCase()?0:1})),t[n]=o)})),t},listPolicies:function(){var e=this;this.setState({loading:!0});var t=new m.PolicyServiceApi(y().getRestClient());u().startLoading(),t.listPolicies(new m.IdmListPolicyGroupsRequest).then((function(t){u().endLoading();var r=e.groupByResourcesGroups(t);e.setState({policies:r,loading:!1})})).catch((function(t){u().endLoading(),e.setState({error:t,loading:!1})}))},savePolicy:function(e,t){var r=this;t?this.listPolicies():qt().loadClass("EnterpriseSDK").then((function(t){new t.EnterprisePolicyServiceApi(y().getRestClient()).putPolicy(e).then((function(){r.listPolicies()})).catch((function(e){r.setState({error:e})}))}))},deletePolicy:function(e){var t=this,r=this.props.pydio;r.UI.openConfirmDialog({message:r.MessageHash["ajxp_admin.policies.policy.delete.confirm"],destructive:[e.Name],validCallback:function(){qt().loadClass("EnterpriseSDK").then((function(r){new r.EnterprisePolicyServiceApi(y().getRestClient()).deletePolicy(e.Uuid).then((function(){t.listPolicies()})).catch((function(e){t.setState({error:e})}))}))}})},createPolicy:function(e){var t=this.refs,r=t.newPolicyName,n=t.newPolicyDescription,o=this.state.newPolicyType,i=P(),a={Uuid:i,Name:r.getValue(),Description:n.getValue(),ResourceGroup:o,Policies:[]},s=jr({},this.state.policies);s[o]||(s[o]=[]),s[o].push(a),this.setState({policies:s,popoverOpen:!1,newPolicyId:i,selectedPolicy:i})},openPopover:function(e){var t=this;e.preventDefault(),this.setState({newPolicyType:"acl",popoverOpen:!0,anchorEl:e.currentTarget},(function(){setTimeout((function(){t.refs.newPolicyName.focus()}),200)}))},handleRequestClose:function(){this.setState({popoverOpen:!1})},handleChangePolicyType:function(e,t,r){this.setState({newPolicyType:r})},selectRows:function(e){if(e.length){var t=e[0],r=this.state.selectedPolicy;this.setState({selectedPolicy:r===t.Uuid?null:t.Uuid})}},render:function(){var e=this,r=this.props,n=r.muiTheme,o=r.currentNode,i=r.pydio,a=r.accessByName,s=this.props.readonly;s=s||!a("Create");var c=this.state,u=c.policies,p=c.selectedPolicy,f=c.newPolicyId,d=function(e){return i.MessageHash["ajxp_admin.policies."+e]||e},y=AdminComponents.AdminStyles(n.palette),m=[{name:"Name",label:d("policy.name"),style:{fontSize:15},sorter:{type:"string",default:!0}},{name:"Rules",label:d("policy.rules"),style:{width:80,textAlign:"center"},headerStyle:{width:80,textAlign:"center"},renderCell:function(e){return e.Policies.length},sorter:{type:"number"}},{name:"Description",label:d("policy.description"),sorter:{type:"string"}}],h=[];s?h.push({iconClassName:"mdi mdi-eye",tooltip:d("policy.display"),onClick:function(t){return e.setState({selectedPolicy:p===t.Uuid?null:t.Uuid})}}):(h.push({iconClassName:"mdi mdi-pencil",tooltip:d("policy.edit"),onClick:function(t){return e.setState({selectedPolicy:p===t.Uuid?null:t.Uuid})}}),h.push({iconClassName:"mdi mdi-delete",tooltip:d("policy.delete"),onClick:function(t){e.deletePolicy(t)}}));var b=Object.keys(u).map((function(r){if(s&&"acl"===r)return null;var n=u[r].map((function(r){return r.Uuid===p?jr(jr({},r),{},{expandedRow:t().createElement(Pr,Sr({},e.props,{readonly:s,key:r.Name,policy:r,savePolicy:e.savePolicy.bind(e),deletePolicy:e.deletePolicy.bind(e),newPolicyWithRule:f===r.Uuid?r.Name:null}))}):r})),o=d("type."+r+".title"),i=d("type."+r+".legend");return t().createElement("div",null,t().createElement(AdminComponents.SubHeader,{title:o,legend:i}),t().createElement(l.Paper,Sr({},y.body.block.props,{style:y.body.block.container}),t().createElement(kr,{data:n,columns:m,actions:h,onSelectRows:function(t){return e.selectRows(t)},deselectOnClickAway:!0,showCheckboxes:!1,masterStyles:y.body.tableMaster,storageKey:"console.policies."+r+".list"})))})),g=t().createElement("div",null,t().createElement(l.FlatButton,Sr({},y.props.header.flatButton,{primary:!0,onClick:this.openPopover.bind(this),label:d("policy.new")})),t().createElement(l.Popover,{open:this.state.popoverOpen,anchorEl:this.state.anchorEl,anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},onRequestClose:this.handleRequestClose.bind(this)},t().createElement("div",null,t().createElement("div",{style:{padding:"0 12px"}},t().createElement(l.TextField,{floatingLabelText:d("policy.name"),ref:"newPolicyName"}),t().createElement("br",null),t().createElement(l.TextField,{floatingLabelText:d("policy.description"),ref:"newPolicyDescription"}),t().createElement("br",null),t().createElement(l.SelectField,{floatingLabelText:d("policy.type"),ref:"newPolicyType",value:this.state.newPolicyType||"rest",onChange:this.handleChangePolicyType.bind(this)},Cr.map((function(e){return t().createElement(l.MenuItem,{value:e,primaryText:d("type."+e+".title")})})))),t().createElement(l.Divider,null),t().createElement("div",{style:{textAlign:"right",padding:"6px 12px"}},t().createElement(l.FlatButton,{label:i.MessageHash[54],onClick:this.handleRequestClose.bind(this)}),t().createElement(l.FlatButton,{label:d("policy.create"),onClick:this.createPolicy.bind(this)})))));return t().createElement("div",{className:"vertical-layout",style:{height:"100%"}},t().createElement(AdminComponents.Header,{title:o.getLabel(),icon:o.getMetadata().get("icon_class"),actions:s?null:g,reloadAction:this.listPolicies.bind(this),loading:this.state.loading}),t().createElement("div",{className:"layout-fill"},b))}});Ar=(0,ye.muiThemeable)()(Ar);const xr=require("pydio/util/pass");var Mr=r.n(xr);function Nr(e){return Nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nr(e)}function _r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ir(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Nr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Nr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Nr(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Tr=u().requireLib("hoc").ModernTextField,Dr=i()({displayName:"CreateUserForm",propTypes:{dataModel:s().instanceOf(PydioDataModel),openRoleEditor:s().func},mixins:[AdminComponents.MessagesConsumerMixin,PydioReactUI.ActionDialogMixin,PydioReactUI.CancelButtonProviderMixin,PydioReactUI.SubmitButtonProviderMixin],getDefaultProps:function(){return{dialogSize:"sm",dialogTitleId:"ajxp_admin.user.19"}},getInitialState:function(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_r(Object(r),!0).forEach((function(t){Ir(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_r(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({step:1},Mr().getState())},checkPassword:function(){var e=this.refs.pass.getValue(),t=this.refs.passconf.getValue();this.setState(Mr().getState(e,t,this.state))},checkLogin:function(e,t){var r=Mr().isValidLogin(t);this.setState({loginErrorText:r})},submit:function(){var e=this;if(this.state.valid&&!this.state.loginErrorText){var t=this.props.dataModel.getUniqueNode()||this.props.dataModel.getContextNode(),r=t.getPath();r.startsWith("/idm/users")&&(r=r.substr("/idm/users".length));var n=this.refs.user_id.getValue(),o=this.refs.pass.getValue();y().getRestClient().getIdmApi().createUser(r,n,o).then((function(o){e.dismiss(),t.reload();var i=new(Et())(r+"/"+n,!0);i.getMetadata().set("ajxp_mime","user"),i.getMetadata().set("IdmUser",o),e.props.openRoleEditor(i)}))}else this.props.pydio.UI.displayMessage("ERROR",this.state.passErrorText||this.state.confirmErrorText||this.state.loginErrorText)},render:function(){var e,r=(this.props.dataModel.getUniqueNode()||this.props.dataModel.getContextNode()).getPath();return r.startsWith("/idm/users")&&(e=r.substr("/idm/users".length))&&(e=t().createElement("div",null,this.context.getMessage("ajxp_admin.user.20").replace("%s",e))),t().createElement("div",{style:{width:"100%"}},e,t().createElement("form",{autoComplete:"off"},t().createElement("div",{style:{width:"100%"}},t().createElement(Tr,{ref:"user_id",onChange:this.checkLogin,fullWidth:!0,floatingLabelText:this.context.getMessage("ajxp_admin.user.21"),errorText:this.state.loginErrorText,autoComplete:"nope",variant:"v2"})),t().createElement("div",null,t().createElement(Tr,{ref:"pass",type:"password",floatingLabelText:this.context.getMessage("ajxp_admin.user.22"),onChange:this.checkPassword,fullWidth:!0,errorText:this.state.passErrorText||this.state.passHintText,autoComplete:"new-password",variant:"v2"})),t().createElement("div",null,t().createElement(Tr,{ref:"passconf",type:"password",floatingLabelText:this.context.getMessage("ajxp_admin.user.23"),onChange:this.checkPassword,fullWidth:!0,errorText:this.state.confirmErrorText,autoComplete:"confirm-password",variant:"v2"}))))}}),Ur=u().requireLib("hoc").ModernTextField,Lr=i()({displayName:"CreateRoleOrGroupForm",mixins:[AdminComponents.MessagesConsumerMixin,PydioReactUI.CancelButtonProviderMixin,PydioReactUI.SubmitButtonProviderMixin],propTypes:{type:s().oneOf(["group","user","role"]),roleNode:s().instanceOf(Et()),openRoleEditor:s().func},getTitle:function(){return"group"===this.props.type?this.context.getMessage("ajxp_admin.user.15"):this.context.getMessage("ajxp_admin.user.14")},getPadding:function(){return!0},getSize:function(){return"sm"},dismiss:function(){return this.props.onDismiss()},getInitialState:function(){return{groupId:"",groupIdError:"",groupLabel:"",groupLabelError:"",roleId:"",roleLabel:"",roleLabelError:""}},submit:function(){var e,t=this,r=this.props,n=r.type,o=r.pydio,i=r.reload,a=this.state,s=a.groupId,l=a.groupIdError,c=a.groupLabel,u=a.groupLabelError,p=a.roleId,f=a.roleIdError,d=a.roleLabel,m=a.roleLabelError;if("group"===n){if(l||u)return;var h=(e=o.getContextHolder().getSelectedNodes().length?o.getContextHolder().getSelectedNodes()[0]:o.getContextNode()).getPath().replace("/idm/users",""),b=y().getRestClient().getIdmApi();b.userOrGroupByIdentifier(h,s).then((function(r){r?t.setState({groupIdError:"Found group or user with same identifier!"}):b.createGroup(h||"/",s,c).then((function(){t.dismiss(),e.reload()}))}))}else if("role"===n){if(m||f)return;y().getRestClient().getIdmApi().createRole(d,p).then((function(){t.dismiss(),i&&i()}))}},update:function(e){if(void 0!==e.groupId)new RegExp(/^[0-9A-Z\-_.:\+]+$/i).test(e.groupId)?""===e.groupId?e.groupIdError=this.context.getMessage("ajxp_admin.user.16.empty"):e.groupIdError="":e.groupIdError=this.context.getMessage("ajxp_admin.user.16.format");else if(void 0!==e.groupLabel)if(""===e.groupLabel)e.groupLabelError=this.context.getMessage("ajxp_admin.user.17.empty");else{e.groupLabelError="";var t=this.state,r=t.groupId,n=t.groupLabel;""!==r&&U().computeStringSlug(n)!==r||(e.groupId=U().computeStringSlug(e.groupLabel),e.groupIdError="")}else if(void 0!==e.roleLabel)""===e.roleLabel?e.roleLabelError=this.context.getMessage("ajxp_admin.user.18.empty"):e.roleLabelError="";else if(e.roleId){var o=this.props.roles;(void 0===o?[]:o).filter((function(t){return t.Uuid===e.roleId})).length>0?e.roleIdError=this.context.getMessage("role_editor.31.exists"):e.roleIdError="",e.roleId=U().computeStringSlug(e.roleId)}this.setState(e)},render:function(){var e=this,r=this.state,n=r.groupId,o=r.groupIdError,i=r.groupLabel,a=r.groupLabelError,s=r.roleId,l=r.roleIdError,c=r.roleLabel,u=r.roleLabelError;return"group"===this.props.type?t().createElement("div",{style:{width:"100%"}},t().createElement(Ur,{value:i,errorText:a,onChange:function(t,r){e.update({groupLabel:r})},fullWidth:!0,floatingLabelText:this.context.getMessage("ajxp_admin.user.17"),onKeyPress:function(t){"Enter"===t.key&&e.submit()},variant:"v2"}),t().createElement(Ur,{value:n,errorText:o,onChange:function(t,r){e.update({groupId:r})},fullWidth:!0,floatingLabelText:this.context.getMessage("ajxp_admin.user.16"),onKeyDown:function(t){"Enter"===t.key&&e.submit()},variant:"v2"})):t().createElement("div",{style:{width:"100%"}},t().createElement(Ur,{fullWidth:!0,value:c,errorText:u,onChange:function(t,r){e.update({roleLabel:r})},floatingLabelText:this.context.getMessage("role_editor.32"),onKeyDown:function(t){"Enter"===t.key&&e.submit()},variant:"v2"}),t().createElement(Ur,{fullWidth:!0,value:s,errorText:l,floatingLabelText:this.context.getMessage("role_editor.31.hint"),onChange:function(t,r){e.update({roleId:r})},onKeyDown:function(t){"Enter"===t.key&&e.submit()},variant:"v2"}))}}),Br=u().requireLib("hoc"),Fr=Br.ModernTextField,qr=(Br.ModernSelectField,u().requireLib("components").FoldersTree),Wr=u().requireLib("boot"),Hr=Wr.ActionDialogMixin,Vr=Wr.CancelButtonProviderMixin,zr=Wr.SubmitButtonProviderMixin,Gr=i()({displayName:"TreeGroupsDialog",propTypes:{dataModel:s().instanceOf(Ot()),submitValue:s().func.isRequired},mixins:[Hr,Vr,zr],getDefaultProps:function(){return{dialogTitle:"Move",dialogIsModal:!0,dialogScrollBody:!0}},submit:function(){var e=this.state,t=e.selectedNode,r=e.selectedPath;this.props.submitValue(r,t),this.dismiss()},getInitialState:function(){return{selectedNode:this.props.dataModel.getContextNode(),selectedPath:"/"}},onNodeSelected:function(e){var t=this.props.dataModel;e.load(t.getAjxpNodeProvider());var r=t.getContextNode().getPath(),n=new RegExp("^"+r),o=e.getPath().replace(n,"");this.setState({selectedNode:e,selectedPath:o})},render:function(){var e=this.state.selectedPath;return t().createElement("div",{style:{width:"100%"}},t().createElement("div",{style:{fontSize:13}},u().getMessages()["ajxp_admin.user.moveto.hint"]),t().createElement(l.Paper,{zDepth:0,style:{height:300,overflowX:"auto",color:"#546E7A",fontSize:14,padding:"6px 0px",backgroundColor:"rgb(246, 246, 248)",marginTop:4}},t().createElement("div",{style:{marginTop:-41,marginLeft:-21}},t().createElement(qr,{pydio:this.props.pydio,dataModel:this.props.dataModel,rootNode:this.props.dataModel.getContextNode(),onNodeSelected:this.onNodeSelected,showRoot:!0,draggable:!1}))),t().createElement("div",null,t().createElement(Fr,{variant:"v2",fullWidth:!0,hintText:this.props.pydio.MessageHash[373],ref:"input",value:e,disabled:!1,onChange:function(){}})))}});function Kr(e){return Kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kr(e)}function Jr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Kr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Kr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Kr(o)?o:String(o)),n)}var o}function $r(e,t){return $r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$r(e,t)}function Yr(e){return Yr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Yr(e)}const Qr=V(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$r(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Yr(o);if(i){var r=Yr(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Kr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return r=s,(n=[{key:"render",value:function(){var e,r=this.props.getMessage;switch(this.props.acl){case"read,write":e=r("8");break;case"read":e=r("9");break;case"write":e=r("10");break;case"PYDIO_VALUE_CLEAR":e=r("11");break;default:e=r("12")}return t().createElement("span",{className:"summary-rights summary"},e)}}])&&Jr(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component));var Xr={PagesAcls:pe,RightsSelector:$,RightsSummary:Qr,WorkspacesAcls:ae,WorkspaceAcl:ee},Zr={GroupInfo:qe,RoleInfo:Pe,UserInfo:Ie},en={Role:C,User:T};function tn(e){return tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tn(e)}function rn(e){return function(e){if(Array.isArray(e))return nn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return nn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?nn(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function on(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function an(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?on(Object(r),!0).forEach((function(t){sn(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):on(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function sn(e,t,r){return(t=cn(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ln(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,cn(n.key),n)}}function cn(e){var t=function(e,t){if("object"!==tn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==tn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===tn(t)?t:String(t)}function un(e,t){return un=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},un(e,t)}function pn(e){return pn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},pn(e)}var fn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&un(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=pn(o);if(i){var r=pn(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===tn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,an({actionsPrefix:"[a] ",parametersPrefix:""},e))).state={filter:null},t.props.initialSelection&&(t.state=an({filter:t.props.initialSelection.paramName},t.props.initialSelection)),t}return r=s,(n=[{key:"filter",value:function(e){this.setState({filter:e.target.value.toLowerCase()})}},{key:"select",value:function(e,t,r,n){this.props.onSelection(e,t,r,n),this.setState({pluginName:e,type:t,paramName:r})}},{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){e.refs.input.focus()}),150)}},{key:"render",value:function(){var e=this,r=this.props,n=r.pydio,o=r.allParameters,i=r.allActions,a=this.state.filter,s=this.state.paramName,c=this.state.pluginName,u=this.state.type,p=function(e){return!a||-1!==e.toLowerCase().indexOf(a)},f=function(e){if(!a)return e;var r=e.toLowerCase().indexOf(a),n=e.substr(0,r),o=e.substr(r,a.length),i=e.substr(r+a.length);return t().createElement("span",null,n,t().createElement("span",{className:"highlight"},o),i)},d=[],y={};return Object.keys(o).forEach((function(e){var t;y[e]||(y[e]={name:e,label:e,actions:[],params:[]}),(t=y[e].params).push.apply(t,rn(o[e]))})),Object.keys(i).forEach((function(e){var t;y[e]||(y[e]={name:e,label:e,actions:[],params:[]}),(t=y[e].actions).push.apply(t,rn(i[e]))})),U().objectValues(y).map((function(r){var o=[],i=!1,a=r.label||r.name;(p(a)||p(r.name))&&(i=!0,p(a)?a=f(a):p(r.name)&&(a=t().createElement("span",null,a," (",f(r.name),")"))),r.params.concat(r.actions).map((function(a){var l=a.action||a.parameter,d=a.label||l,y="";a.action?(d=He().XPathGetSingleNodeText(a.xmlNode,"gui/@text")||d,y=e.props.actionsPrefix):(d=a.xmlNode.getAttribute("label")||d,e.props.parametersPrefix&&(y=e.props.parametersPrefix)),n.MessageHash[d]&&(d=n.MessageHash[d]);var m=p(d),h=p(l);if(m||h||i){var b=("*"===c||c===r.name)&&a[u]&&s===l,g=d;m?g=f(d):h&&(g=t().createElement("span",null,d," (",f(l),") ")),o.push(t().createElement("li",{onClick:function(){return e.select(r.name,a.action?"action":"parameter",l,a)},className:(b?"selected ":"")+"parameters-param",key:r.name+"-"+(a.action?"action":"parameter")+"-"+l},y," ",g))}})),o.length&&d.push(t().createElement("li",{className:"parameters-plugin",key:r.name},a,t().createElement("ul",null,o)))})),t().createElement("div",null,t().createElement("div",{style:{padding:"0 24px",borderBottom:"1px solid #e0e0e0"}},t().createElement(l.TextField,{ref:"input",floatingLabelText:this.props.getMessage("13"),onChange:this.filter.bind(this),fullWidth:!0,underlineShow:!1})),t().createElement("div",{className:"parameters-tree-scroller"},t().createElement("ul",{className:"parameters-tree"},d)))}}])&&ln(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);function dn(e){return dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dn(e)}function yn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==dn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==dn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===dn(o)?o:String(o)),n)}var o}function mn(e,t){return mn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mn(e,t)}function hn(e){return hn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},hn(e)}var bn=u().requireLib("boot"),gn=bn.ActionDialogMixin,vn=bn.CancelButtonProviderMixin,On=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mn(e,t)}(s,e);var r,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=hn(o);if(i){var r=hn(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===dn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return r=s,(n=[{key:"render",value:function(){var e=this.props,r=e.getMessage,n=e.muiTheme.palette.primary1Color;return t().createElement("div",{style:{backgroundColor:n,color:"white",padding:"0 24px 24px"}},t().createElement("h3",{style:{color:"white"}},r("14")),t().createElement("div",{className:"legend"},r("15")))}}])&&yn(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t().Component);On=(0,ye.muiThemeable)()(On);var Pn=i()({displayName:"ParameterCreate",mixins:[gn,vn],propTypes:{workspaceScope:s().string,showModal:s().func,hideModal:s().func,pluginsFilter:s().func,roleType:s().oneOf(["user","group","role"]),createParameter:s().func},getDefaultProps:function(){return{dialogPadding:0,dialogTitle:"",dialogSize:"md"}},getInitialState:function(){return{step:1,workspaceScope:this.props.workspaceScope,pluginName:null,paramName:null,actions:{},parameters:{}}},setSelection:function(e,t,r,n){this.setState({pluginName:e,type:t,paramName:r,attributes:n},this.createParameter)},createParameter:function(){this.props.createParameter(this.state.type,this.state.pluginName,this.state.paramName,this.state.attributes),this.props.onDismiss()},render:function(){var e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pydio_role";return n.MessageHash[t+(t?".":"")+e]||e},r=this.props,n=r.pydio,o=r.actions,i=r.parameters;return t().createElement("div",{className:"picker-list"},t().createElement(On,{getMessage:e}),t().createElement(fn,{pydio:n,allActions:o,allParameters:i,onSelection:this.setSelection,getMessage:e}))}}),wn={ParametersPicker:fn,ParameterCreate:Pn,ParametersPanel:ct,ParameterEntry:rt};function Sn(e){return Sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sn(e)}function En(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function jn(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Sn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Sn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Sn(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Rn=u().requireLib("boot"),kn=Rn.ActionDialogMixin,Cn=Rn.CancelButtonProviderMixin,An=Rn.SubmitButtonProviderMixin,xn=u().requireLib("hoc").ModernTextField;const Mn=i()({displayName:"UserPasswordDialog",mixins:[AdminComponents.MessagesConsumerMixin,kn,Cn,An],propTypes:{pydio:s().instanceOf(u()),user:s().instanceOf(T)},getDefaultProps:function(){return{dialogTitle:pydio.MessageHash["role_editor.25"],dialogSize:"sm"}},getInitialState:function(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?En(Object(r),!0).forEach((function(t){jn(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):En(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},Mr().getState())},onChange:function(e,t){var r=this.refs.pass.getValue(),n=this.refs.confirm.getValue(),o=Mr().getState(r,n,this.state);this.setState(o)},submit:function(){var e=this;if(this.state.valid){var t=this.refs.pass.getValue(),r=this.props.user;r.getIdmUser().Password=t,r.save().then((function(){e.dismiss()}))}else this.props.pydio.UI.displayMessage("ERROR",this.state.passErrorText||this.state.confirmErrorText)},render:function(){var e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r.g.pydio.MessageHash[t+(t?".":"")+e]||e};return t().createElement("div",{style:{width:"100%"}},t().createElement("form",{autoComplete:"off"},t().createElement(xn,{ref:"pass",type:"password",fullWidth:!0,onChange:this.onChange,floatingLabelText:e("523"),errorText:this.state.passErrorText,hintText:this.state.passHintText,variant:"v2",autoComplete:"whatever"}),t().createElement(xn,{ref:"confirm",type:"password",fullWidth:!0,onChange:this.onChange,floatingLabelText:e("199"),errorText:this.state.confirmErrorText,variant:"v2",autoComplete:"no-thanks"})))}});var Nn={Model:en,Info:Zr,ACL:Xr,Params:wn,User:{UserPasswordDialog:Mn,UserRolesPicker:Se},Util:{EditorCache:{CACHE:null},RoleMessagesConsumerMixin:H,withRoleMessages:V,loadEditorClass:Ht}},_n={CreateUserForm:Dr,CreateRoleOrGroupForm:Lr}})(),window.AdminPeople=n})();